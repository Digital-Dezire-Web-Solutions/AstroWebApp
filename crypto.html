<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>About Us | Astro Nivesh</title>
    <!-- swiper slider css CDN -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.1/css/all.min.css"
        integrity="sha512-5Hs3dF2AEPkpNAR7UiOHba+lRSJNeM2ECkwxUIxC1Q/FLycGTbNapWXB4tP889k5T5Ju8fs4b1P5z/iB4nMfSQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <!-- Tempus Dominus CSS -->
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link rel="stylesheet" href="./css/style.css">
    <link rel="icon" href="/images/astrology.png" />
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-ZF2CQTE5JG"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-ZF2CQTE5JG');
    </script>
    <script src="https://cdn.pagesense.io/js/astronivesh/b70b9482d2454a09ac5feadc3675f35c.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>

</head>

<body>
    <style>
        .results-table th,
        .results-table td,
        .input-table th,
        .input-table td,
        .positions-table th,
        .positions-table td,
        .weightage-details-table th,
        .weightage-details-table td,
        .price-levels-table th,
        .price-levels-table td,
        .future-positions-table th,
        .future-positions-table td,
        .coin-affinity-table th,
        .coin-affinity-table td {
            /* Shared cell style */
            padding: 0.4rem;
            /* Reduced padding */
            border: 1px solid #e2e8f0;
            /* Tailwind gray-300 */
            text-align: center;
            vertical-align: middle;
            font-size: 0.75rem;
            /* Smaller font size for table content */
        }

        .input-table th,
        .positions-table th,
        .weightage-details-table th,
        .price-levels-table th,
        .future-positions-table th,
        .coin-affinity-table th {
            /* Specific header cell style for input tables */
            font-size: 0.7rem;
            /* Even smaller for these headers */
            white-space: nowrap;
        }

        .input-table select,
        .input-table input[type="text"],
        .input-table input[type="checkbox"],
        .positions-table select,
        .positions-table input[type="number"],
        .future-positions-table select,
        .future-positions-table input[type="number"],
        .results-table input[type="number"].manual-score-input,
        #priceLevelInputPrice,
        #priceLevelCoinSelect,
        /* UPDATED ID */
        #tithiSelect,
        #moonPhaseSelect,
        #filterCoinByPlanetSelect {
            /* Input field styling */
            padding: 0.25rem 0.5rem;
            /* Smaller padding for inputs */
            border: 1px solid #cbd5e0;
            /* Tailwind gray-400 */
            border-radius: 0.25rem;
            /* Tailwind rounded-sm */
            font-size: 0.8rem;
            /* Smaller font for inputs */
            width: 100%;
            box-sizing: border-box;
        }

        .weightage-table-header tr {
            background-color: #fe7000;
            color: white;
            font-weight: 600;
        }

        .results-table input[type="number"].manual-score-input {
            max-width: 70px;
            /* Limit width of manual score inputs */
            text-align: center;
        }

        #priceLevelInputPrice {
            max-width: 120px;
        }

        #priceLevelCoinSelect {
            max-width: 250px;
        }

        /* UPDATED ID */
        #tithiSelect,
        #moonPhaseSelect,
        #filterCoinByPlanetSelect {
            max-width: 200px;
        }


        .input-table input[type="checkbox"] {
            width: auto;
            margin: 0 auto;
            display: block;
        }

        .input-table .derived-text-field {
            /* Style for read-only derived fields */
            padding: 0.25rem;
            font-size: 0.75rem;
            width: 100%;
            box-sizing: border-box;
            min-height: 2rem;
            /* Ensure a minimum height */
            text-align: left;
            background-color: #f8fafc;
            /* Very light gray for derived fields */
        }

        .results-table tr:nth-child(even),
        .input-table tr:nth-child(even),
        .positions-table tr:nth-child(even),
        .weightage-details-table tr:nth-child(even),
        .price-levels-table tr:nth-child(even),
        .future-positions-table tr:nth-child(even),
        .coin-affinity-table tr:nth-child(even) {
            /* Zebra striping */
            background-color: #edf2f7;
            /* Tailwind gray-200 */
        }

        .results-table tr:hover,
        .input-table tr:hover,
        .positions-table tr:hover,
        .weightage-details-table tr:hover,
        .price-levels-table tr:hover,
        .future-positions-table tr:hover,
        .coin-affinity-table tr:hover {
            /* Hover effect */
            background-color: #e2e8f0;
            /* Tailwind gray-300 */
        }

        .total-score-positive {
            color: #2f855a;
            font-weight: 600;
        }

        /* Tailwind green-700 */
        .total-score-negative {
            color: #c53030;
            font-weight: 600;
        }

        /* Tailwind red-700 */
        .total-score-neutral {
            color: #718096;
            font-weight: 600;
        }

        /* Tailwind gray-600 */

        .results-table input.total-score-positive {
            border-color: #2f855a;
            color: #2f855a;
        }

        .results-table input.total-score-negative {
            border-color: #c53030;
            color: #c53030;
        }

        .results-table input.total-score-neutral {
            border-color: #718096;
            color: #718096;
        }

        .loading-text {
            text-align: center;
            font-style: italic;
            color: #4a5568;
            padding: 1rem;
        }

        .table-container {
            overflow-x: auto;
            margin-bottom: 2rem;
            max-width: 100%;
        }

        .section-header {
            font-size: 1.25rem;
            font-weight: 600;
            color: #2d3748;
            /* Tailwind gray-800 */
            margin-top: 2rem;
            margin-bottom: 1rem;
            text-align: center;
        }

        .crypto-category-table-header {
            /* Specific for crypto category trend table header */
            background-color: #374151;
            /* Tailwind gray-800 */
            color: white;
            font-size: 0.8rem;
            position: sticky;
            top: 0;
            z-index: 20;
            /* Sticky header */
        }

        .crypto-category-results-table th,
        .crypto-category-results-table td {
            padding: 0.5rem 0.3rem;
            border: 1px solid #d1d5db;
            /* Tailwind gray-400 */
            text-align: center;
            vertical-align: middle;
            font-size: 0.8rem;
            /* Slightly larger font */
        }

        .crypto-category-results-table th.sortable-header {
            cursor: pointer;
        }

        .crypto-category-results-table th.sortable-header:hover {
            background-color: #4b5563;
        }

        /* Darker gray on hover */
        .crypto-category-results-table td.category-name {
            white-space: normal;
            text-align: left;
            font-weight: 500;
            position: sticky;
            left: 0;
            background-color: #ffe9dd;
            /* Light gray for sticky column */
            z-index: 10;
            /* Ensure it's above other cells but below header */
        }

        .crypto-category-results-table tr:nth-child(even) td.category-name {
            background-color: #ffd9c5;
        }

        /* Match even row striping */
        .crypto-category-results-table tr:nth-child(even) {
            background-color: #e5e7eb;
        }

        .crypto-category-results-table tr:hover td.category-name {
            background-color: #dbeafe;
        }

        /* Light blue on hover for sticky */
        .crypto-category-results-table tr:hover td {
            background-color: #d1d5db;
        }

        .trend-positive {
            color: #166534;
            font-weight: 600;
        }

        /* Tailwind green-800 */
        .trend-negative {
            color: #991b1b;
            font-weight: 600;
        }

        /* Tailwind red-800 */
        .trend-neutral {
            color: #4b5563;
            font-weight: 600;
        }

        /* Tailwind gray-700 */

        .crypto-page-title {
            font-size: 1.75rem;
            margin-bottom: 0.75rem;
        }

        .crypto-page-subtitle {
            font-size: 1rem;
            margin-bottom: 1.5rem;
        }

        .controls-main-container {
            background-color: white;
            padding: 1rem;
            border-radius: 0.5rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            margin-bottom: 1.5rem;
        }

        .controls-main-container button,
        .controls-main-container select {
            /* Styling for control buttons and selects */
            font-size: 0.95rem;
            border-radius: 0.375rem;
            border: none;
            /* border: 1px solid #cbd5e0; */
            /* Tailwind gray-400 */
            padding: 0.6rem 0.75rem;
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        }

        .controls-main-container button {
            background-color: #fe7000;
            /* Tailwind indigo-600 */
            color: white;
            transition: background-color 0.2s;
        }

        .controls-main-container button:hover {
            background-color: #fe7000;
        }

        /* Tailwind indigo-700 */
        .controls-main-container button:disabled {
            background-color: #f5c6a2;
            cursor: not-allowed;
        }

        /* Lighter indigo for disabled */
        .controls-main-container label {
            font-size: 0.9rem;
            font-weight: 500;
            color: #374151;
        }

        .sort-indicator {
            font-size: 0.7em;
            margin-left: 4px;
        }

        .derived-dignity-cell {
            background-color: #e9d8fd;
            font-style: italic;
        }

        /* Light purple for derived dignity cells */

        .custom-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .custom-modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .custom-modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            text-align: center;
            max-width: 90%;
            width: 400px;
        }

        .custom-modal-content p {
            margin-bottom: 1rem;
            font-size: 1rem;
            color: #374151;
        }

        .custom-modal-content button {
            background-color: #4f46e5;
            color: white;
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 0.375rem;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .custom-modal-content button:hover {
            background-color: #4338ca;
        }

        .weightage-category-container {
            margin-bottom: 1.5rem;
            background-color: white;
            padding: 1rem;
            border-radius: 0.5rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .weightage-category-title {
            font-size: 1rem;
            font-weight: 600;
            color: #374151;
            margin-bottom: 0.75rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #e5e7eb;
        }

        .weightage-grid-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .price-levels-calculator-container {
            background-color: white;
            padding: 1.5rem;
            /* Increased padding */
            border-radius: 0.5rem;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            /* Softer shadow */
            margin-bottom: 2rem;
        }

        .price-levels-input-group {
            display: flex;
            flex-wrap: wrap;
            /* Allow items to wrap on smaller screens */
            align-items: center;
            justify-content: space-around;
            gap: 1rem;
            /* Space between items */
            margin-bottom: 1.5rem;
            /* Space below the group */
        }

        .price-levels-input-group label {
            font-weight: 500;
            color: #fe7000;
            /* Tailwind gray-700 */
        }

        #calculatePriceLevelsButton {
            background-color: #fe7000;
            border: none;
            border-radius: 8px;
            /* Tailwind green-500 */
            color: white;
            padding: 0.5rem 1rem;
        }

        #calculatePriceLevelsButton:hover {
            background-color: #fe7000;
            /* Tailwind green-600 */
        }

        .individual-planet-levels-title {
            /* Title for individual planet price levels table */
            font-size: 1.1rem;
            /* Slightly larger */
            font-weight: 600;
            color: #2d3748;
            margin-top: 1.5rem;
            /* More space above */
            margin-bottom: 0.75rem;
            text-align: center;
        }

        .price-levels-table .level-target {
            /* Style for target price rows */
            font-weight: bold;
            background-color: #f0f9ff;
            /* Light blue background */
        }

        .price-levels-table .level-target td {
            color: #075985;
            /* Darker blue text */
        }

        #priceForecastChartContainer,
        #tradingviewChartContainer {
            /* Styling for chart containers */
            width: 100%;
            /* Max width for better readability on large screens */
            height: 500px;
            /* Increased height */
            margin: 2rem auto;
            /* Centering and spacing */
            padding: 1rem;
            background-color: white;
            border-radius: 0.5rem;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .tv-symbol-note {
            font-size: 0.75rem;
            color: #4b5563;
            /* Tailwind gray-600 */
            margin-top: 0.25rem;
        }

        .future-day-tables-grid {
            /* For layout of future day tables */
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            /* Responsive grid */
            gap: 1.5rem;
        }

        #actsScoresBody p {
            margin-bottom: 0.25rem;
            /* Reduced margin for tighter packing */
            font-size: 0.9rem;
        }

        #actsScoresBody strong {
            font-weight: 600;
            color: #374151;
            /* Tailwind gray-700 */
        }

        #actsScoresBody .acts-component {
            font-size: 0.8rem;
            color: #555;
            padding-left: 1rem;
            /* Indent component scores */
        }

        .timing-factor-container {
            display: flex;
            gap: 1rem;
            align-items: center;
            justify-content: center;
            /* Center the dropdowns */
            margin-bottom: 1rem;
            /* Add some space below */
        }

        .timing-factor-container label {
            font-size: 0.85rem;
            font-weight: 500;
            color: #374151;
        }
    </style>
    <!-- __________________________________ 
     Our header Comp 
     ------------------------ -->
    <!-- 
     <header class="header-comp">
        <div class="common-container3">

            <div class="header-flex-bx flex item-between">

                <div class="left-header-logo flex item-start gap">
                    <img src="./images/astrology.png" alt="">

                    <h6>Astro Nivesh</h6>
                    
                </div>

                <div class="right-navbar class-rel flex item-start gap">
                    <div class="navbar class-rel">
                    <nav class="nav class-rel">
                        <div class="nav-lists flex item-start">
                            <li><a href="#">Calendar</a></li>
                            <li><a href="#">Market</a></li>
                            <li><a href="#">Kundali</a></li>
                            <li><a href="#">Affirmations</a></li>
                            <li><a href="#">Runes</a></li>
                            <li><a href="#">Healing</a></li>
                            <li><a href="#">Wisdom</a></li>
                        </div>
                    </nav>
                </div>

                <div class="header-icons-flex-bx class-rel flex gap">

                    <a href="#">
                        <button class="headr-btn">
                            <ion-icon name="cart-outline"></ion-icon>
                            <span>Store</span>
                        </button>
                    </a>

                    <a href="#">
                        <button id="login_btn" class="headr-btn headr-btn2">
                            <ion-icon name="person"></ion-icon>
                            <span>Login</span>
                        </button>
                    </a>
                    
                </div>

                <button class="menu-bar-btn">
                    <i class="fa-solid fa-bars-staggered"></i>
                </button>
                
                </div>
                
            </div>
            
        </div>
     </header> -->

    <section class="top-header-comp">
        <div class="common-container3 top-header-flex flex item-between">
            <div class="left-header-logo flex item-start gap" onclick="window.location.href='home.html'">
                <img src="./images/astrology.png" alt="">

                <h6>Astro Nivesh</h6>

            </div>

            <div class="right-top-header-flex-bx flex item-start gap">

                <!--  <div class="top-hedr-bx flex item-center" style="cursor: pointer;" onclick="window.location.href='https://t.me/+gSZt6LQkFtRmYjBl'">
                    <div class="left-hedr-icon">
                        <ion-icon name="home"></ion-icon>
                    </div>
                    <div class="right-hedr-inof">
                        <h6>Reach Us</h6>
                        <span>601 , Ram Nagar Dewas</span>
                    </div>
                </div> -->

                 <div class="top-hedr-bx flex item-center" style="cursor: pointer;" onclick="window.location.href='https://t.me/+gSZt6LQkFtRmYjBl'">
                    <div class="left-hedr-icon">
                        <img style="width: 60%;" src="./images/telegram.png" alt="">
                    </div>
                    <div class="right-hedr-inof">
                        <h6>Talk to Us</h6>
                         
                    </div>
                </div>


                <button class="menu-bar-btn">
                    <ion-icon name="menu"></ion-icon>
                </button>

                <div class="cart-bx cart-bx2">
                    <button class="cart-btn cart-btn2" onclick="goToCart()">
                        <span class="qty" id="cart-count2">0</span>
                        <ion-icon name="bag"></ion-icon>
                    </button>
                </div>

                <button class="apnt-btn" onclick="window.location.href='appointments.html'">
                    Talk to Astrologer
                </button>

                <div class="profile-bx" id="login_btn">
                    <ion-icon name="person-circle-outline" size="large" color="#fe7000"></ion-icon>
                    <p id="profile-name">LogIn / Reg.</p>
                </div>

            </div>

        </div>
    </section>


    <header class="header">
        <div class="common-container3 header-flex flex item-between gap">

            <div class="nav-overlay"></div>
            <div class="navbar">

                <button class="close-nav-btn">
                    <ion-icon name="close-circle"></ion-icon>
                </button>

                <div class="left-header-logo flex item-start gap mob-logo" onclick="window.location.href='home.html'">
                    <img src="./images/astrology.png" alt="">

                    <h6>Astro Nivesh</h6>

                </div>

                <div class="search-inpt-bx search-inpt-bx-mob">
                    <input type="text" name="search" id="search" placeholder="Search here...">
                    <button class="search-btn">
                        <ion-icon name="search"></ion-icon>
                    </button>
                </div>

                <nav class="nav">
                    <div class="nav-lists flex item-start">
                        <li><a href="home.html">Home</a></li>
                        <li><a href="kundali.html">Kundali</a></li>
                        <li><a href="market.html">Market</a></li>
                        <li><a href="product.html">Astro Store</a></li>
                        <li><a href="pooja.html">Pooja</a></li>
                        <li>
                            <div class="category-item">
                                <div class="category-item-box">
                                    <p>Items</p>
                                </div>
                                <div class="dropdown">
                                    <p><a href="gochar.html" style="color: black;">Gochar</a></p>
                                    <p><a href="panchang.html" style="color: black;">Panchang</a></p>
                                    <p><a href="blogs.html" style="color: black;">Blog</a></p>

                                    <div class="healing-item">
                                        <div class="healing-item-box">
                                            <p>Healing <ion-icon name="chevron-forward-outline"></ion-icon></p>
                                        </div>
                                        <div class="healing-dropdown">
                                            <div class="healing">
                                                <p><a href="healing.html?stotra=1">Bhaktamar Stotra 1 </a></p>
                                                <p><a href="healing.html?stotra=2">Bhaktamar Stotra 2 </a></p>
                                                <p><a href="healing.html?stotra=3">Bhaktamar Stotra 3 </a></p>
                                                <p><a href="healing.html?stotra=4">Bhaktamar Stotra 4 </a></p>
                                                <p><a href="healing.html?stotra=5">Bhaktamar Stotra 5 </a></p>
                                                <p><a href="healing.html?stotra=6">Bhaktamar Stotra 6 </a></p>
                                                <p><a href="healing.html?stotra=7">Bhaktamar Stotra 7 </a></p>
                                                <p><a href="healing.html?stotra=8">Bhaktamar Stotra 8 </a></p>
                                                <p><a href="healing.html?stotra=9">Bhaktamar Stotra 9 </a></p>
                                                <p><a href="healing.html?stotra=10">Bhaktamar Stotra 10 </a></p>
                                                <p><a href="healing.html?stotra=11">Bhaktamar Stotra 11 </a></p>
                                                <p><a href="healing.html?stotra=12">Bhaktamar Stotra 12 </a></p>
                                                <p><a href="healing.html?stotra=13">Bhaktamar Stotra 13 </a></p>
                                                <p><a href="healing.html?stotra=14">Bhaktamar Stotra 14 </a></p>
                                                <p><a href="healing.html?stotra=15">Bhaktamar Stotra 15 </a></p>
                                                <p><a href="healing.html?stotra=16">Bhaktamar Stotra 16 </a></p>
                                                <p><a href="healing.html?stotra=17">Bhaktamar Stotra 17 </a></p>
                                                <p><a href="healing.html?stotra=18">Bhaktamar Stotra 18 </a></p>
                                                <p><a href="healing.html?stotra=19">Bhaktamar Stotra 19 </a></p>
                                                <p><a href="healing.html?stotra=20">Bhaktamar Stotra 20 </a></p>
                                                <p><a href="healing.html?stotra=21">Bhaktamar Stotra 21 </a></p>
                                                <p><a href="healing.html?stotra=22">Bhaktamar Stotra 22 </a></p>
                                                <p><a href="healing.html?stotra=23">Bhaktamar Stotra 23 </a></p>
                                                <p><a href="healing.html?stotra=24">Bhaktamar Stotra 24 </a></p>
                                                <p><a href="healing.html?stotra=25">Bhaktamar Stotra 25 </a></p>
                                                <p><a href="healing.html?stotra=26">Bhaktamar Stotra 26 </a></p>
                                                <p><a href="healing.html?stotra=27">Bhaktamar Stotra 27 </a></p>
                                                <p><a href="healing.html?stotra=28">Bhaktamar Stotra 28 </a></p>
                                                <p><a href="healing.html?stotra=29">Bhaktamar Stotra 29 </a></p>
                                                <p><a href="healing.html?stotra=30">Bhaktamar Stotra 30 </a></p>
                                                <p><a href="healing.html?stotra=31">Bhaktamar Stotra 31 </a></p>
                                                <p><a href="healing.html?stotra=32">Bhaktamar Stotra 32 </a></p>
                                                <p><a href="healing.html?stotra=33">Bhaktamar Stotra 33 </a></p>
                                                <p><a href="healing.html?stotra=34">Bhaktamar Stotra 34 </a></p>
                                                <p><a href="healing.html?stotra=35">Bhaktamar Stotra 35 </a></p>
                                                <p><a href="healing.html?stotra=36">Bhaktamar Stotra 36 </a></p>
                                                <p><a href="healing.html?stotra=37">Bhaktamar Stotra 37 </a></p>
                                                <p><a href="healing.html?stotra=38">Bhaktamar Stotra 38 </a></p>
                                                <p><a href="healing.html?stotra=39">Bhaktamar Stotra 39 </a></p>
                                                <p><a href="healing.html?stotra=40">Bhaktamar Stotra 40 </a></p>
                                                <p><a href="healing.html?stotra=41">Bhaktamar Stotra 41 </a></p>
                                                <p><a href="healing.html?stotra=42">Bhaktamar Stotra 42 </a></p>
                                                <p><a href="healing.html?stotra=43">Bhaktamar Stotra 43 </a></p>
                                                <p><a href="healing.html?stotra=44">Bhaktamar Stotra 44 </a></p>
                                                <p><a href="healing.html?stotra=45">Bhaktamar Stotra 45 </a></p>
                                                <p><a href="healing.html?stotra=46">Bhaktamar Stotra 46 </a></p>
                                                <p><a href="healing.html?stotra=47">Bhaktamar Stotra 47 </a></p>
                                                <p><a href="healing.html?stotra=48">Bhaktamar Stotra 48 </a></p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </li>
                    </div>
                </nav>

                <div class="astrology-cont-info">

                    <!--  <div class="top-hedr-bx flex item-center" style="cursor: pointer;" onclick="window.location.href='https://t.me/+gSZt6LQkFtRmYjBl'">
                        <div class="left-hedr-icon">
                            <ion-icon name="home"></ion-icon>
                        </div>
                        <div class="right-hedr-inof">
                            <h6>Reach Us</h6>
                            <span>601 , Ram Nagar Dewas</span>
                        </div>
                    </div> -->

                     <div class="top-hedr-bx flex item-center" style="cursor: pointer;" onclick="window.location.href='https://t.me/+gSZt6LQkFtRmYjBl'">
                        <div class="left-hedr-icon">
                            <img style="width: 60%;" src="./images/telegram.png" alt="">
                        </div>
                        <div class="right-hedr-inof">
                            <h6>Talk to Us</h6>
                             
                        </div>
                    </div>

                </div>


                <button class="apnt-btn apnt-btn-mob" onclick="window.location.href='appointments.html'">
                    Talk to Astrologer
                </button>

            </div>

            <div class="right-header-flex flex item-start ">
                <div class="search-inpt-bx">
                    <input type="text" name="search" id="search" placeholder="Search here...">
                    <button class="search-btn">
                        <ion-icon name="search"></ion-icon>
                    </button>
                </div>
                <div class="cart-bx">
                    <button class="cart-btn" onclick="goToCart()">
                        <span class="qty" id="cart-count">0</span>
                        <ion-icon name="bag"></ion-icon>
                    </button>
                </div>

            </div>

        </div>
    </header>

    <!-- _______________________
       Our Login Reg Comp 
       ------------------ -->

    <section class="login-reg-comp">

        <div class="login-bx ">

            <button class="close-form-btn">
                <i class="fa-solid fa-xmark"></i>
            </button>

            <div class="login-info">

                <div class="login-logo">
                    <img src="./images/astrology.png" alt="">
                </div>



                <div class="comn-heading">
                    <h4>Sign In to Astrology </h4>
                    <!-- <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Minima maxime est obcaecati.</p> -->
                </div>

                <div class="login-form">

                    <form onsubmit="handleSubmit(event)">

                        <div class="inpt-bx">
                            <label for="email">Email Address</label>
                            <div class="inpt">
                                <input type="email" id="email" name="email" placeholder="Enter your Email..."
                                    autocomplete="off" required>

                            </div>
                        </div>

                        <div class="inpt-bx">
                            <label for="email">Password</label>
                            <div class="inpt">
                                <input type="password" id="password" name="password"
                                    placeholder="Enter your password..." autocomplete="off" required>
                            </div>
                        </div>

                        <div class="form-btns-flex">

                            <button class="form-btn" type="submit">
                                Sign In
                            </button>

                            <button type="button" class="form-btn form-btn2" id="newAcnt">
                                Create Account
                            </button>

                        </div>
                        <div id="alert" class="alert"></div>


                    </form>


                </div>
            </div>

            <div class="reg-info">

                <div class="login-logo">
                    <img src="./images/astrology.png" alt="">
                </div>

                <div class="comn-heading">
                    <h4>Sign Up to Astrology </h4>
                    <!-- <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Minima maxime est obcaecati.</p> -->
                </div>

                <div class="login-form">
                    <form onsubmit="handleCreate(event)">

                        <div class="inpt-bx">
                            <label for="name">Name</label>
                            <div class="inpt">
                                <input type="text" name="cname" placeholder="Enter your Name" autocomplete="off"
                                    required>
                            </div>
                        </div>

                        <div class="inpt-bx">
                            <label for="name">Email</label>
                            <div class="inpt">
                                <input type="email" name="cemail" placeholder="Enter your email address..."
                                    autocomplete="off" required>
                            </div>
                        </div>

                        <div class="inpt-bx">
                            <label for="password">Create Password</label>
                            <div class="inpt">
                                <input type="text" name="ccreatepassword" placeholder="Create your password..."
                                    autocomplete="off" required>
                            </div>
                        </div>


                        <div class="inpt-bx">
                            <label for="password">Date Of Birth</label>
                            <div class="inpt">
                                <input type="text" id="calendarInput" name="calendarInput"
                                    placeholder="Choose a date" />
                            </div>
                        </div>

                        <div class="inpt-bx">
                            <label for="password">Birth Time</label>
                            <div class="inpt">
                                <input type="text" id="timePicker" name="timePicker" class="time-picker"
                                    placeholder="Select Time">
                            </div>
                        </div>
                        <div class="inpt-bx">
                            <label for="birthplace">Birth Place</label>
                            <div class="inpt">
                                <input type="text" name="birthplace" placeholder="Enter your Birth Place..."
                                    autocomplete="off" required>
                            </div>
                        </div>
                        <div class="inpt-bx">
                            <label for="consonent">Consonent of your name</label>
                            <div class="inpt">
                                <input type="text" name="consonent" placeholder="Enter your Consonent..."
                                    autocomplete="off" required>
                            </div>
                        </div>
                        <div class="inpt-bx">
                            <label for="vowel">Vowel of your name</label>
                            <div class="inpt">
                                <input type="text" name="vowel" placeholder="Enter your Vowel..." autocomplete="off"
                                    required>
                            </div>
                        </div>

                        <div class="form-btns-flex">

                            <button class="form-btn" type="submit">
                                Create Account
                            </button>

                            <button class="form-btn  form-btn3" type="button" id="signInBtn">
                                I Already Have Account
                            </button>

                        </div>

                    </form>


                </div>

            </div>
            <div class="profile-info">
                <div class="login-logo">
                    <img src="./images/astrology.png" alt="">
                </div>
                <div class="comn-heading">
                    <h4>Astro Nivesh</h4>
                </div>

                <div id="profile-body"></div>
                <a style=" display: flex; align-items: center; justify-content: center;  font-size: 18px; padding-top: 1rem;"
                    href="profile.html"><i class="fa-solid fa-user" style="margin-right: 10px;"></i>My Profile</a>
                <div class="logout-bx" id="logoutBox">
                    <p><ion-icon name="log-out"></ion-icon>Log Out</p>
                </div>
            </div>

        </div>

    </section>

    <!-- body section -->

    <section class="why-astrologer-comp">
        <div class="common-container3">

            <div class="comn-heading">
                <h3>Astrological Crypto Trend Score (ACTS)</h3>
                <p>Calculate price levels, derive dignities, manage scores, analyze crypto trends, and view detailed
                    weightages.</p>
            </div>

            <div class="table-data">
                <div class="price-levels-calculator-container">
                    <h6>Price Levels Calculator</h6>
                    <div class="price-levels-input-group">
                        <div>
                            <label for="priceLevelInputPrice" class="block text-sm font-medium text-gray-700 mb-1">Enter
                                Price:</label>
                            <input type="number" id="priceLevelInputPrice" step="0.01" placeholder="e.g., 100.00">
                        </div>
                        <div>
                            <label for="priceLevelCoinSelect"
                                class="block text-sm font-medium text-gray-700 mb-1">Select
                                Coin:</label> 
                            <select id="priceLevelCoinSelect">
                                <option value="">-- Select Coin --</option> 
                            </select>
                        </div>
                        <button id="calculatePriceLevelsButton" onclick="calculateAndDisplayPriceLevels()"
                            class="self-end">Calculate Levels & Chart</button>
                    </div>
                    <div class="table-container">
                        <h6 class="text-lg font-semibold text-center py-2 bg-gray-100 rounded-t-lg">Overall Perspective
                            Levels &
                            Targets (Based on Current Day Scores)</h6>
                        <table class="min-w-full price-levels-table">
                            <thead class="price-levels-table-header">
                                <tr>
                                    <th>Perspective</th>
                                    <th>Level Name</th>
                                    <th>Overall Weighted Score</th>
                                    <th>Calculated Level/Target</th>
                                </tr>
                            </thead>
                            <tbody id="priceLevelsTableBody">
                                <tr>
                                    <td colspan="4" class="loading-text">Enter price, select coin, and click "Calculate
                                        Levels".
                                        Planetary scores must be calculated or entered first.</td>
                                </tr> 
                            </tbody>
                        </table>
                    </div>

                    <div class="table-container mt-6">
                        <h6 id="individualPlanetLevelsTitle" class="individual-planet-levels-title">Individual Planet
                            Target
                            Prices for [Selected Coin] (Based on Current Day Scores)</h6> 
                        <table class="min-w-full price-levels-table">
                            <thead class="price-levels-table-header">
                                <tr>
                                    <th>Planet</th>
                                    <th>Perspective</th>
                                    <th>Weighted Planet Score</th>
                                    <th>Target Price</th>
                                </tr>
                            </thead>
                            <tbody id="individualPlanetPriceLevelsTableBody">
                                <tr>
                                    <td colspan="4" class="loading-text">Levels will appear here after calculation.</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div id="priceForecastChartContainer">
                    <h6 class="section-header text-xl mb-4">Price Forecast Chart (10-Day Astrological Projection)</h6>
                    <canvas id="priceForecastChart"></canvas>
                </div>

                <div id="tradingviewChartContainer">
                    <h6 class="section-header text-xl mb-4">Live Stock Chart (TradingView)</h6>
                    <div id="tv_chart_container" style="width: 100%; height: 400px;"></div>
                    <div class="text-center mt-2">
                        <label for="tvSymbolInput" class="text-sm font-medium text-gray-700 mr-2">TradingView
                            Symbol:</label>
                        <input type="text" id="tvSymbolInput" value="NSE:RELIANCE"
                            class="p-1 border-gray-300 rounded-md shadow-sm text-sm w-40">
                        <button onclick="loadTradingViewChart()"
                            class="ml-2 bg-blue-500 hover:bg-blue-600 text-white py-1 px-3 rounded-md text-sm">Load
                            Symbol</button>
                        <p class="tv-symbol-note">Examples: NSE:SBIN, BSE:TCS, NASDAQ:AAPL. Use symbol search in chart
                            if direct
                            load fails.</p>
                    </div>
                </div>


                <div class="mb-8" style="display: none;">
                    <h6 class="section-header">Step 1: Enter Current Planetary Positions</h6>
                    <p class="text-center text-gray-600 text-sm mb-2">Planetary positions below are automatically
                        fetched from
                        Gochar data. You can manually adjust them if needed before deriving dignities.</p>
                    <div class="bg-white shadow-xl rounded-lg table-container p-4">
                        <table class="min-w-full positions-table">
                            <thead class="positions-table-header">
                                <tr>
                                    <th>Planet</th>
                                    <th>Rashi (Sign)</th>
                                    <th>Nakshatra</th>
                                    <th>Nakshatra Pada</th>
                                </tr>
                            </thead>
                            <tbody id="planetaryPositionsInputBody">
                                <tr>
                                    <td colspan="4" class="loading-text">Fetching Gochar data for current day...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="mb-8" style="display: none;">
                    <h6 class="section-header">Step 1B: Enter Future Planetary Positions (Next 5 Days)</h6>
                    <p class="text-center text-gray-600 mb-2 text-sm">Positions below are automatically fetched from
                        Gochar data
                        for the next 5 days. Adjust if necessary.</p>
                    <p class="text-center text-gray-600 mb-4 text-xs">These impact the 10-day forecast chart (Days
                        6-10).</p>
                    <div id="futurePlanetaryPositionsContainer" class="future-day-tables-grid">
                        <div class="loading-text">Fetching Gochar data for future days...</div>
                    </div>
                    <div class="text-center mt-4">
                        <button id="deriveDignitiesButton" onclick="deriveAndPopulateDignities()"
                            class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-4 rounded-lg shadow-md">
                            Derive Dignities for Current Day & Populate Below
                        </button>
                    </div>
                </div>

                <div id="gochar-section" class="mb-8" style="display: none;">
                    <h6 class="section-header">Raw Gochar Data (for Today)</h6>
                    <div class="bg-white shadow-xl rounded-lg table-container p-4">
                        <table id="gocharTable" class="min-w-full positions-table">
                            <thead class="positions-table-header">
                                <tr>
                                    <th>Planet Name</th>
                                    <th>Rashi</th>
                                    <th>Nakshatra</th>
                                    <th>Pada</th>
                                    <th>Combust</th>
                                    <th>Motion</th>
                                    <th>Date of Entry</th>
                                    <th>Date of Exit</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td colspan="8" class="loading-text">Fetching raw Gochar data...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>


                <div class="mb-8" style="display: none;">
                    <h6 class="section-header">Step 2: Planetary Characteristics & Derived Dignities (Current Day)</h6>
                    <div class="bg-white shadow-xl rounded-lg table-container p-4">
                        <table class="min-w-full input-table">
                            <thead class="input-table-header">
                                <tr>
                                    <th>Planet</th>
                                    <th>Derived Rashi Dignity</th>
                                    <th>Derived Nakshatra Influence</th>
                                    <th>Derived Nakshatra Pada Dignity</th>
                                    <th>Derived Conj. Relation</th>
                                    <th>Retrograde?</th>
                                    <th>Combust?</th>
                                    <th>Auto Vedh By</th>
                                    <th>Auto Sparsh By</th>
                                </tr>
                            </thead>
                            <tbody id="planetaryInputsBody">
                                <tr>
                                    <td colspan="9" class="loading-text">Set positions in Step 1 and click "Derive
                                        Dignities...".</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="mb-8" style="display: none;">
                    <h6 class="section-header">Step 3: Timing Factors (Tithi & Moon Phase)</h6>
                    <div class="bg-white shadow-xl rounded-lg p-4 timing-factor-container">
                        <div>
                            <label for="tithiSelect" class="block text-sm font-medium text-gray-700 mb-1">Select
                                Tithi:</label>
                            <select id="tithiSelect" onchange="initiateScoreCalculation()">
                            </select>
                        </div>
                        <div>
                            <label for="moonPhaseSelect" class="block text-sm font-medium text-gray-700 mb-1">Select
                                Moon
                                Phase:</label>
                            <select id="moonPhaseSelect" onchange="initiateScoreCalculation()">
                            </select>
                        </div>
                    </div>
                </div>


                <div class="text-center mb-6" style="display: none;">
                    <button id="calculateButton" onclick="initiateScoreCalculation()"
                        class="bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 md:py-3 md:px-6 rounded-lg shadow-md transition duration-150 ease-in-out text-sm md:text-base">
                        Calculate All Scores & Update Market Trends/Levels/Chart
                    </button>
                </div>

                <div class="w-full mt-8">
                    <div class="bg-white shadow-xl rounded-lg table-container">
                        <h6 class="text-lg font-semibold text-center py-3 bg-gray-100 rounded-t-lg">Planetary Score
                            Results
                            (Current Day)</h6>
                        <p class="text-xs text-center text-gray-500 pb-2">Scores below can be manually adjusted. Market
                            trends
                            and Price Levels will update automatically.</p>
                        <table class="min-w-full results-table">
                            <thead class="table-header">
                                <tr>
                                    <th>Planet</th>
                                    <th>Rashi Dig.</th>
                                    <th>Nak. Influence</th>
                                    <th>Nak. Pada Dignity</th>
                                    <th>Relation (Conj.)</th>
                                    <th>Retro</th>
                                    <th>Combust</th>
                                    <th>Vedh (By)</th>
                                    <th>Sparsh (By)</th>
                                    <th>Rashi Total (Long-Term Base)</th>
                                    <th>Nak. Lord Total (Medium-Term Base)</th>
                                    <th>Pada Total (Short-Term Base)</th>
                                </tr>
                            </thead>
                            <tbody id="resultsBody">
                                <tr>
                                    <td colspan="12" class="loading-text">Enter data above and click "Calculate..."
                                        button.</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="w-full mt-8">
                    <div class="bg-white shadow-xl rounded-lg p-4 table-container">
                        <h6 class="text-lg font-semibold text-center py-3 bg-gray-100 rounded-t-lg">Astrological Climate
                            Trend
                            Score (ACTS)</h6>
                        <div id="actsScoresBody" class="p-4 text-left">
                            <div class="mb-3">
                                <p>Rashi Perspective ACTS: <strong id="actsRashiScore"
                                        class="total-score-neutral">N/A</strong>
                                </p>
                                <p class="acts-component">&nbsp;&nbsp;&nbsp;&Sigma;(P<sub>i</sub> &times;
                                    W<sub>i</sub>):
                                    <strong id="actsRashiPiWi" class="total-score-neutral">N/A</strong>
                                </p>
                            </div>
                            <div class="mb-3">
                                <p>Nakshatra Lord Perspective ACTS: <strong id="actsNlrScore"
                                        class="total-score-neutral">N/A</strong></p>
                                <p class="acts-component">&nbsp;&nbsp;&nbsp;&Sigma;(P<sub>i</sub> &times;
                                    W<sub>i</sub>):
                                    <strong id="actsNlrPiWi" class="total-score-neutral">N/A</strong>
                                </p>
                            </div>
                            <div class="mb-3">
                                <p>Pada Perspective ACTS: <strong id="actsPadaScore"
                                        class="total-score-neutral">N/A</strong>
                                </p>
                                <p class="acts-component">&nbsp;&nbsp;&nbsp;&Sigma;(P<sub>i</sub> &times;
                                    W<sub>i</sub>):
                                    <strong id="actsPadaPiWi" class="total-score-neutral">N/A</strong>
                                </p>
                            </div>
                            <hr class="my-3 border-gray-300">
                            <p>Overall Sign Modifier (S): <strong id="actsSignModifierS"
                                    class="total-score-neutral">N/A</strong></p>
                            <p>Moon Nakshatra Modifier (N): <strong id="actsNakshatraModifierN"
                                    class="total-score-neutral">N/A</strong></p>
                            <p>Timing Factor (T = Tithi + Moon Phase): <strong id="actsTimingFactorT"
                                    class="total-score-neutral">N/A</strong></p>
                            <p class="text-xs text-gray-500 mt-2">Formula: ACTS = &Sigma;(P<sub>i</sub> &times;
                                W<sub>i</sub>) +
                                &Sigma;S<sub>planet</sub> + N<sub>MoonNakshatra</sub> + T<sub>Tithi+MoonPhase</sub></p>
                        </div>
                    </div>
                </div>

                <div class="w-full mt-8">
                    <h6 class="section-header">Coin Astrological Affinity (Current Day)</h6>
                    <div class="bg-white shadow-xl rounded-lg p-4 table-container">
                        <div class="mb-4 flex items-center gap-2 justify-center">
                            <label for="filterCoinByPlanetSelect" class="text-sm font-medium text-gray-700">Filter by
                                Dominant
                                Planet:</label>
                            <select id="filterCoinByPlanetSelect" class="p-2 border-gray-300 rounded-md shadow-sm"
                                onchange="calculateAndDisplayCoinScores()">
                                <option value="all">Show All Coins</option>
                            </select>
                        </div>
                        <table class="min-w-full coin-affinity-table">
                            <thead class="table-header">
                                <tr>
                                    <th>Coin</th>
                                    <th>Category</th>
                                    <th>Dominant Planets (Profile)</th>
                                    <th>Rashi Affinity Score</th>
                                    <th>Nakshatra Affinity Score</th>
                                    <th>Pada Affinity Score</th>
                                </tr>
                            </thead>
                            <tbody id="coinScoresTableBody">
                                <tr>
                                    <td colspan="6" class="loading-text">Calculating coin affinities...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>


                <div class="w-full mt-8">
                    <header class="mb-6 text-center">
                        <h6 class="section-header crypto-page-title text-xl md:text-2xl font-bold text-gray-800">Crypto
                            Category
                            Astrological Trends (Based on Current Day Scores)</h6>
                        <p class="crypto-page-subtitle text-gray-600 mt-1">Trends are derived from the planetary scores
                            and
                            crypto category weightages.</p>
                    </header>

                    <div class="controls-main-container flex flex-wrap justify-center items-center gap-x-4 gap-y-3">
                        <div class="flex items-center gap-1">
                            <label for="filterPerspectiveCryptoCategory"
                                class="text-sm font-medium text-gray-700">Perspective:</label>
                            <select id="filterPerspectiveCryptoCategory"
                                class="p-2 border-gray-300 rounded-md shadow-sm">
                                <option value="any">Any</option>
                                <option value="long">Long-Term</option>
                                <option value="medium">Medium-Term</option>
                                <option value="short">Short-Term</option>
                            </select>
                        </div>
                        <div class="flex items-center gap-1">
                            <label for="filterTrendCryptoCategory"
                                class="text-sm font-medium text-gray-700">Trend:</label>
                            <select id="filterTrendCryptoCategory" class="p-2 border-gray-300 rounded-md shadow-sm">
                                <option value="all">All</option>
                                <option value="Strongly Bullish">Strongly Bullish</option>
                                <option value="Bullish">Bullish</option>
                                <option value="Neutral">Neutral</option>
                                <option value="Bearish">Bearish</option>
                                <option value="Strongly Bearish">Strongly Bearish</option>
                            </select>
                        </div>
                        <button id="applyFilterButtonCryptoCategory" onclick="applyFiltersAndSortCryptoCategory()"
                            class="bg-green-500 hover:bg-green-600 text-white py-2 px-4 rounded-md shadow-sm">Apply
                            Filters/Sort</button>
                        <button id="updateCryptoCategoryTrendsButton" onclick="initiateCryptoCategoryTrendCalculation()"
                            class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg shadow-md">
                            Refresh Crypto Category Trends
                        </button>
                    </div>

                    <div class="bg-white shadow-xl rounded-lg table-container">
                        <h6 class="text-lg font-semibold text-center py-3 bg-gray-100 rounded-t-lg">Crypto Category
                            Trend
                            Results</h6>
                        <table class="min-w-full crypto-category-results-table">
                            <thead class="crypto-category-table-header">
                                <tr>
                                    <th class="sticky left-0 bg-gray-700 z-10">Crypto Category</th>
                                    <th id="headerLongTermScoreCryptoCategory" class="sortable-header"
                                        data-sort-key="rashiScore">Rashi Score <span class="sort-indicator"></span></th>
                                    <th id="headerLongTermTrendCryptoCategory" class="sortable-header"
                                        data-sort-key="rashiTrend">Long-Term Trend <span class="sort-indicator"></span>
                                    </th>
                                    <th id="headerMediumTermScoreCryptoCategory" class="sortable-header"
                                        data-sort-key="nlrScore">Nak. Score <span class="sort-indicator"></span></th>
                                    <th id="headerMediumTermTrendCryptoCategory" class="sortable-header"
                                        data-sort-key="nlrTrend">Medium-Term Trend <span class="sort-indicator"></span>
                                    </th>
                                    <th id="headerShortTermScoreCryptoCategory" class="sortable-header"
                                        data-sort-key="padaScore">Pada Score <span class="sort-indicator"></span></th>
                                    <th id="headerShortTermTrendCryptoCategory" class="sortable-header"
                                        data-sort-key="padaTrend">Short-Term Trend (Swing) <span
                                            class="sort-indicator"></span>
                                    </th>
                                </tr>
                            </thead>
                            <tbody id="cryptoCategoryTrendsBody">
                                <tr>
                                    <td colspan="7" class="loading-text">Calculate planetary scores first to see crypto
                                        category
                                        trends.</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="w-full mt-8" style="display: none;">
                    <h6 class="section-header">Detailed Crypto Category Weightages</h6>
                    <p class="text-center text-gray-600 mb-4">This section shows the predefined weightages of each
                        planet for
                        various crypto categories, used in trend calculations.</p>
                    <div id="detailedWeightagesSection" class="weightage-grid-container">
                    </div>
                </div>

            </div>

            <div id="customModal" class="custom-modal-overlay">
                <div class="custom-modal-content">
                    <p id="customModalMessage">This is a custom alert message!</p>
                    <button id="customModalCloseButton">OK</button>
                </div>
            </div>

        </div>
    </section>


    <!-- ____________________________
          Our Footer Comp 
          -------------------- -->

    <footer class="footer-comp">
        <div class="common-container3">

            <div class="footer-flex-bx">

                <div class="left-footer-bx">

                    <div class="left-header-logo flex item-start gap">
                        <img src="./images/astrology.png" alt="" onclick="window.location.href='home.html'">

                        <h6>Astro Nivesh</h6>


                    </div>




                    <p>
                        Astro Nivesh is best astrology website for online Astrology predictions. Talk to Astrologer on
                        call and get answers to all your worries by seeing the future life through Astrology Kundli
                        Predictions from the best Astrologers from India. Get best future predictions related to
                        Marriage, love life, Career or Health over call, chat, queryorreport.
                    </p>

                </div>


                <div class="right-footer-bx">

                    <div class="footer-bx">
                        <h6>Corporate Info</h6>
                        <div class="footer-li">
                            <li><a href="aboutus.html">About Us</a></li>
                            <li><a href="contactus.html">Contact Us</a></li>
                            <li><a href="termsconditions.html">Terms & Conditions</a></li>
                            <li><a href="privacypolicy.html">Privacy Policy</a></li>
                            <!-- <li><a href="shippingpolicy.html">Shipping Policy</a></li> -->
                            <li><a href="refundpolicy.html">Refund Policy</a></li>
                        </div>
                    </div>


                    <div class="footer-bx">
                        <h6>Contact Info</h6>
                        <div class="footer-li">
                            <li><a href="#"> We are available 24x7 on chat support</a></li>
                            <li><a href="#">Email ID: contact@astronivesh.com</a></li>

                            <div class="soc-icons-flex">
                                <a href="#">
                                    <ion-icon name="logo-facebook"></ion-icon>
                                </a>
                                <a href="https://www.instagram.com/astro_nivesh/">
                                    <ion-icon name="logo-instagram"></ion-icon>
                                </a>
                               <a href="https://t.me/+gSZt6LQkFtRmYjBl">
                                    <img style="width: 50%;" src="./images/telegram (2).png" alt="">
                                </a>
                                <a href="https://www.youtube.com/@astronivesh">
                                    <ion-icon name="logo-youtube"></ion-icon>
                                </a>
                            </div>

                        </div>
                    </div>


                </div>

            </div>

            <div class="copyright-bx">
                <p>Copyright 2025 Astro Nivesh (This website is owned and managedby Shriram Lalasaheb Magar) | All
                    Rights Reserved | Dev. By: <a href="https://digitaldezire.com/">Digital Dezire</a></p>
            </div>
        </div>
    </footer>
    <script>
        const host = "https://api.astronivesh.com";
        const token = localStorage.getItem("token");
        async function fetchAllData() {
            try {
                const response = await fetch(`${host}/api/auth/getuser`, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "auth-token": token
                    }
                });

                if (!response.ok == true) {
                    throw new Error("Failed to fetch data");
                }

                const data = await response.json();
                // console.log(data, "data")
                populatePTable(data)
                populateName(data)
                // localStorage.setItem("admin_id", (data.map((entry) => (entry._id))))
            } catch (error) {
                console.error(error);
                // alert("Error fetching data: " + error.message);
            }
        }

        function populatePTable(data) {
            const tableBody = document.getElementById("profile-body");
            tableBody.innerHTML = "";

            tableBody.innerHTML = `
            <div class="profile-desc">
                <h4>${data.name}</h4>
            </div>
             
            `
        }
        function populateName(data) {
            const tableBody = document.getElementById("profile-name");
            tableBody.innerHTML = "";

            tableBody.innerHTML = `
            <p>${data.name}</p>
             
            `
        }
        document.addEventListener("DOMContentLoaded", function () {
            // console.log(token, "token")
            const loginForm = document.querySelector(".login-info");
            const regInfo = document.querySelector(".reg-info");
            const profileInfo = document.querySelector(".profile-info");

            if (token) {
                // User is logged in, show profile and hide login/signup forms
                loginForm.style.display = "none";
                regInfo.style.display = "none";
                profileInfo.style.display = "block";
            } else {
                // User is not logged in, show login/signup forms
                loginForm.style.display = "block";
                regInfo.style.display = "block";
                profileInfo.style.display = "none";
            }

            // Logout functionality
            const logoutBox = document.getElementById("logoutBox");
            if (logoutBox) {
                logoutBox.addEventListener("click", function () {
                    localStorage.removeItem("token");
                    localStorage.removeItem('params');
                    location.reload();
                    window.location.href = "./index.html";
                });
            }
        });
    </script>

    <script>
        // Populate table on page load
        window.onload = async () => {
            fetchAllData()
        };
    </script>

    <script>
        // --- Constants for Score Calculation (Comprehensive Set) ---
        const ALL_PLANETS = ["Sun", "Moon", "Mercury", "Venus", "Mars", "Jupiter", "Saturn", "Rahu", "Ketu", "Uranus"]; // Added Uranus

        // Define these early as they were reported as undefined
        const VEDH_CAUSING_PLANETS = ['Sun', 'Rahu', 'Ketu', 'Mars', 'Saturn', 'Uranus']; // Planets that cause Vedh (malefic aspect) - Added Uranus
        const SPARSH_CAUSING_PLANETS = ['Jupiter', 'Mercury', 'Venus', 'Moon']; // Planets that cause Sparsh (benefic aspect)


        const DIGNITY_SCORES_RASHI = {
            exalted: 1.00, moolatrikona: 0.75, own_house: 0.50, friends_house: 0.25,
            neutral_house: 0.00, enemies_house: -0.25, debilitated: -1.00, default_rashi: 0.00
        };
        const NAKSHATRA_INFLUENCE_SCORES = {
            exalted_nakshatra: 1.00, moolatrikona_nakshatra: 0.75, own_nakshatra: 0.50,
            friend_nlr: 0.25, neutral_nlr: 0.00, default_nlr: 0.00, enemy_nlr: -0.25,
            debilitated_nakshatra: -1.00
        };
        const NAKSHATRA_PADA_DIGNITY_SCORES = {
            "Exalted": 1.00, "Own": 0.50, "Friend": 0.25, "Neutral": 0.00,
            "Enemy": -0.25, "Debilitated": -1.00, "default_pada_dignity": 0.00
        };
        const RELATIONSHIP_SCORES = { best_friend: 0.3, friend: 0.2, neutral: 0.0, enemy: -0.2, bitter_enemy: -0.3, no_conjunction: 0.0 };
        const PLANET_RETROGRADE_SCORES = { Sun: 0.0, Moon: 0.0, Mercury: -0.1, Venus: -0.2, Mars: -0.2, Jupiter: -0.2, Saturn: -0.3, Rahu: 0.0, Ketu: 0.0, Uranus: -0.2 };
        const PLANET_COMBUST_SCORES = { Sun: 0.0, Moon: 0.0, Mercury: -0.1, Venus: -0.3, Mars: -0.2, Jupiter: -0.2, Saturn: -0.3, Rahu: 0.0, Ketu: 0.0, Uranus: -0.2 };
        const PLANET_ASPECT_STRENGTHS = { Sun: 1.0, Moon: 0.4, Mars: 0.7, Mercury: 0.5, Jupiter: 0.8, Venus: 0.6, Saturn: 0.9, Rahu: 0.6, Ketu: 0.5, Uranus: 0.6 };
        const BENEFIC_PLANETS = ["Jupiter", "Venus", "Mercury", "Moon"];
        const MALEFIC_PLANETS = ["Mars", "Saturn", "Rahu", "Ketu", "Sun", "Uranus"]; // Already included Uranus
        const DIGNITY_ASPECT_STRENGTH_FACTOR = 0.5;
        const RETRO_BENEFIC_SPARSH_MULTIPLIER = 0.8;
        const RETRO_MALEFIC_VEDH_MULTIPLIER = 1.2;
        const LEVEL_SENSITIVITY_FACTOR = 0.1;

        const ACTS_PLANET_WEIGHTS = { // Weights for Astrological Climate Trend Score
            "Uranus": 10, "Rahu": 8, "Mercury": 7, "Mars": 6, "Jupiter": 5,
            "Saturn": -6, "Ketu": -5, "Venus": 3,
            "Moon": 2, // Base weight, actual contribution is Pi_moon * 2
            "Sun": 2   // Base weight, actual contribution is Pi_sun * 2
        };

        const SIGN_MODIFIER_MATRIX = { // S values for ACTS based on planet in sign
            "Aries": { "Uranus": +2, "Saturn": -2, "Jupiter": +3, "Mercury": +3 },
            "Taurus": { "Uranus": +6, "Saturn": +1, "Jupiter": +5, "Mercury": +2 },
            "Gemini": { "Uranus": +4, "Saturn": 0, "Jupiter": +2, "Mercury": +6 },
            "Cancer": { "Uranus": -2, "Saturn": -3, "Jupiter": 0, "Mercury": -1 },
            "Leo": { "Uranus": +1, "Saturn": -1, "Jupiter": +2, "Mercury": 0 },
            "Virgo": { "Uranus": +1, "Saturn": +2, "Jupiter": 0, "Mercury": +4 },
            "Libra": { "Uranus": +3, "Saturn": +1, "Jupiter": +3, "Mercury": +3 },
            "Scorpio": { "Uranus": +2, "Saturn": -2, "Jupiter": -2, "Mercury": -1 },
            "Sagittarius": { "Uranus": +3, "Saturn": -1, "Jupiter": +6, "Mercury": +1 },
            "Capricorn": { "Uranus": 0, "Saturn": +6, "Jupiter": +1, "Mercury": 0 },
            "Aquarius": { "Uranus": +7, "Saturn": +5, "Jupiter": +2, "Mercury": +2 },
            "Pisces": { "Uranus": -1, "Saturn": -2, "Jupiter": +3, "Mercury": 0 }
        };

        const NAKSHATRA_MODIFIER_SCORES = { // N values for ACTS based on Moon's Nakshatra
            "Ashvini": +4, "Bharani": -3, "Krittika": +2, "Rohini": +3, "Mrigashira": +2,
            "Ardra": -4, "Punarvasu": +3, "Pushya": +4, "Ashlesha": -3, "Magha": +1,
            "PurvaPhalguni": +2, "UttaraPhalguni": +2, "Hasta": +3, "Chitra": +2, "Svati": +3,
            "Vishakha": +2, "Anuradha": +2, "Jyeshtha": -2, "Mula": -4, "PurvaShadha": +1,
            "UttaraShadha": +2, "Sravana": +2, "Dhanista": +3, "Shatabhisha": +4,
            "PurvaBhadra": -2, "UttaraBhadra": +2, "Revati": +3,
            "Abhijit": 0 // Assuming a neutral score for Abhijit if not specified
        };

        const TITHI_SCORES = {
            "Pratipada (1st)": +1, "Dvitiya (2nd)": +2, "Tritiya (3rd)": +2, "Chaturthi (4th)": -1,
            "Panchami (5th)": +2, "Shashthi (6th)": +2, "Saptami (7th)": +3, "Ashtami (8th)": -2,
            "Navami (9th)": -1, "Dashami (10th)": +2, "Ekadashi (11th)": +4, "Dwadashi (12th)": +3,
            "Trayodashi (13th)": +2, "Chaturdashi (14th)": -3, "Purnima/Amavasya (15th)": -4
        };

        const MOON_PHASE_SCORES = {
            "Amavasya": -2, "Shukla Paksha": +1, "Purnima": +2, "Krishan Paksha": 0
        };

        // --- PREDEFINED ASTROLOGICAL DATA for COINS ---
        const coinCategories = {
            'Binance Coin': 'Layer 1', 'Cardano': 'Layer 1', 'Polkadot': 'Layer 0', 'The Graph': 'Web3 Infra',
            'Filecoin': 'Storage', 'Render Token': 'AI', 'Axie Infinity': 'Gaming', 'Enjin Coin': 'Gaming',
            'Illuvium': 'Gaming', 'Tether': 'Stablecoin', 'Dai': 'Stablecoin', 'TrueUSD': 'Stablecoin',
            'Ethena USDe': 'Stablecoin', 'Monero': 'Privacy', 'TRON': 'Utility', 'Litecoin': 'Classic',
            'Hyperliquid': 'DEX', 'Solaxy': 'Energy', 'Pepe': 'Meme', 'Floki Inu': 'Meme', 'Dogelon Mars': 'Meme',
            'MIND of Pepe': 'Meme', 'BTC Bull Token': 'Leveraged', 'VeChain': 'Supply Chain',
            'Algorand': 'Smart Contract', 'Stacks': 'Bitcoin L2', 'Optimism': 'Ethereum L2',
            'Protocol AI': 'AI', 'Best Wallet Token': 'Wallet', 'SUBBD': 'Utility', 'Portuma': 'Advertising',
            'Metafluence': 'Influencer', 'Bitcoin': 'Layer 1', 'Ethereum': 'Layer 1', 'MATIC': 'Ethereum L2',
            'AAVE': 'DeFi', 'SHIB': 'Meme', 'NFT': 'NFT', 'Chainlink': 'Oracle', 'USDC': 'Stablecoin',
            'Dogecoin': 'Meme', 'APE': 'NFT', 'SAND': 'Metaverse', 'MANA': 'Metaverse',
            'Ripple': 'Payments', 'Solana': 'Layer 1', 'Cosmos': 'Layer 0', 'Avalanche': 'Layer 1'
        };

        const coinProfiles = {
            'Binance Coin': { Sun: 3, Jupiter: 2, Saturn: 1 },
            'Cardano': { Moon: 2, Mercury: 3, Jupiter: 1 },
            'Polkadot': { Uranus: 3, Saturn: 2, Mercury: 2 },
            'The Graph': { Mercury: 3, Uranus: 2, Jupiter: 2 },
            'Filecoin': { Saturn: 2, Uranus: 3, Mercury: 2 },
            'Render Token': { Venus: 3, Moon: 2, Rahu: 2 },
            'Axie Infinity': { Venus: 3, Moon: 2, Rahu: 2 },
            'Enjin Coin': { Venus: 2, Rahu: 2, Sun: 1 },
            'Illuvium': { Venus: 3, Rahu: 2, Mars: 2 },
            'Tether': { Saturn: 3, Venus: 2 },
            'Dai': { Saturn: 3, Mercury: 2 },
            'TrueUSD': { Saturn: 2, Jupiter: 1 },
            'Ethena USDe': { Saturn: 2, Uranus: 2 },
            'Monero': { Ketu: 3, Saturn: 2 },
            'TRON': { Mercury: 3, Venus: 2 },
            'Litecoin': { Jupiter: 2, Saturn: 1 },
            'Hyperliquid': { Uranus: 3, Mercury: 2 },
            'Solaxy': { Sun: 2, Uranus: 2 },
            'Pepe': { Rahu: 3, Venus: 2 },
            'Floki Inu': { Rahu: 3, Venus: 2 },
            'Dogelon Mars': { Rahu: 3, Moon: 1 },
            'MIND of Pepe': { Rahu: 2, Moon: 2 },
            'BTC Bull Token': { Jupiter: 2, Saturn: 2 },
            'VeChain': { Saturn: 3, Mercury: 2 },
            'Algorand': { Mercury: 3, Saturn: 2 },
            'Stacks': { Saturn: 2, Mars: 2 },
            'Optimism': { Uranus: 3, Jupiter: 2 },
            'Protocol AI': { Mercury: 3, Uranus: 3 },
            'Best Wallet Token': { Venus: 2, Mercury: 2 },
            'SUBBD': { Rahu: 2, Mercury: 2 },
            'Portuma': { Rahu: 2, Moon: 2 },
            'Metafluence': { Venus: 3, Rahu: 3 },
            'Bitcoin': { Uranus: 2, Mercury: 1, Saturn: 3, Jupiter: 2 },
            'Ethereum': { Uranus: 3, Mercury: 3, Rahu: 2, Jupiter: 2 },
            'MATIC': { Mercury: 3, Uranus: 2, Saturn: 1 },
            'AAVE': { Uranus: 3, Mercury: 2, Rahu: 2, Jupiter: 2 },
            'SHIB': { Rahu: 4, Mercury: 2 },
            'NFT': { Venus: 4, Rahu: 2 },
            'Chainlink': { Uranus: 3, Mercury: 3, Saturn: 2 },
            'USDC': { Saturn: 3, Venus: 2, Jupiter: 1 },
            'Dogecoin': { Rahu: 3, Moon: 2, Mercury: 2 },
            'APE': { Venus: 4, Rahu: 3, Moon: 2 },
            'SAND': { Venus: 3, Rahu: 2, Uranus: 2 },
            'MANA': { Venus: 3, Rahu: 2, Moon: 1 },
            'Ripple': { Saturn: 3, Mercury: 2, Venus: 1 },
            'Solana': { Mars: 3, Uranus: 2, Sun: 2 },
            'Cosmos': { Jupiter: 3, Uranus: 2, Mercury: 2 },
            'Avalanche': { Mars: 3, Uranus: 2, Jupiter: 2 }
        };


        const cryptoCategoryAdjustedWeights = { // Renamed from sectorAdjustedWeights
            'Layer 1': { Sun: 0.15, Moon: 0.1, Mercury: 0.2, Venus: 0.05, Mars: 0.1, Jupiter: 0.15, Saturn: 0.1, Rahu: 0.05, Ketu: 0.05, Uranus: 0.15 },
            'AI': { Mercury: 0.3, Uranus: 0.3, Jupiter: 0.1, Rahu: 0.1, Moon: 0.05, Venus: 0.05, Mars: 0.05, Saturn: 0.0, Sun: 0.0, Ketu: 0.05 },
            'Gaming': { Venus: 0.3, Mars: 0.25, Rahu: 0.2, Moon: 0.1, Mercury: 0.05, Jupiter: 0.05, Uranus: 0.05, Saturn: 0.0, Sun: 0.0, Ketu: 0.0 },
            'Meme': { Rahu: 0.4, Moon: 0.2, Venus: 0.15, Mercury: 0.1, Mars: 0.05, Sun: 0.0, Jupiter: 0.0, Saturn: 0.0, Uranus: 0.1, Ketu: 0.0 },
            'DeFi': { Uranus: 0.25, Mercury: 0.2, Jupiter: 0.2, Venus: 0.1, Saturn: 0.1, Rahu: 0.05, Moon: 0.05, Mars: 0.0, Sun: 0.0, Ketu: 0.0 },
            'Storage': { Saturn: 0.3, Uranus: 0.25, Mercury: 0.2, Moon: 0.1, Jupiter: 0.05, Rahu: 0.05, Venus: 0.0, Mars: 0.0, Sun: 0.0, Ketu: 0.05 },
            'Stablecoin': { Saturn: 0.4, Venus: 0.2, Jupiter: 0.1, Moon: 0.1, Mercury: 0.1, Sun: 0.05, Mars: 0.0, Rahu: 0.0, Ketu: 0.0, Uranus: 0.05 },
            'Oracle': { Uranus: 0.3, Mercury: 0.3, Saturn: 0.2, Jupiter: 0.1, Rahu: 0.1, Sun: 0.0, Moon: 0.0, Venus: 0.0, Mars: 0.0, Ketu: 0.0 },
            'NFT': { Venus: 0.4, Rahu: 0.2, Moon: 0.15, Uranus: 0.1, Mercury: 0.1, Sun: 0.05, Mars: 0.0, Jupiter: 0.0, Saturn: 0.0, Ketu: 0.0 },
            'Metaverse': { Venus: 0.3, Rahu: 0.2, Uranus: 0.2, Moon: 0.1, Mars: 0.1, Mercury: 0.1, Jupiter: 0.0, Saturn: 0.0, Sun: 0.0, Ketu: 0.0 }
        };

        const RASHI_NAMES = ["Aries", "Taurus", "Gemini", "Cancer", "Leo", "Virgo", "Libra", "Scorpio", "Sagittarius", "Capricorn", "Aquarius", "Pisces"];
        const RASHI_NUMBER_TO_NAME = {
            1: "Aries", 2: "Taurus", 3: "Gemini", 4: "Cancer", 5: "Leo", 6: "Virgo",
            7: "Libra", 8: "Scorpio", 9: "Sagittarius", 10: "Capricorn", 11: "Aquarius", 12: "Pisces"
        };
        const RASHI_LORDS = {
            "Aries": "Mars", "Taurus": "Venus", "Gemini": "Mercury", "Cancer": "Moon", "Leo": "Sun",
            "Virgo": "Mercury", "Libra": "Venus", "Scorpio": "Mars", "Sagittarius": "Jupiter",
            "Capricorn": "Saturn", "Aquarius": "Saturn", "Pisces": "Jupiter"
        };
        const nakshatraLords = {
            "Ashvini": "Ketu", "Bharani": "Venus", "Krittika": "Sun", "Rohini": "Moon",
            "Mrigashira": "Mars", "Ardra": "Rahu", "Punarvasu": "Jupiter", "Pushya": "Saturn",
            "Ashlesha": "Mercury", "Magha": "Ketu", "PurvaPhalguni": "Venus", "UttaraPhalguni": "Sun",
            "Hasta": "Moon", "Chitra": "Mars", "Svati": "Rahu", "Vishakha": "Jupiter",
            "Anuradha": "Saturn", "Jyeshtha": "Mercury", "Mula": "Ketu", "PurvaShadha": "Venus",
            "UttaraShadha": "Sun", "Sravana": "Moon", "Dhanista": "Mars", "Shatabhisha": "Rahu",
            "PurvaBhadra": "Jupiter", "UttaraBhadra": "Saturn", "Revati": "Mercury", "Abhijit": "Sun"
        };
        const VEDH_TABLES = {
            right: { 'Ashvini': 'Jyeshtha', 'Bharani': 'Anuradha', 'Krittika': 'Vishakha', 'Rohini': 'Svati', 'Mrigashira': 'Chitra', 'Ardra': 'Hasta', 'Punarvasu': 'UttaraPhalguni', 'Pushya': 'PurvaPhalguni', 'Ashlesha': 'Magha', 'Magha': 'Ashlesha', 'PurvaPhalguni': 'Pushya', 'UttaraPhalguni': 'Punarvasu', 'Hasta': 'Ardra', 'Chitra': 'Mrigashira', 'Svati': 'Rohini', 'Vishakha': 'Krittika', 'Anuradha': 'Bharani', 'Jyeshtha': 'Ashvini', 'Mula': 'Revati', 'PurvaShadha': 'UttaraBhadra', 'UttaraShadha': 'PurvaBhadra', 'Sravana': 'Dhanista', 'Dhanista': 'Sravana', 'Shatabhisha': 'Abhijit', 'PurvaBhadra': 'UttaraShadha', 'UttaraBhadra': 'PurvaShadha', 'Revati': 'Mula', 'Abhijit': 'PurvaPhalguni' },
            left: { 'Ashvini': 'Rohini', 'Bharani': 'Krittika', 'Krittika': 'Bharani', 'Rohini': 'Ashvini', 'Mrigashira': 'Revati', 'Ardra': 'UttaraBhadra', 'Punarvasu': 'PurvaBhadra', 'Pushya': 'Shatabhisha', 'Ashlesha': 'Dhanista', 'Magha': 'Sravana', 'PurvaPhalguni': 'Abhijit', 'UttaraPhalguni': 'UttaraShadha', 'Hasta': 'PurvaShadha', 'Chitra': 'Mula', 'Svati': 'Jyeshtha', 'Vishakha': 'Anuradha', 'Anuradha': 'Vishakha', 'Jyeshtha': 'Svati', 'Mula': 'Chitra', 'PurvaShadha': 'Hasta', 'UttaraShadha': 'UttaraPhalguni', 'Sravana': 'Magha', 'Dhanista': 'Ashlesha', 'Shatabhisha': 'Pushya', 'PurvaBhadra': 'Punarvasu', 'UttaraBhadra': 'Ardra', 'Revati': 'Mrigashira', 'Abhijit': 'Shatabhisha' },
            front: { 'Ashvini': 'PurvaPhalguni', 'Bharani': 'Magha', 'Krittika': 'Sravana', 'Rohini': 'Abhijit', 'Mrigashira': 'UttaraShadha', 'Ardra': 'PurvaShadha', 'Punarvasu': 'Mula', 'Pushya': 'Jyeshtha', 'Ashlesha': 'Anuradha', 'Magha': 'Bharani', 'PurvaPhalguni': 'Ashvini', 'UttaraPhalguni': 'Revati', 'Hasta': 'UttaraBhadra', 'Chitra': 'PurvaBhadra', 'Svati': 'Shatabhisha', 'Vishakha': 'Dhanista', 'Anuradha': 'Ashlesha', 'Jyeshtha': 'Pushya', 'Mula': 'Punarvasu', 'PurvaShadha': 'Ardra', 'UttaraShadha': 'Mrigashira', 'Sravana': 'Krittika', 'Dhanista': 'Vishakha', 'Shatabhisha': 'Svati', 'PurvaBhadra': 'Chitra', 'UttaraBhadra': 'Hasta', 'Revati': 'UttaraPhalguni', 'Abhijit': 'Rohini' }
        };
        const CANONICAL_NAKSHATRA_ORDER = ["Ashvini", "Bharani", "Krittika", "Rohini", "Mrigashira", "Ardra", "Punarvasu", "Pushya", "Ashlesha", "Magha", "PurvaPhalguni", "UttaraPhalguni", "Hasta", "Chitra", "Svati", "Vishakha", "Anuradha", "Jyeshtha", "Mula", "PurvaShadha", "UttaraShadha", "Abhijit", "Sravana", "Dhanista", "Shatabhisha", "PurvaBhadra", "UttaraBhadra", "Revati"];
        const MASTER_NAKSHATRA_LIST = [...CANONICAL_NAKSHATRA_ORDER];
        const NAKSHATRA_RASHI_PADA_DISTRIBUTION = {
            "Aries": [{ nakshatra: "Ashvini", padas: [1, 2, 3, 4] }, { nakshatra: "Bharani", padas: [1, 2, 3, 4] }, { nakshatra: "Krittika", padas: [1] }],
            "Taurus": [{ nakshatra: "Krittika", padas: [2, 3, 4] }, { nakshatra: "Rohini", padas: [1, 2, 3, 4] }, { nakshatra: "Mrigashira", padas: [1, 2] }],
            "Gemini": [{ nakshatra: "Mrigashira", padas: [3, 4] }, { nakshatra: "Ardra", padas: [1, 2, 3, 4] }, { nakshatra: "Punarvasu", padas: [1, 2, 3] }],
            "Cancer": [{ nakshatra: "Punarvasu", padas: [4] }, { nakshatra: "Pushya", padas: [1, 2, 3, 4] }, { nakshatra: "Ashlesha", padas: [1, 2, 3, 4] }],
            "Leo": [{ nakshatra: "Magha", padas: [1, 2, 3, 4] }, { nakshatra: "PurvaPhalguni", padas: [1, 2, 3, 4] }, { nakshatra: "UttaraPhalguni", padas: [1] }],
            "Virgo": [{ nakshatra: "UttaraPhalguni", padas: [2, 3, 4] }, { nakshatra: "Hasta", padas: [1, 2, 3, 4] }, { nakshatra: "Chitra", padas: [1, 2] }],
            "Libra": [{ nakshatra: "Chitra", padas: [3, 4] }, { nakshatra: "Svati", padas: [1, 2, 3, 4] }, { nakshatra: "Vishakha", padas: [1, 2, 3] }],
            "Scorpio": [{ nakshatra: "Vishakha", padas: [4] }, { nakshatra: "Anuradha", padas: [1, 2, 3, 4] }, { nakshatra: "Jyeshtha", padas: [1, 2, 3, 4] }],
            "Sagittarius": [{ nakshatra: "Mula", padas: [1, 2, 3, 4] }, { nakshatra: "PurvaShadha", padas: [1, 2, 3, 4] }, { nakshatra: "UttaraShadha", padas: [1] }],
            "Capricorn": [{ nakshatra: "UttaraShadha", padas: [2, 3, 4] }, { nakshatra: "Sravana", padas: [1, 2, 3, 4] }, { nakshatra: "Dhanista", padas: [1, 2] }],
            "Aquarius": [{ nakshatra: "Dhanista", padas: [3, 4] }, { nakshatra: "Shatabhisha", padas: [1, 2, 3, 4] }, { nakshatra: "PurvaBhadra", padas: [1, 2, 3] }],
            "Pisces": [{ nakshatra: "PurvaBhadra", padas: [4] }, { nakshatra: "UttaraBhadra", padas: [1, 2, 3, 4] }, { nakshatra: "Revati", padas: [1, 2, 3, 4] }]
        };
        const planetaryRelations = {
            "Sun": { friends: ["Moon", "Mars", "Jupiter"], enemies: ["Venus", "Saturn", "Uranus"], neutral: ["Mercury"] },
            "Moon": { friends: ["Sun", "Mercury"], enemies: ["Uranus"], neutral: ["Mars", "Jupiter", "Venus", "Saturn", "Rahu", "Ketu"] },
            "Mars": { friends: ["Sun", "Moon", "Jupiter"], enemies: ["Mercury"], neutral: ["Venus", "Saturn", "Rahu", "Ketu", "Uranus"] },
            "Mercury": { friends: ["Sun", "Venus", "Uranus"], enemies: ["Moon"], neutral: ["Mars", "Jupiter", "Saturn", "Rahu", "Ketu"] },
            "Jupiter": { friends: ["Sun", "Moon", "Mars"], enemies: ["Mercury", "Venus"], neutral: ["Saturn", "Rahu", "Ketu", "Uranus"] },
            "Venus": { friends: ["Mercury", "Saturn", "Uranus"], enemies: ["Sun", "Moon", "Jupiter"], neutral: ["Mars", "Rahu", "Ketu"] },
            "Saturn": { friends: ["Mercury", "Venus", "Uranus"], enemies: ["Sun", "Moon", "Mars"], neutral: ["Jupiter", "Rahu", "Ketu"] },
            "Rahu": { friends: ["Mercury", "Venus", "Saturn", "Uranus"], enemies: ["Sun", "Moon", "Mars"], neutral: ["Jupiter", "Ketu"] },
            "Ketu": { friends: ["Jupiter", "Mars"], enemies: ["Sun", "Moon", "Mercury"], neutral: ["Venus", "Saturn", "Rahu", "Uranus"] },
            "Uranus": { friends: ["Mercury", "Venus", "Saturn"], enemies: ["Sun", "Moon"], neutral: ["Mars", "Jupiter", "Rahu", "Ketu"] }
        };
        const PLANET_DIGNITIES_IN_RASHI = {
            "Sun": { exaltedRashi: 1, debilitatedRashi: 7, moolatrikonaRashi: 5, ownRashi: [5] },
            "Moon": { exaltedRashi: 2, debilitatedRashi: 8, moolatrikonaRashi: 2, ownRashi: [4] },
            "Mars": { exaltedRashi: 10, debilitatedRashi: 4, moolatrikonaRashi: 1, ownRashi: [1, 8] },
            "Mercury": { exaltedRashi: 6, debilitatedRashi: 12, moolatrikonaRashi: 6, ownRashi: [3, 6] },
            "Jupiter": { exaltedRashi: 4, debilitatedRashi: 10, moolatrikonaRashi: 9, ownRashi: [9, 12] },
            "Venus": { exaltedRashi: 12, debilitatedRashi: 6, moolatrikonaRashi: 7, ownRashi: [2, 7] },
            "Saturn": { exaltedRashi: 7, debilitatedRashi: 1, moolatrikonaRashi: 11, ownRashi: [10, 11] },
            "Rahu": { exaltedRashi: 2, debilitatedRashi: 8, moolatrikonaRashi: 3, ownRashi: [6, 11] },
            "Ketu": { exaltedRashi: 8, debilitatedRashi: 2, moolatrikonaRashi: 9, ownRashi: [12, 3] },
            "Uranus": { exaltedRashi: null, debilitatedRashi: null, moolatrikonaRashi: null, ownRashi: [11] }
        };
        const ucchaNeechaNakshatraPada = {
            "Sun": { exalted: { nakshatra: "Bharani", pada: 2 }, debilitated: { nakshatra: "Svati", pada: 1 } },
            "Moon": { exalted: { nakshatra: "Krittika", pada: 1 }, debilitated: { nakshatra: "Anuradha", pada: 4 } },
            "Mars": { exalted: { nakshatra: "Dhanista", pada: 1 }, debilitated: { nakshatra: "Pushya", pada: 4 } },
            "Mercury": { exalted: { nakshatra: "Hasta", pada: 3 }, debilitated: { nakshatra: "Revati", pada: 4 } },
            "Jupiter": { exalted: { nakshatra: "Punarvasu", pada: 4 }, debilitated: { nakshatra: "UttaraShadha", pada: 1 } },
            "Venus": { exalted: { nakshatra: "Revati", pada: 1 }, debilitated: { nakshatra: "Chitra", pada: 3 } },
            "Saturn": { exalted: { nakshatra: "Svati", pada: 3 }, debilitated: { nakshatra: "Ashvini", pada: 4 } },
            "Rahu": { exalted: { nakshatra: "Ardra", pada: 4 }, debilitated: { nakshatra: "Mula", pada: 1 } },
            "Ketu": { exalted: { nakshatra: "Mula", pada: 4 }, debilitated: { nakshatra: "Ardra", pada: 1 } },
            "Uranus": { exalted: null, debilitated: null }
        };
        const PLANET_PADA_DIGNITIES_DATA = {
            "Sun": [{ "nakshatra": "Ashvini", "pada": 1, "navamsa": "Aries", "status": "Exalted" }, { "nakshatra": "Ashvini", "pada": 2, "navamsa": "Taurus", "status": "Neutral" }, { "nakshatra": "Ashvini", "pada": 3, "navamsa": "Gemini", "status": "Neutral" }, { "nakshatra": "Ashvini", "pada": 4, "navamsa": "Cancer", "status": "Neutral" }, { "nakshatra": "Bharani", "pada": 1, "navamsa": "Leo", "status": "Own" }, { "nakshatra": "Bharani", "pada": 2, "navamsa": "Virgo", "status": "Neutral" }, { "nakshatra": "Bharani", "pada": 3, "navamsa": "Libra", "status": "Debilitated" }, { "nakshatra": "Bharani", "pada": 4, "navamsa": "Scorpio", "status": "Neutral" }, { "nakshatra": "Krittika", "pada": 1, "navamsa": "Sagittarius", "status": "Friend" }, { "nakshatra": "Krittika", "pada": 2, "navamsa": "Capricorn", "status": "Neutral" }, { "nakshatra": "Krittika", "pada": 3, "navamsa": "Aquarius", "status": "Enemy" }, { "nakshatra": "Krittika", "pada": 4, "navamsa": "Pisces", "status": "Neutral" }, { "nakshatra": "Rohini", "pada": 1, "navamsa": "Aries", "status": "Exalted" }, { "nakshatra": "Rohini", "pada": 2, "navamsa": "Taurus", "status": "Neutral" }, { "nakshatra": "Rohini", "pada": 3, "navamsa": "Gemini", "status": "Neutral" }, { "nakshatra": "Rohini", "pada": 4, "navamsa": "Cancer", "status": "Neutral" }, { "nakshatra": "Mrigashira", "pada": 1, "navamsa": "Leo", "status": "Own" }, { "nakshatra": "Mrigashira", "pada": 2, "navamsa": "Virgo", "status": "Neutral" }, { "nakshatra": "Mrigashira", "pada": 3, "navamsa": "Libra", "status": "Debilitated" }, { "nakshatra": "Mrigashira", "pada": 4, "navamsa": "Scorpio", "status": "Neutral" }, { "nakshatra": "Ardra", "pada": 1, "navamsa": "Sagittarius", "status": "Friend" }, { "nakshatra": "Ardra", "pada": 2, "navamsa": "Capricorn", "status": "Neutral" }, { "nakshatra": "Ardra", "pada": 3, "navamsa": "Aquarius", "status": "Enemy" }, { "nakshatra": "Ardra", "pada": 4, "navamsa": "Pisces", "status": "Neutral" }, { "nakshatra": "Punarvasu", "pada": 1, "navamsa": "Aries", "status": "Exalted" }, { "nakshatra": "Punarvasu", "pada": 2, "navamsa": "Taurus", "status": "Neutral" }, { "nakshatra": "Punarvasu", "pada": 3, "navamsa": "Gemini", "status": "Neutral" }, { "nakshatra": "Punarvasu", "pada": 4, "navamsa": "Cancer", "status": "Neutral" }, { "nakshatra": "Pushya", "pada": 1, "navamsa": "Leo", "status": "Own" }, { "nakshatra": "Pushya", "pada": 2, "navamsa": "Virgo", "status": "Neutral" }, { "nakshatra": "Pushya", "pada": 3, "navamsa": "Libra", "status": "Debilitated" }, { "nakshatra": "Pushya", "pada": 4, "navamsa": "Scorpio", "status": "Neutral" }, { "nakshatra": "Ashlesha", "pada": 1, "navamsa": "Sagittarius", "status": "Friend" }, { "nakshatra": "Ashlesha", "pada": 2, "navamsa": "Capricorn", "status": "Neutral" }, { "nakshatra": "Ashlesha", "pada": 3, "navamsa": "Aquarius", "status": "Enemy" }, { "nakshatra": "Ashlesha", "pada": 4, "navamsa": "Pisces", "status": "Neutral" }, { "nakshatra": "Magha", "pada": 1, "navamsa": "Aries", "status": "Exalted" }, { "nakshatra": "Magha", "pada": 2, "navamsa": "Taurus", "status": "Neutral" }, { "nakshatra": "Magha", "pada": 3, "navamsa": "Gemini", "status": "Neutral" }, { "nakshatra": "Magha", "pada": 4, "navamsa": "Cancer", "status": "Neutral" }, { "nakshatra": "PurvaPhalguni", "pada": 1, "navamsa": "Leo", "status": "Own" }, { "nakshatra": "PurvaPhalguni", "pada": 2, "navamsa": "Virgo", "status": "Neutral" }, { "nakshatra": "PurvaPhalguni", "pada": 3, "navamsa": "Libra", "status": "Debilitated" }, { "nakshatra": "PurvaPhalguni", "pada": 4, "navamsa": "Scorpio", "status": "Neutral" }, { "nakshatra": "UttaraPhalguni", "pada": 1, "navamsa": "Sagittarius", "status": "Friend" }, { "nakshatra": "UttaraPhalguni", "pada": 2, "navamsa": "Capricorn", "status": "Neutral" }, { "nakshatra": "UttaraPhalguni", "pada": 3, "navamsa": "Aquarius", "status": "Enemy" }, { "nakshatra": "UttaraPhalguni", "pada": 4, "navamsa": "Pisces", "status": "Neutral" }, { "nakshatra": "Hasta", "pada": 1, "navamsa": "Aries", "status": "Exalted" }, { "nakshatra": "Hasta", "pada": 2, "navamsa": "Taurus", "status": "Neutral" }, { "nakshatra": "Hasta", "pada": 3, "navamsa": "Gemini", "status": "Neutral" }, { "nakshatra": "Hasta", "pada": 4, "navamsa": "Cancer", "status": "Neutral" }, { "nakshatra": "Chitra", "pada": 1, "navamsa": "Leo", "status": "Own" }, { "nakshatra": "Chitra", "pada": 2, "navamsa": "Virgo", "status": "Neutral" }, { "nakshatra": "Chitra", "pada": 3, "navamsa": "Libra", "status": "Debilitated" }, { "nakshatra": "Chitra", "pada": 4, "navamsa": "Scorpio", "status": "Neutral" }, { "nakshatra": "Svati", "pada": 1, "navamsa": "Sagittarius", "status": "Friend" }, { "nakshatra": "Svati", "pada": 2, "navamsa": "Capricorn", "status": "Neutral" }, { "nakshatra": "Svati", "pada": 3, "navamsa": "Aquarius", "status": "Enemy" }, { "nakshatra": "Svati", "pada": 4, "navamsa": "Pisces", "status": "Neutral" }, { "nakshatra": "Vishakha", "pada": 1, "navamsa": "Aries", "status": "Exalted" }, { "nakshatra": "Vishakha", "pada": 2, "navamsa": "Taurus", "status": "Neutral" }, { "nakshatra": "Vishakha", "pada": 3, "navamsa": "Gemini", "status": "Neutral" }, { "nakshatra": "Vishakha", "pada": 4, "navamsa": "Cancer", "status": "Neutral" }, { "nakshatra": "Anuradha", "pada": 1, "navamsa": "Leo", "status": "Own" }, { "nakshatra": "Anuradha", "pada": 2, "navamsa": "Virgo", "status": "Neutral" }, { "nakshatra": "Anuradha", "pada": 3, "navamsa": "Libra", "status": "Debilitated" }, { "nakshatra": "Anuradha", "pada": 4, "navamsa": "Scorpio", "status": "Neutral" }, { "nakshatra": "Jyeshtha", "pada": 1, "navamsa": "Sagittarius", "status": "Friend" }, { "nakshatra": "Jyeshtha", "pada": 2, "navamsa": "Capricorn", "status": "Neutral" }, { "nakshatra": "Jyeshtha", "pada": 3, "navamsa": "Aquarius", "status": "Enemy" }, { "nakshatra": "Jyeshtha", "pada": 4, "navamsa": "Pisces", "status": "Neutral" }, { "nakshatra": "Mula", "pada": 1, "navamsa": "Aries", "status": "Exalted" }, { "nakshatra": "Mula", "pada": 2, "navamsa": "Taurus", "status": "Neutral" }, { "nakshatra": "Mula", "pada": 3, "navamsa": "Gemini", "status": "Neutral" }, { "nakshatra": "Mula", "pada": 4, "navamsa": "Cancer", "status": "Neutral" }, { "nakshatra": "PurvaShadha", "pada": 1, "navamsa": "Leo", "status": "Own" }, { "nakshatra": "PurvaShadha", "pada": 2, "navamsa": "Virgo", "status": "Neutral" }, { "nakshatra": "PurvaShadha", "pada": 3, "navamsa": "Libra", "status": "Debilitated" }, { "nakshatra": "PurvaShadha", "pada": 4, "navamsa": "Scorpio", "status": "Neutral" }, { "nakshatra": "UttaraShadha", "pada": 1, "navamsa": "Sagittarius", "status": "Friend" }, { "nakshatra": "UttaraShadha", "pada": 2, "navamsa": "Capricorn", "status": "Neutral" }, { "nakshatra": "UttaraShadha", "pada": 3, "navamsa": "Aquarius", "status": "Enemy" }, { "nakshatra": "UttaraShadha", "pada": 4, "navamsa": "Pisces", "status": "Neutral" }, { "nakshatra": "Sravana", "pada": 1, "navamsa": "Aries", "status": "Exalted" }, { "nakshatra": "Sravana", "pada": 2, "navamsa": "Taurus", "status": "Neutral" }, { "nakshatra": "Sravana", "pada": 3, "navamsa": "Gemini", "status": "Neutral" }, { "nakshatra": "Sravana", "pada": 4, "navamsa": "Cancer", "status": "Neutral" }, { "nakshatra": "Dhanista", "pada": 1, "navamsa": "Leo", "status": "Own" }, { "nakshatra": "Dhanista", "pada": 2, "navamsa": "Virgo", "status": "Neutral" }, { "nakshatra": "Dhanista", "pada": 3, "navamsa": "Libra", "status": "Debilitated" }, { "nakshatra": "Dhanista", "pada": 4, "navamsa": "Scorpio", "status": "Neutral" }, { "nakshatra": "Shatabhisha", "pada": 1, "navamsa": "Sagittarius", "status": "Friend" }, { "nakshatra": "Shatabhisha", "pada": 2, "navamsa": "Capricorn", "status": "Neutral" }, { "nakshatra": "Shatabhisha", "pada": 3, "navamsa": "Aquarius", "status": "Enemy" }, { "nakshatra": "Shatabhisha", "pada": 4, "navamsa": "Pisces", "status": "Neutral" }, { "nakshatra": "PurvaBhadra", "pada": 1, "navamsa": "Aries", "status": "Exalted" }, { "nakshatra": "PurvaBhadra", "pada": 2, "navamsa": "Taurus", "status": "Neutral" }, { "nakshatra": "PurvaBhadra", "pada": 3, "navamsa": "Gemini", "status": "Neutral" }, { "nakshatra": "PurvaBhadra", "pada": 4, "navamsa": "Cancer", "status": "Neutral" }, { "nakshatra": "UttaraBhadra", "pada": 1, "navamsa": "Leo", "status": "Own" }, { "nakshatra": "UttaraBhadra", "pada": 2, "navamsa": "Virgo", "status": "Neutral" }, { "nakshatra": "UttaraBhadra", "pada": 3, "navamsa": "Libra", "status": "Debilitated" }, { "nakshatra": "UttaraBhadra", "pada": 4, "navamsa": "Scorpio", "status": "Neutral" }, { "nakshatra": "Revati", "pada": 1, "navamsa": "Sagittarius", "status": "Friend" }, { "nakshatra": "Revati", "pada": 2, "navamsa": "Capricorn", "status": "Neutral" }, { "nakshatra": "Revati", "pada": 3, "navamsa": "Aquarius", "status": "Enemy" }, { "nakshatra": "Revati", "pada": 4, "navamsa": "Pisces", "status": "Neutral" }],
            "Moon": MASTER_NAKSHATRA_LIST.flatMap(nak => [1, 2, 3, 4].map(pad => ({ nakshatra: nak, pada: pad, navamsa: RASHI_NAMES[((MASTER_NAKSHATRA_LIST.indexOf(nak) * 4 + pad - 1) % 12)], status: "Neutral" }))),
            "Mars": MASTER_NAKSHATRA_LIST.flatMap(nak => [1, 2, 3, 4].map(pad => ({ nakshatra: nak, pada: pad, navamsa: RASHI_NAMES[((MASTER_NAKSHATRA_LIST.indexOf(nak) * 4 + pad - 1) % 12)], status: "Neutral" }))),
            "Mercury": MASTER_NAKSHATRA_LIST.flatMap(nak => [1, 2, 3, 4].map(pad => ({ nakshatra: nak, pada: pad, navamsa: RASHI_NAMES[((MASTER_NAKSHATRA_LIST.indexOf(nak) * 4 + pad - 1) % 12)], status: "Neutral" }))),
            "Jupiter": MASTER_NAKSHATRA_LIST.flatMap(nak => [1, 2, 3, 4].map(pad => ({ nakshatra: nak, pada: pad, navamsa: RASHI_NAMES[((MASTER_NAKSHATRA_LIST.indexOf(nak) * 4 + pad - 1) % 12)], status: "Neutral" }))),
            "Venus": MASTER_NAKSHATRA_LIST.flatMap(nak => [1, 2, 3, 4].map(pad => ({ nakshatra: nak, pada: pad, navamsa: RASHI_NAMES[((MASTER_NAKSHATRA_LIST.indexOf(nak) * 4 + pad - 1) % 12)], status: "Neutral" }))),
            "Saturn": MASTER_NAKSHATRA_LIST.flatMap(nak => [1, 2, 3, 4].map(pad => ({ nakshatra: nak, pada: pad, navamsa: RASHI_NAMES[((MASTER_NAKSHATRA_LIST.indexOf(nak) * 4 + pad - 1) % 12)], status: "Neutral" }))),
            "Rahu": MASTER_NAKSHATRA_LIST.flatMap(nak => [1, 2, 3, 4].map(pad => ({ nakshatra: nak, pada: pad, navamsa: RASHI_NAMES[((MASTER_NAKSHATRA_LIST.indexOf(nak) * 4 + pad - 1) % 12)], status: "Neutral" }))),
            "Ketu": MASTER_NAKSHATRA_LIST.flatMap(nak => [1, 2, 3, 4].map(pad => ({ nakshatra: nak, pada: pad, navamsa: RASHI_NAMES[((MASTER_NAKSHATRA_LIST.indexOf(nak) * 4 + pad - 1) % 12)], status: "Neutral" }))),
            "Uranus": MASTER_NAKSHATRA_LIST.flatMap(nak => [1, 2, 3, 4].map(pad => ({ nakshatra: nak, pada: pad, navamsa: RASHI_NAMES[((MASTER_NAKSHATRA_LIST.indexOf(nak) * 4 + pad - 1) % 12)], status: "Neutral" }))) // Default for Uranus
        };
        const INITIAL_PLANETARY_POSITIONS = ALL_PLANETS.map(planetName => ({
            name: planetName, rashiNumber: null, nakshatraName: null, nakshatraPada: null, isRetrograde: false, isCombust: false,
            relationshipKey: "no_conjunction", vedhBy: [], sparshBy: [],
            derivedRashiDignityKey: 'default_rashi', derivedNakshatraInfluenceKey: 'default_nlr',
            derivedNakshatraPadaDignityKey: 'default_pada_dignity', derivedConjunctionKey: 'no_conjunction'
        }));
        // const host = "https://api.astronivesh.com";
        const urlParams = new URLSearchParams(window.location.search);
        // let token = urlParams.get('token') || localStorage.getItem("token");
        let fetchedCurrentDayPositions = null;
        let fetchedFutureDaysPositions = [];
        let CURRENT_PLANETARY_CHARACTERISTICS = JSON.parse(JSON.stringify(INITIAL_PLANETARY_POSITIONS));
        let currentPlanetaryScoresForMarket = {};
        let futurePlanetaryScoresData = [];
        const resultsBody = document.getElementById('resultsBody');
        const calculateButton = document.getElementById('calculateButton');
        const planetaryInputsBody = document.getElementById('planetaryInputsBody');
        const planetaryPositionsInputBody = document.getElementById('planetaryPositionsInputBody');
        const futurePlanetaryPositionsContainer = document.getElementById('futurePlanetaryPositionsContainer');
        const cryptoCategoryTrendsBody = document.getElementById('cryptoCategoryTrendsBody'); // Renamed
        const updateCryptoCategoryTrendsButton = document.getElementById('updateCryptoCategoryTrendsButton'); // Renamed
        const filterPerspectiveCryptoCategory = document.getElementById('filterPerspectiveCryptoCategory'); // Renamed
        const filterTrendCryptoCategory = document.getElementById('filterTrendCryptoCategory'); // Renamed
        const applyFilterButtonCryptoCategory = document.getElementById('applyFilterButtonCryptoCategory'); // Renamed
        const detailedWeightagesSection = document.getElementById('detailedWeightagesSection');
        const priceLevelInputPrice = document.getElementById('priceLevelInputPrice');
        const priceLevelCoinSelect = document.getElementById('priceLevelCoinSelect'); // UPDATED ID
        const priceLevelsTableBody = document.getElementById('priceLevelsTableBody');
        const individualPlanetPriceLevelsTableBody = document.getElementById('individualPlanetPriceLevelsTableBody');
        const individualPlanetLevelsTitle = document.getElementById('individualPlanetLevelsTitle');
        const calculatePriceLevelsButton = document.getElementById('calculatePriceLevelsButton');
        let priceForecastChartInstance = null;
        let tvWidgetInstance = null;
        const customModal = document.getElementById('customModal');
        const customModalMessage = document.getElementById('customModalMessage');
        const customModalCloseButton = document.getElementById('customModalCloseButton');
        const tithiSelect = document.getElementById('tithiSelect');
        const moonPhaseSelect = document.getElementById('moonPhaseSelect');
        const filterCoinByPlanetSelect = document.getElementById('filterCoinByPlanetSelect');
        const coinScoresTableBody = document.getElementById('coinScoresTableBody');


        function standardizeNakshatraName(name) {
            if (!name) return null;
            const originalNameForLog = String(name);
            const sNameTrimmed = String(name).trim();
            if (["UttaraBhadra", "PurvaBhadra", "Uttara Bhadra", "Purva Bhadra", "Uttarabhadra", "Purvabhadra"].includes(sNameTrimmed)) {
                // console.log(`DEBUG: standardizeNakshatraName - INPUT for specific check: '${originalNameForLog}', Trimmed: '${sNameTrimmed}'`);
            }
            if (MASTER_NAKSHATRA_LIST.includes(sNameTrimmed)) {
                if (["UttaraBhadra", "PurvaBhadra"].includes(sNameTrimmed)) 
                // console.log(`DEBUG: standardizeNakshatraName - Direct Match for '${sNameTrimmed}'`);
                return sNameTrimmed;
            }
            const sNameLowerNospace = sNameTrimmed.replace(/\s+/g, '').toLowerCase();
            const knownVariations = {
                "ashwini": "Ashvini", "purvaphalguni": "PurvaPhalguni", "poorvaphalguni": "PurvaPhalguni",
                "uttaraphalguni": "UttaraPhalguni", "uttarphalguni": "UttaraPhalguni",
                "purvaashadha": "PurvaShadha", "purvashada": "PurvaShadha",
                "uttaraashadha": "UttaraShadha", "uttarashada": "UttaraShadha",
                "purvabhadrapada": "PurvaBhadra", "poorvabhadrapada": "PurvaBhadra", "purvabhadra": "PurvaBhadra",
                "uttarabhadrapada": "UttaraBhadra", "uttarbhadrapada": "UttaraBhadra", "uttarabhadra": "UttaraBhadra",
                "sravana": "Sravana", "shravana": "Sravana", "dhanishta": "Dhanista",
                "shatabhisha": "Shatabhisha", "mrigasira": "Mrigashira", "mrigashirsha": "Mrigashira", "mrigasirsa": "Mrigashira"
            };
            if (knownVariations[sNameLowerNospace]) {
                if (["UttaraBhadra", "PurvaBhadra"].includes(knownVariations[sNameLowerNospace])) console.log(`DEBUG: standardizeNakshatraName - Known Variation Match for '${originalNameForLog}' to '${knownVariations[sNameLowerNospace]}'`);
                return knownVariations[sNameLowerNospace];
            }
            const sNameTrimmedLower = sNameTrimmed.toLowerCase();
            const masterListLower = MASTER_NAKSHATRA_LIST.map(n => n.toLowerCase());
            const masterIndex = masterListLower.indexOf(sNameTrimmedLower);
            if (masterIndex !== -1) {
                const canonicalName = MASTER_NAKSHATRA_LIST[masterIndex];
                if (["UttaraBhadra", "PurvaBhadra"].includes(canonicalName)) console.log(`DEBUG: standardizeNakshatraName - Case-Insensitive Match for '${originalNameForLog}' to '${canonicalName}'`);
                return canonicalName;
            }
            // console.warn(`DEBUG: standardizeNakshatraName - Could not standardize: '${originalNameForLog}'. Input trimmed: '${sNameTrimmed}'. Returning null.`);
            return null;
        }
        const formatDisplayKey = (key) => {
            if (!key) return 'N/A';
            return String(key).replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
        }
        function getFormattedDate(dateObj) {
            const year = dateObj.getFullYear();
            const month = String(dateObj.getMonth() + 1).padStart(2, '0');
            const day = String(dateObj.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }
        function showCustomAlert(message) {
            customModalMessage.textContent = message; customModal.classList.add('active');
        }
        const normalizeDate = (dateString) => {
            if (!dateString) { return null; }
            const parts = String(dateString).split('-');
            if (parts.length === 3) {
                const year = parseInt(parts[0], 10);
                const month = parseInt(parts[1], 10) - 1;
                const day = parseInt(parts[2], 10);
                if (!isNaN(year) && !isNaN(month) && !isNaN(day)) { return new Date(Date.UTC(year, month, day)); }
            }
            return null;
        };

        async function fetchMoonData() {
            const response = await fetch(`${host}/api/admindetail/all`);
            if (!response.ok) {
                throw new Error(`HTTP error fetching raw Gochar! Status: ${response.status}`);
            }
            const responseData = await response.json();

            const panchangData = responseData[0].panchang;
            const todayNormalized = normalizeDate(getFormattedDate(new Date()));

            const getPanchangData = async (date) => {
                let todaysPanchang = null;

                if (panchangData && Array.isArray(panchangData)) {
                    for (const month of panchangData) {
                        const match = month.days.find(day => day.date === date);
                        if (match) {
                            todaysPanchang = match.data;
                            break;
                        }
                    }
                }
                return todaysPanchang
            };

            function formatDatePanchang(date) {
                let day = String(date.getDate()).padStart(2, '0');
                let month = String(date.getMonth() + 1).padStart(2, '0');
                let year = date.getFullYear();
                return `${day}/${month}/${year}`;  // Converts to DD/MM/YYYY format
            }
            let formattedTithiDate = formatDatePanchang(todayNormalized);

            // Fetch current day's Panchang data
            const TithiPanchangResponse = await getPanchangData(formattedTithiDate);

            // console.log(TithiPanchangResponse, "TithiPanchangResponse")
            let moonNakshatra = TithiPanchangResponse.nakshatra.name;
            let moonrashi = TithiPanchangResponse.rasi.name
            let moonStart = new Date(TithiPanchangResponse.nakshatra.start);
            let moonEnd = new Date(TithiPanchangResponse.nakshatra.end);

            // Convert formattedTithiDate and formattedTime to a Date object
            let currentDate = new Date();
            let currentHours = currentDate.getHours();
            let currentMinutes = currentDate.getMinutes();
            let formattedTime = `${String(currentHours).padStart(2, '0')}:${String(currentMinutes).padStart(2, '0')}`;
            let [daymoon, monthmoon, yearmoon] = formattedTithiDate.split("/").map(Number);
            let [hoursmoon, minutesmoon] = formattedTime.split(":").map(Number);
            let currentDateTime = new Date(yearmoon, monthmoon - 1, daymoon, hoursmoon, minutesmoon);

            // Calculate total duration and divide into 4 Padas
            let totalDuration = moonEnd - moonStart;
            let partDuration = totalDuration / 4;
            let part1 = new Date(moonStart.getTime() + partDuration);
            let part2 = new Date(moonStart.getTime() + partDuration * 2);
            let part3 = new Date(moonStart.getTime() + partDuration * 3);
            let part4 = moonEnd;

            function getPada(time) {
                let dateTime = new Date(time);
                if (dateTime >= moonStart && dateTime < part1) {
                    return 1;
                } else if (dateTime >= part1 && dateTime < part2) {
                    return 2;
                } else if (dateTime >= part2 && dateTime < part3) {
                    return 3;
                } else if (dateTime >= part3 && dateTime <= part4) {
                    return 4;
                } else {
                    return "Out of range";
                }
            }

            let moonpada = getPada(currentDateTime);

            // If Pada is out of range, fetch the next day's Panchang
            if (moonpada === "Out of range") {
                let nextDate = new Date(yearmoon, monthmoon - 1, daymoon + 1);
                let nextFormattedDate = nextDate.toLocaleDateString("en-GB").split("/").join("/"); // Convert to YYYY/MM/DD

                const nextTithiPanchangResponse = await getPanchangData(nextFormattedDate);
                if (nextTithiPanchangResponse.length !== 0) {
                    const nextTithiPanchangData = nextTithiPanchangResponse;
                    console.log(nextTithiPanchangData, "nextTithiPanchangData")

                    let nextMoonNakshatra = nextTithiPanchangData.nakshatra.name;
                    let nextMoonStart = new Date(nextTithiPanchangData.nakshatra.start);
                    let nextMoonEnd = new Date(nextTithiPanchangData.nakshatra.end);

                    let nextTotalDuration = nextMoonEnd - nextMoonStart;
                    let nextPartDuration = nextTotalDuration / 4;
                    let nextPart1 = new Date(nextMoonStart.getTime() + nextPartDuration);
                    let nextPart2 = new Date(nextMoonStart.getTime() + nextPartDuration * 2);
                    let nextPart3 = new Date(nextMoonStart.getTime() + nextPartDuration * 3);
                    let nextPart4 = nextMoonEnd;

                    function getPada2(time) {
                        let dateTime = new Date(time);

                        if (dateTime >= moonStart && dateTime < nextPart1) {
                            return 1;
                        } else if (dateTime >= nextPart1 && dateTime < nextPart2) {
                            return 2;
                        } else if (dateTime >= nextPart2 && dateTime < nextPart3) {
                            return 3;
                        } else if (dateTime >= nextPart3 && dateTime <= nextPart4) {
                            return 4;
                        } else {
                            return "Out of range";
                        }
                    }

                    let nextMoonPada = getPada2(currentDateTime);
                    moonpada = nextMoonPada
                    moonNakshatra = nextMoonNakshatra
                }
            }
            await fetchData(moonNakshatra, moonpada, moonrashi, moonStart, moonEnd)
            await fetchAndProcessGocharData(moonNakshatra, moonpada, moonrashi, moonStart, moonEnd)
        }

        async function fetchData(moonNakshatra, moonpada, moonrashi, moonStart, moonEnd) {
            console.log(moonNakshatra, "nakshatra")
            console.log(moonpada, "pada")
            console.log(moonrashi, "rashi")
            console.log(moonStart, "start")
            console.log(moonEnd, "end")
            const gocharTableBody = document.querySelector("#gocharTable tbody");
            if (!gocharTableBody) {
                console.error("DEBUG: Raw Gochar table body not found.");
                return;
            }
            gocharTableBody.innerHTML = `<tr><td colspan="8" class="loading-text">Fetching raw Gochar data...</td></tr>`;

            // if (host === "YOUR_API_HOST_URL_HERE" || !host || host.trim() === "") {
            //     console.error("DEBUG: API host is not configured for raw Gochar fetch.");
            //     gocharTableBody.innerHTML = `<tr><td colspan="8" class="loading-text">API Host Error.</td></tr>`;
            //     return;
            // }

            try {
                // console.log("DEBUG: fetchData (for raw table) - Fetching from:", `${host}/api/admindetail/all`); 
                const response = await fetch(`${host}/api/admindetail/all`);
                if (!response.ok) {
                    throw new Error(`HTTP error fetching raw Gochar! Status: ${response.status}`);
                }
                const responseData = await response.json();
                console.log(responseData, "responseData")

                if (!responseData || !responseData[0] || !Array.isArray(responseData[0].gochar)) {
                    // console.error("DEBUG: Invalid raw Gochar data format:", responseData);
                    gocharTableBody.innerHTML = `<tr><td colspan="8" class="loading-text">Invalid data format.</td></tr>`;
                    return;
                }
                const gocharEntries = responseData[0].gochar;
                const todayNormalized = normalizeDate(getFormattedDate(new Date()));
                // console.log(todayNormalized, "todayNormalized")

                if (!todayNormalized) {
                    // console.error("DEBUG: Could not normalize today's date for raw Gochar table.");
                    gocharTableBody.innerHTML = `<tr><td colspan="8" class="loading-text">Date error.</td></tr>`;
                    return;
                }

                const todayEntries = gocharEntries.filter(entry => {
                    if (entry.date_of_entry && entry.date_of_exit) {
                        const entryStartDateNormalized = normalizeDate(entry.date_of_entry);
                        const entryEndDateNormalized = normalizeDate(entry.date_of_exit);
                        if (!entryStartDateNormalized || !entryEndDateNormalized) return false;
                        return todayNormalized >= entryStartDateNormalized && todayNormalized <= entryEndDateNormalized;
                    }
                    return false;
                });

                gocharTableBody.innerHTML = "";

                // Insert Moon data as the first row
                const moonRow = gocharTableBody.insertRow();
                moonRow.insertCell().textContent = "Moon";
                moonRow.insertCell().textContent = moonrashi || "N/A";
                moonRow.insertCell().textContent = standardizeNakshatraName(moonNakshatra) || "N/A";
                moonRow.insertCell().textContent = moonpada || "N/A";
                moonRow.insertCell().textContent = "No";
                moonRow.insertCell().textContent = "Direct";
                moonRow.insertCell().textContent = moonStart.toLocaleDateString();
                moonRow.insertCell().textContent = moonEnd.toLocaleDateString();

                // Then loop through other planets
                if (todayEntries.length === 0) {
                    gocharTableBody.innerHTML += `<tr><td colspan="8" class="loading-text">No Gochar entries found for today.</td></tr>`;
                } else {
                    todayEntries.forEach(entry => {
                        const row = gocharTableBody.insertRow();
                        row.insertCell().textContent = entry.planet_name || "N/A";
                        row.insertCell().textContent = entry.rashi_name || entry.rashi || "N/A";
                        row.insertCell().textContent = standardizeNakshatraName(entry.nakshatra_name || entry.nakshatra) || "N/A";
                        row.insertCell().textContent = entry.nakshatra_pada || entry.pada || "N/A";
                        row.insertCell().textContent = entry.combust ? "Yes" : "No";
                        row.insertCell().textContent = entry.motion || "N/A";
                        row.insertCell().textContent = entry.date_of_entry ? new Date(entry.date_of_entry + "T00:00:00Z").toLocaleDateString() : "N/A";
                        row.insertCell().textContent = entry.date_of_exit ? new Date(entry.date_of_exit + "T00:00:00Z").toLocaleDateString() : "N/A";
                    });
                }
                // console.log(gocharTableBody, "gocharTableBody")
            } catch (error) {
                // console.error("DEBUG: Error in fetchData (for raw table):", error);
                gocharTableBody.innerHTML = `<tr><td colspan="8" class="loading-text">Error fetching raw Gochar.</td></tr>`;
            }
        }

        // --- Gochar Data Fetching and Processing (for Step 1 & Future Days) ---
        async function fetchAndProcessGocharData(moonNakshatra, moonpada, moonrashi, moonStart, moonEnd) {
            console.log(moonNakshatra, "nakshatra")
            console.log(moonpada, "pada")
            console.log(moonrashi, "rashi")
            console.log(moonStart, "start")
            console.log(moonEnd, "end")
            // console.log("DEBUG: fetchAndProcessGocharData started at", new Date().toLocaleTimeString());
            const loadingTextCurrent = planetaryPositionsInputBody.querySelector('.loading-text');
            const loadingTextFuture = futurePlanetaryPositionsContainer.querySelector('.loading-text');

            console.log("DEBUG: API host is:", host);
            if (host === "YOUR_API_HOST_URL_HERE" || !host || host.trim() === "") {
                // console.error("DEBUG: API host is not configured properly! Please update the 'host' variable.");
                showCustomAlert("API host not configured. Using default planetary positions.");
                if (loadingTextCurrent) loadingTextCurrent.textContent = "API Host Error. Using Defaults.";
                if (loadingTextFuture && futurePlanetaryPositionsContainer.querySelector('.loading-text')) {
                    futurePlanetaryPositionsContainer.querySelector('.loading-text').textContent = "API Host Error. Using Defaults.";
                }
                fetchedCurrentDayPositions = JSON.parse(JSON.stringify(INITIAL_PLANETARY_POSITIONS));
                fetchedFutureDaysPositions = Array(5).fill(null).map(() => JSON.parse(JSON.stringify(INITIAL_PLANETARY_POSITIONS)));
                return false;
            }

            try {
                // console.log("DEBUG: fetchAndProcessGocharData - try block entered. Fetching from:", `${host}/api/admindetail/all`);
                const response = await fetch(`${host}/api/admindetail/all`);
                // console.log("DEBUG: API Response Status:", response.status, response.statusText);

                if (!response.ok) {
                    // console.error("DEBUG: API response not OK. Status:", response.status);
                    throw new Error(`HTTP error fetching Gochar data! Status: ${response.status} ${response.statusText}`);
                }

                const responseData = await response.json();
                // console.log("DEBUG: API responseData (raw):", JSON.stringify(responseData).substring(0, 500)); 

                if (!responseData || !responseData[0] || !Array.isArray(responseData[0].gochar)) {
                    // console.error("DEBUG: Invalid Gochar data format from API. Expected responseData[0].gochar to be an array. responseData[0]:", responseData ? JSON.stringify(responseData[0]).substring(0,300) : "N/A");
                    throw new Error("Invalid Gochar data format received.");
                }
                const gocharEntries = responseData[0].gochar;
                // console.log("DEBUG: Gochar entries received (count):", gocharEntries.length);
                // if (gocharEntries.length > 0) console.log("DEBUG: First Gochar entry example:", JSON.stringify(gocharEntries[0])); 

                const datesToFetch = [];
                const todayObj = new Date();
                todayObj.setHours(0, 0, 0, 0);

                for (let i = 0; i < 6; i++) {
                    const dateObj = new Date(todayObj);
                    dateObj.setDate(todayObj.getDate() + i);
                    datesToFetch.push(getFormattedDate(dateObj));
                }
                // console.log("DEBUG: Dates to fetch:", datesToFetch);

                const dailyPlanetaryData = {};
                datesToFetch.forEach(dateStr => {
                    dailyPlanetaryData[dateStr] = ALL_PLANETS.map(planetName => {
                        const initialPlanetFallback = INITIAL_PLANETARY_POSITIONS.find(p => p.name === planetName) ||
                            { name: planetName, rashiNumber: null, nakshatraName: null, nakshatraPada: null, isRetrograde: false, isCombust: false };
                        return JSON.parse(JSON.stringify(initialPlanetFallback));
                    });
                });

                datesToFetch.forEach(dateStr => {
                    const targetDateNormalized = normalizeDate(dateStr);
                    if (!targetDateNormalized) {
                        // console.error(`DEBUG: Could not normalize targetDate for dateStr: ${dateStr}`);
                        return;
                    }
                    // console.log(`DEBUG: Processing date: ${dateStr} (Normalized UTC: ${targetDateNormalized.toISOString()})`); 

                    ALL_PLANETS.forEach(planetName => {
                        const planetObjInDayData = dailyPlanetaryData[dateStr].find(p => p.name === planetName);
                        if (!planetObjInDayData) {
                            return;
                        }

                        const relevantEntry = gocharEntries.find(entry => {
                            if (entry.planet_name !== planetName) return false;
                            if (!entry.date_of_entry || !entry.date_of_exit) return false;

                            const entryStartDateNormalized = normalizeDate(entry.date_of_entry);
                            const entryEndDateNormalized = normalizeDate(entry.date_of_exit);

                            if (!entryStartDateNormalized || !entryEndDateNormalized) return false;

                            return targetDateNormalized >= entryStartDateNormalized && targetDateNormalized <= entryEndDateNormalized;
                        });
                        // console.log(relevantEntry, "relevantEntry")

                        if (relevantEntry) {
                            const rawNakshatraName = relevantEntry.nakshatra_name || relevantEntry.nakshatra;
                            if (planetName === "Saturn" || planetName === "Rahu" || planetName === "Moon") {
                                // console.log(`DEBUG: ASSIGNING for ${planetName} on ${dateStr}. Entry:`, JSON.stringify(relevantEntry));
                                // console.log(`DEBUG: Values for ${planetName}: rashi_name='${relevantEntry.rashi_name}', rashi='${relevantEntry.rashi}', RAW nak_name='${rawNakshatraName}', pada_val='${relevantEntry.nakshatra_pada}', pada_alt='${relevantEntry.pada}'`);
                            }
                            const rashiNameFromAPI = relevantEntry.rashi_name || relevantEntry.rashi;
                            const rashiNum = RASHI_NAMES.indexOf(rashiNameFromAPI);
                            planetObjInDayData.rashiNumber = (rashiNum !== -1) ? rashiNum + 1 : null;

                            planetObjInDayData.nakshatraName = standardizeNakshatraName(rawNakshatraName); // Use standardized name
                            planetObjInDayData.nakshatraPada = parseInt(relevantEntry.nakshatra_pada || relevantEntry.pada, 10);
                            if (isNaN(planetObjInDayData.nakshatraPada)) planetObjInDayData.nakshatraPada = null;

                            if (relevantEntry.motion !== undefined && relevantEntry.motion !== null) {
                                planetObjInDayData.isRetrograde = (String(relevantEntry.motion).toLowerCase() === 'retrograde');
                            }
                            if (relevantEntry.combust !== undefined && relevantEntry.combust !== null) {
                                planetObjInDayData.isCombust = !!relevantEntry.combust;
                            }
                            if (planetName === "Saturn" || planetName === "Rahu" || planetName === "Moon") {
                                //  console.log(`DEBUG: AFTER ASSIGNMENT for ${planetName} on ${dateStr}:`, JSON.stringify(planetObjInDayData));
                            }
                        } else {
                            if (dateStr === datesToFetch[0]) {
                                // Add this patch for Moon on today's date
                                if (planetName === "Moon" && moonNakshatra && moonpada && moonrashi && moonStart && moonEnd) {
                                    const moonObj = planetObjInDayData;
                                    moonObj.rashiNumber = RASHI_NAMES.indexOf(moonrashi) + 1 || null;
                                    moonObj.nakshatraName = standardizeNakshatraName(moonNakshatra);
                                    moonObj.nakshatraPada = parseInt(moonpada, 10);
                                    moonObj.start = moonStart;
                                    moonObj.end = moonEnd;
                                }
                            }
                        }
                    });
                });
                // console.log("DEBUG: dailyPlanetaryData after processing Gochar entries:", JSON.parse(JSON.stringify(dailyPlanetaryData))); 

                const todayDateStr = datesToFetch[0];
                // console.log("DEBUG: Today's date string for processing:", todayDateStr);
                // console.log("DEBUG: dailyPlanetaryData for today BEFORE completeness check:", JSON.parse(JSON.stringify(dailyPlanetaryData[todayDateStr]))); 

                // console.log("DEBUG: Checking data for isTodayDataComplete:");
                dailyPlanetaryData[todayDateStr].forEach(p => {
                    // p.nakshatraName should already be standardized or null here
                    const isPlanetComplete = p.rashiNumber !== null && p.rashiNumber >= 1 && p.rashiNumber <= 12 &&
                        p.nakshatraName !== null && MASTER_NAKSHATRA_LIST.includes(p.nakshatraName) &&
                        p.nakshatraPada !== null && !isNaN(p.nakshatraPada) && p.nakshatraPada >= 1 && p.nakshatraPada <= 4;
                    if (!isPlanetComplete && (p.name === "Moon" || p.name === "Saturn" || p.name === "Rahu")) {
                        // console.warn(`DEBUG: INCOMPLETE DATA FOR ${p.name}: Rashi=${p.rashiNumber}, Nakshatra=${p.nakshatraName} (Is it in Master List: ${MASTER_NAKSHATRA_LIST.includes(p.nakshatraName)}), Pada=${p.nakshatraPada}`);
                    }
                });

                const isTodayDataComplete = dailyPlanetaryData[todayDateStr] && dailyPlanetaryData[todayDateStr].every(p =>
                    p.rashiNumber !== null && p.rashiNumber >= 1 && p.rashiNumber <= 12 &&
                    p.nakshatraName !== null && MASTER_NAKSHATRA_LIST.includes(p.nakshatraName) && // Use already standardized p.nakshatraName
                    p.nakshatraPada !== null && !isNaN(p.nakshatraPada) && p.nakshatraPada >= 1 && p.nakshatraPada <= 4
                );
                // console.log("DEBUG: isTodayDataComplete defined. Value:", isTodayDataComplete); 

                if (isTodayDataComplete) {
                    fetchedCurrentDayPositions = dailyPlanetaryData[todayDateStr];
                    if (loadingTextCurrent) loadingTextCurrent.innerHTML = '';
                } else {
                    // console.warn(`DEBUG: Gochar data for today (${todayDateStr}) is incomplete. Some planets may be missing data. Displaying what was found.`);
                    fetchedCurrentDayPositions = dailyPlanetaryData[todayDateStr];
                    if (loadingTextCurrent) loadingTextCurrent.innerHTML = '';
                }

                fetchedFutureDaysPositions = [];
                for (let i = 1; i <= 5; i++) {
                    const futureDateStr = datesToFetch[i];
                    const isFutureDayDataComplete = dailyPlanetaryData[futureDateStr] && dailyPlanetaryData[futureDateStr].every(p =>
                        p.rashiNumber !== null && p.rashiNumber >= 1 && p.rashiNumber <= 12 &&
                        p.nakshatraName !== null && MASTER_NAKSHATRA_LIST.includes(p.nakshatraName) &&
                        p.nakshatraPada !== null && !isNaN(p.nakshatraPada) && p.nakshatraPada >= 1 && p.nakshatraPada <= 4
                    );
                    if (isFutureDayDataComplete) {
                        fetchedFutureDaysPositions.push(dailyPlanetaryData[futureDateStr]);
                    } else {
                        fetchedFutureDaysPositions.push(dailyPlanetaryData[futureDateStr] || JSON.parse(JSON.stringify(fetchedCurrentDayPositions)));
                    }
                }
                if (loadingTextFuture && futurePlanetaryPositionsContainer.querySelector('.loading-text')) {
                    futurePlanetaryPositionsContainer.querySelector('.loading-text').innerHTML = '';
                }
                // console.log("DEBUG: fetchAndProcessGocharData finished successfully.");
                return true;

            } catch (error) {
                // console.error("DEBUG: CRITICAL ERROR in fetchAndProcessGocharData catch block:", error);
                showCustomAlert(`Error fetching Gochar: ${error.message}. Using default positions.`);
                fetchedCurrentDayPositions = JSON.parse(JSON.stringify(INITIAL_PLANETARY_POSITIONS));
                fetchedFutureDaysPositions = Array(5).fill(null).map(() => JSON.parse(JSON.stringify(INITIAL_PLANETARY_POSITIONS)));
                if (loadingTextCurrent) loadingTextCurrent.textContent = "Gochar Fetch Error. Using Defaults.";
                if (loadingTextFuture && futurePlanetaryPositionsContainer.querySelector('.loading-text')) {
                    futurePlanetaryPositionsContainer.querySelector('.loading-text').textContent = "Gochar Fetch Error. Using Defaults.";
                }
                // console.log("DEBUG: fetchAndProcessGocharData finished with error.");
                return false;
            }
        }

        function createPlanetaryPositionsInputTable() {
            planetaryPositionsInputBody.innerHTML = '';
            const dataToUse = fetchedCurrentDayPositions || INITIAL_PLANETARY_POSITIONS;
            dataToUse.forEach(planetData => {
                if (["Saturn", "Rahu", "Moon", "Uranus"].includes(planetData.name)) {
                    // console.log(`DEBUG: createPlanetaryPositionsInputTable - Processing planetData for ${planetData.name}:`, JSON.parse(JSON.stringify(planetData)));
                }
                const row = planetaryPositionsInputBody.insertRow();
                row.insertCell().textContent = planetData.name;
                const rashiCell = row.insertCell();
                const rashiSelect = document.createElement('select');
                rashiSelect.id = `pos-rashi-${planetData.name}`;
                let defaultRashiOption = document.createElement('option');
                defaultRashiOption.value = ""; defaultRashiOption.textContent = "-- Select Rashi --";
                rashiSelect.appendChild(defaultRashiOption);
                RASHI_NAMES.forEach((name, index) => {
                    const option = document.createElement('option');
                    option.value = index + 1; option.textContent = name;
                    rashiSelect.appendChild(option);
                });
                rashiSelect.value = planetData.rashiNumber !== null ? planetData.rashiNumber : "";
                rashiCell.appendChild(rashiSelect);
                const nakshatraCell = row.insertCell();
                const nakshatraSelect = document.createElement('select');
                nakshatraSelect.id = `pos-nakshatra-${planetData.name}`;
                let defaultNakshatraOption = document.createElement('option');
                defaultNakshatraOption.value = ""; defaultNakshatraOption.textContent = "-- Select Nakshatra --";
                nakshatraSelect.appendChild(defaultNakshatraOption);
                MASTER_NAKSHATRA_LIST.forEach(nakName => {
                    const option = document.createElement('option');
                    option.value = nakName; option.textContent = nakName;
                    nakshatraSelect.appendChild(option);
                });
                nakshatraSelect.value = planetData.nakshatraName ? planetData.nakshatraName : "";
                nakshatraCell.appendChild(nakshatraSelect);
                const padaCell = row.insertCell();
                const padaInput = document.createElement('input');
                padaInput.type = 'number'; padaInput.id = `pos-pada-${planetData.name}`;
                padaInput.min = 1; padaInput.max = 4;
                if (planetData.nakshatraPada !== null && planetData.nakshatraPada !== undefined) {
                    padaInput.value = planetData.nakshatraPada;
                } else {
                    padaInput.value = '';
                }
                padaCell.appendChild(padaInput);
            });
            CURRENT_PLANETARY_CHARACTERISTICS = dataToUse.map(p => {
                const initialP = INITIAL_PLANETARY_POSITIONS.find(ip => ip.name === p.name) || {};
                return {
                    name: p.name, rashiNumber: p.rashiNumber, nakshatraName: p.nakshatraName, nakshatraPada: p.nakshatraPada,
                    isRetrograde: p.isRetrograde !== undefined ? p.isRetrograde : initialP.isRetrograde,
                    isCombust: p.isCombust !== undefined ? p.isCombust : initialP.isCombust,
                    derivedRashiDignityKey: p.derivedRashiDignityKey || initialP.derivedRashiDignityKey || 'default_rashi',
                    derivedNakshatraInfluenceKey: p.derivedNakshatraInfluenceKey || initialP.derivedNakshatraInfluenceKey || 'default_nlr',
                    derivedNakshatraPadaDignityKey: p.derivedNakshatraPadaDignityKey || initialP.derivedNakshatraPadaDignityKey || 'default_pada_dignity',
                    derivedConjunctionKey: p.derivedConjunctionKey || initialP.derivedConjunctionKey || 'no_conjunction',
                    vedhBy: p.vedhBy || initialP.vedhBy || [],
                    sparshBy: p.sparshBy || initialP.sparshBy || []
                };
            });
        }
        async function createFuturePlanetaryPositionsInputTables() {
            const response = await fetch(`${host}/api/admindetail/all`);
            if (!response.ok) {
                throw new Error(`HTTP error fetching raw Gochar! Status: ${response.status}`);
            }
            const responseData = await response.json();
            const panchangData = responseData[0].panchang;

            const getPanchangData = async (date) => {
                let todaysPanchang = null;
                if (panchangData && Array.isArray(panchangData)) {
                    for (const month of panchangData) {
                        const match = month.days.find(day => day.date === date);
                        if (match) {
                            todaysPanchang = match.data;
                            break;
                        }
                    }
                }
                return todaysPanchang;
            };

            function formatDatePanchang(date) {
                let day = String(date.getDate()).padStart(2, '0');
                let month = String(date.getMonth() + 1).padStart(2, '0');
                let year = date.getFullYear();
                return `${day}/${month}/${year}`; // DD/MM/YYYY
            }

            // Get Moon data for 5 future days
            let moonDataForFiveDays = [];

            for (let i = 0; i < 5; i++) {
                let futureDate = new Date();
                futureDate.setDate(futureDate.getDate() + i);
                let formattedDate = formatDatePanchang(futureDate);
                let panchang = await getPanchangData(formattedDate);

                if (panchang && panchang.nakshatra?.start && panchang.nakshatra?.end) {
                    let moonStart = new Date(panchang.nakshatra.start);
                    let moonEnd = new Date(panchang.nakshatra.end);
                    let totalDuration = moonEnd - moonStart;
                    let partDuration = totalDuration / 4;

                    let part1 = new Date(moonStart.getTime() + partDuration);
                    let part2 = new Date(moonStart.getTime() + partDuration * 2);
                    let part3 = new Date(moonStart.getTime() + partDuration * 3);
                    let part4 = moonEnd;

                    let now = new Date(); // current time
                    let pada;
                    if (now >= moonStart && now < part1) pada = 1;
                    else if (now < part2) pada = 2;
                    else if (now < part3) pada = 3;
                    else if (now <= part4) pada = 4;
                    else pada = null;

                    moonDataForFiveDays.push({
                        rashi: panchang.rasi?.name || null,
                        nakshatra: panchang.nakshatra?.name || null,
                        pada: pada
                    });
                } else {
                    moonDataForFiveDays.push({ rashi: null, nakshatra: null, pada: null });
                }
            }

            // Generate the tables
            futurePlanetaryPositionsContainer.innerHTML = '';
            for (let day = 1; day <= 5; day++) {
                const dayContainer = document.createElement('div');
                dayContainer.className = 'bg-white shadow-md rounded-lg p-4 table-container';

                const dayTitle = document.createElement('h4');
                dayTitle.className = 'text-md font-semibold text-center mb-2 text-gray-700';
                dayTitle.textContent = `Future Day ${day}`;
                dayContainer.appendChild(dayTitle);

                const table = document.createElement('table');
                table.className = 'min-w-full future-positions-table';
                const thead = table.createTHead();
                thead.className = 'future-positions-table-header';
                const headerRow = thead.insertRow();
                ['Planet', 'Rashi', 'Nakshatra', 'Pada'].forEach(text => {
                    const th = document.createElement('th');
                    th.textContent = text;
                    headerRow.appendChild(th);
                });

                const tbody = table.createTBody();
                tbody.id = `future-day-${day}-tbody`;

                const dayDataToUse = (fetchedFutureDaysPositions && fetchedFutureDaysPositions[day - 1])
                    ? fetchedFutureDaysPositions[day - 1]
                    : (fetchedCurrentDayPositions || INITIAL_PLANETARY_POSITIONS);

                ALL_PLANETS.forEach(planetName => {
                    const initialPlanetData = INITIAL_PLANETARY_POSITIONS.find(p => p.name === planetName) || {};
                    let planetData = dayDataToUse.find(p => p.name === planetName) || initialPlanetData;

                    if (planetName === "Moon") {
                        const moonData = moonDataForFiveDays[day - 1];
                        planetData = {
                            name: "Moon",
                            rashiNumber: moonData.rashi ? RASHI_NAMES.indexOf(moonData.rashi) + 1 : null,
                            nakshatraName: moonData.nakshatra,
                            nakshatraPada: moonData.pada
                        };
                    }

                    const row = tbody.insertRow();
                    row.insertCell().textContent = planetName;

                    // Rashi select
                    const rashiCell = row.insertCell();
                    const rashiSelect = document.createElement('select');
                    rashiSelect.id = `future-d${day}-rashi-${planetName}`;
                    let defaultRashiOpt = document.createElement('option');
                    defaultRashiOpt.value = ""; defaultRashiOpt.textContent = "-- Select --";
                    rashiSelect.appendChild(defaultRashiOpt);
                    RASHI_NAMES.forEach((name, index) => {
                        const option = document.createElement('option');
                        option.value = index + 1;
                        option.textContent = name;
                        rashiSelect.appendChild(option);
                    });
                    rashiSelect.value = planetData.rashiNumber !== null ? planetData.rashiNumber : "";
                    rashiCell.appendChild(rashiSelect);

                    // Nakshatra select
                    const nakshatraCell = row.insertCell();
                    const nakshatraSelect = document.createElement('select');
                    nakshatraSelect.id = `future-d${day}-nakshatra-${planetName}`;
                    let defaultNakOpt = document.createElement('option');
                    defaultNakOpt.value = ""; defaultNakOpt.textContent = "-- Select --";
                    nakshatraSelect.appendChild(defaultNakOpt);
                    MASTER_NAKSHATRA_LIST.forEach(nakName => {
                        const option = document.createElement('option');
                        option.value = nakName;
                        option.textContent = nakName;
                        nakshatraSelect.appendChild(option);
                    });
                    nakshatraSelect.value = planetData.nakshatraName ? planetData.nakshatraName : "";
                    nakshatraCell.appendChild(nakshatraSelect);

                    // Pada input
                    const padaCell = row.insertCell();
                    const padaInput = document.createElement('input');
                    padaInput.type = 'number';
                    padaInput.id = `future-d${day}-pada-${planetName}`;
                    padaInput.min = 1;
                    padaInput.max = 4;
                    padaInput.value = planetData.nakshatraPada !== null ? planetData.nakshatraPada : '';
                    padaCell.appendChild(padaInput);
                });

                dayContainer.appendChild(table);
                futurePlanetaryPositionsContainer.appendChild(dayContainer);
            }
            initiateScoreCalculation()
        }
        function getPlanetaryPositionsFromTopTable() {
            const positions = {};
            ALL_PLANETS.forEach(planetName => {
                const rashiSelect = document.getElementById(`pos-rashi-${planetName}`);
                const nakshatraSelect = document.getElementById(`pos-nakshatra-${planetName}`);
                const padaInput = document.getElementById(`pos-pada-${planetName}`);
                positions[planetName] = {
                    rashiNumber: rashiSelect && rashiSelect.value ? parseInt(rashiSelect.value) : null,
                    nakshatraName: nakshatraSelect && nakshatraSelect.value ? standardizeNakshatraName(nakshatraSelect.value) : null,
                    nakshatraPada: padaInput && padaInput.value ? parseInt(padaInput.value) : null
                };
            });
            return positions;
        }
        function determineRashiDignity(planetName, rashiNumber) {
            const dignities = PLANET_DIGNITIES_IN_RASHI[planetName];
            if (!dignities || rashiNumber === null || rashiNumber === undefined || isNaN(rashiNumber)) return 'default_rashi';
            if (dignities.exaltedRashi === rashiNumber) return 'exalted';
            if (dignities.debilitatedRashi === rashiNumber) return 'debilitated';
            if (dignities.moolatrikonaRashi === rashiNumber) return 'moolatrikona';
            if (dignities.ownRashi && dignities.ownRashi.includes(rashiNumber)) return 'own_house';
            const rashiName = RASHI_NUMBER_TO_NAME[rashiNumber];
            if (!rashiName) return 'default_rashi';
            const lordOfRashi = RASHI_LORDS[rashiName];
            const relations = planetaryRelations[planetName];
            if (relations && relations.friends.includes(lordOfRashi)) return 'friends_house';
            if (relations && relations.enemies.includes(lordOfRashi)) return 'enemies_house';
            if (relations && relations.neutral.includes(lordOfRashi)) return 'neutral_house';
            return 'neutral_house';
        }
        function determineNakshatraInfluence(planetName, nakshatraName, nakshatraPada) {
            const stdNakshatraName = nakshatraName;
            if (!stdNakshatraName || nakshatraPada === null || nakshatraPada === undefined || isNaN(nakshatraPada)) return 'default_nlr';
            const planetNakDignities = ucchaNeechaNakshatraPada[planetName];
            if (planetNakDignities) {
                if (planetNakDignities.exalted && standardizeNakshatraName(planetNakDignities.exalted.nakshatra) === stdNakshatraName && planetNakDignities.exalted.pada === nakshatraPada) {
                    return 'exalted_nakshatra';
                }
                if (planetNakDignities.debilitated && standardizeNakshatraName(planetNakDignities.debilitated.nakshatra) === stdNakshatraName && planetNakDignities.debilitated.pada === nakshatraPada) {
                    return 'debilitated_nakshatra';
                }
            }
            const lordOfThisNakshatra = nakshatraLords[stdNakshatraName];
            if (!lordOfThisNakshatra && stdNakshatraName === "Abhijit") return 'neutral_nlr';
            if (!lordOfThisNakshatra) return 'default_nlr';
            if (lordOfThisNakshatra === planetName) return 'own_nakshatra';
            const relations = planetaryRelations[planetName];
            if (relations && lordOfThisNakshatra) {
                if (relations.friends.includes(lordOfThisNakshatra)) return 'friend_nlr';
                if (relations.enemies.includes(lordOfThisNakshatra)) return 'enemy_nlr';
                if (relations.neutral.includes(lordOfThisNakshatra)) return 'neutral_nlr';
            }
            return 'default_nlr';
        }
        function determineNakshatraPadaDignity(planetName, nakshatraName, nakshatraPada) {
            const stdNakshatraName = nakshatraName;
            if (!stdNakshatraName || nakshatraPada === null || nakshatraPada === undefined || isNaN(nakshatraPada)) return 'default_pada_dignity';
            if (!PLANET_PADA_DIGNITIES_DATA || !PLANET_PADA_DIGNITIES_DATA[planetName] || PLANET_PADA_DIGNITIES_DATA[planetName].length === 0) {
                return "default_pada_dignity";
            }
            const padaDataForPlanet = PLANET_PADA_DIGNITIES_DATA[planetName];
            const foundPada = padaDataForPlanet.find(p => standardizeNakshatraName(p.nakshatra) === stdNakshatraName && p.pada === nakshatraPada);
            if (foundPada && foundPada.status) return foundPada.status;
            return "default_pada_dignity";
        }
        function createInputForm() {
            planetaryInputsBody.innerHTML = '<tr><td colspan="9" class="loading-text">Populating based on derived dignities...</td></tr>';
            if (!CURRENT_PLANETARY_CHARACTERISTICS || CURRENT_PLANETARY_CHARACTERISTICS.length === 0 || !CURRENT_PLANETARY_CHARACTERISTICS.some(p => p.name)) {
                console.warn("CURRENT_PLANETARY_CHARACTERISTICS is empty or invalid in createInputForm. Re-initializing from INITIAL_PLANETARY_POSITIONS.");
                CURRENT_PLANETARY_CHARACTERISTICS = JSON.parse(JSON.stringify(INITIAL_PLANETARY_POSITIONS));
            }
            planetaryInputsBody.innerHTML = '';
            CURRENT_PLANETARY_CHARACTERISTICS.forEach(planetData => {
                const row = planetaryInputsBody.insertRow();
                row.id = `input-row-${planetData.name}`;
                row.insertCell().textContent = planetData.name;
                row.insertCell().id = `derived-rashi-${planetData.name}`;
                row.insertCell().id = `derived-nakshatra-${planetData.name}`;
                row.insertCell().id = `derived-nakshatra-pada-${planetData.name}`;
                row.insertCell().id = `derived-conjunction-${planetData.name}`;
                ['derivedRashiDignityKey', 'derivedNakshatraInfluenceKey', 'derivedNakshatraPadaDignityKey', 'derivedConjunctionKey'].forEach(keyName => {
                    const cellId = `${keyName.replace(/Key$/, '').replace(/([A-Z])/g, '-$1').toLowerCase()}-${planetData.name}`;
                    const cell = document.getElementById(cellId);
                    if (cell) {
                        cell.textContent = formatDisplayKey(planetData[keyName] || (keyName === 'derivedConjunctionKey' ? 'no_conjunction' : 'N/A'));
                        cell.classList.add('derived-dignity-cell');
                    }
                });
                const retroCell = row.insertCell();
                const retroCheckbox = document.createElement('input');
                retroCheckbox.type = 'checkbox'; retroCheckbox.id = `isRetrograde-${planetData.name}`;
                retroCheckbox.checked = planetData.isRetrograde || false;
                retroCell.appendChild(retroCheckbox);
                const combustCell = row.insertCell();
                const combustCheckbox = document.createElement('input');
                combustCheckbox.type = 'checkbox'; combustCheckbox.id = `isCombust-${planetData.name}`;
                combustCheckbox.checked = planetData.isCombust || false;
                combustCell.appendChild(combustCheckbox);
                const vedhCell = row.insertCell();
                const vedhDisplay = document.createElement('span'); vedhDisplay.id = `vedhBy-${planetData.name}`;
                vedhDisplay.className = 'derived-text-field';
                vedhDisplay.textContent = (planetData.vedhBy || []).join(', ') || '-';
                vedhCell.appendChild(vedhDisplay);
                const sparshCell = row.insertCell();
                const sparshDisplay = document.createElement('span'); sparshDisplay.id = `sparshBy-${planetData.name}`;
                sparshDisplay.className = 'derived-text-field';
                sparshDisplay.textContent = (planetData.sparshBy || []).join(', ') || '-';
                sparshCell.appendChild(sparshDisplay);
            });
        }
        function getAbsolutePada(nakshatraName, nakshatraPada) {
            const stdNakshatraName = standardizeNakshatraName(nakshatraName);
            if (!stdNakshatraName || nakshatraPada === null || isNaN(parseInt(nakshatraPada))) return -1;
            const nakshatraIndex = MASTER_NAKSHATRA_LIST.indexOf(stdNakshatraName);
            if (nakshatraIndex === -1) {
                console.warn(`Nakshatra ${stdNakshatraName} not in MASTER_NAKSHATRA_LIST for getAbsolutePada`);
                return -1;
            }
            return (nakshatraIndex * 4) + parseInt(nakshatraPada);
        }
        function determineConjunctionRelationKey(currentPlanetName, allPlanetPositions) {
            let derivedRelationshipKey = "no_conjunction";
            let enemyFound = false; let friendFound = false;
            const currentPlanetInfo = allPlanetPositions[currentPlanetName];
            if (!currentPlanetInfo || !currentPlanetInfo.nakshatraName || currentPlanetInfo.nakshatraPada === undefined || currentPlanetInfo.nakshatraPada === null) return "no_conjunction";
            const absPadaCurrentPlanet = getAbsolutePada(currentPlanetInfo.nakshatraName, currentPlanetInfo.nakshatraPada);
            if (absPadaCurrentPlanet === -1) return "no_conjunction";
            for (const otherPlanetName of ALL_PLANETS) {
                if (otherPlanetName === currentPlanetName) continue;
                const otherPlanetInfo = allPlanetPositions[otherPlanetName];
                if (!otherPlanetInfo || !otherPlanetInfo.nakshatraName || otherPlanetInfo.nakshatraPada === undefined || otherPlanetInfo.nakshatraPada === null) continue;
                const absPadaOtherPlanet = getAbsolutePada(otherPlanetInfo.nakshatraName, otherPlanetInfo.nakshatraPada);
                if (absPadaOtherPlanet === -1) continue;
                const totalPadasInCycle = MASTER_NAKSHATRA_LIST.length * 4;
                let diff = absPadaOtherPlanet - absPadaCurrentPlanet;
                if (Math.abs(diff) > totalPadasInCycle / 2) diff > 0 ? diff -= totalPadasInCycle : diff += totalPadasInCycle;
                if (Math.abs(diff) <= 3) {
                    const relationsOfCurrent = planetaryRelations[currentPlanetName];
                    let tempRel = "neutral";
                    if (relationsOfCurrent) {
                        if (relationsOfCurrent.enemies && relationsOfCurrent.enemies.includes(otherPlanetName)) tempRel = "enemy";
                        else if (relationsOfCurrent.friends && relationsOfCurrent.friends.includes(otherPlanetName)) tempRel = "friend";
                    }
                    if (tempRel === "enemy") { derivedRelationshipKey = "enemy"; enemyFound = true; break; }
                    else if (tempRel === "friend" && !enemyFound) { derivedRelationshipKey = "friend"; friendFound = true; }
                    else if (tempRel === "neutral" && !enemyFound && !friendFound && derivedRelationshipKey === "no_conjunction") derivedRelationshipKey = "neutral";
                }
            }
            return derivedRelationshipKey;
        }
        function calculateAutoVedhAndSparshForAllPlanets(currentPlanetPositions) {
            const autoEffects = {};
            ALL_PLANETS.forEach(pName => autoEffects[pName] = { vedhBy: [], sparshBy: [] });
            ALL_PLANETS.forEach(causingPlanetName => {
                const causingPlanetPos = currentPlanetPositions[causingPlanetName];
                if (!causingPlanetPos || !causingPlanetPos.nakshatraName) return;
                const causingNakshatra = causingPlanetPos.nakshatraName;
                if (!MASTER_NAKSHATRA_LIST.includes(causingNakshatra)) return;
                const isVedhCausingType = VEDH_CAUSING_PLANETS.includes(causingPlanetName);
                const isSparshCausingType = SPARSH_CAUSING_PLANETS.includes(causingPlanetName);
                ['right', 'left', 'front'].forEach(vedhDirection => {
                    const targetVedhNakshatraName = VEDH_TABLES[vedhDirection]?.[causingNakshatra];
                    if (targetVedhNakshatraName) {
                        const stdTargetVedhNakshatraName = standardizeNakshatraName(targetVedhNakshatraName);
                        if (!MASTER_NAKSHATRA_LIST.includes(stdTargetVedhNakshatraName)) return;
                        ALL_PLANETS.forEach(targetPlanetName => {
                            if (targetPlanetName === causingPlanetName) return;
                            const targetPlanetPos = currentPlanetPositions[targetPlanetName];
                            if (targetPlanetPos && targetPlanetPos.nakshatraName === stdTargetVedhNakshatraName) {
                                if (isVedhCausingType && !autoEffects[targetPlanetName].vedhBy.includes(causingPlanetName)) autoEffects[targetPlanetName].vedhBy.push(causingPlanetName);
                                if (isSparshCausingType && !autoEffects[targetPlanetName].sparshBy.includes(causingPlanetName)) autoEffects[targetPlanetName].sparshBy.push(causingPlanetName);
                            }
                        });
                    }
                });
            });
            return autoEffects;
        }
        function deriveAndPopulateDignities() {
            const positions = getPlanetaryPositionsFromTopTable();
            const autoVedhSparshData = calculateAutoVedhAndSparshForAllPlanets(positions);
            CURRENT_PLANETARY_CHARACTERISTICS = CURRENT_PLANETARY_CHARACTERISTICS.map(planetChar => {
                const planetName = planetChar.name;
                const pos = positions[planetName];
                if (!pos || pos.rashiNumber === null || !pos.nakshatraName || pos.nakshatraPada === null) {
                    // For Uranus, allow nulls to pass through if API doesn't provide data
                    if (planetName !== "Uranus") {
                        console.warn(`Incomplete position data for ${planetName} in Step 1 for deriving dignities. Using defaults.`);
                    }
                    return {
                        ...planetChar,
                        derivedRashiDignityKey: 'default_rashi',
                        derivedNakshatraInfluenceKey: 'default_nlr',
                        derivedNakshatraPadaDignityKey: 'default_pada_dignity',
                        derivedConjunctionKey: 'no_conjunction',
                        vedhBy: (autoVedhSparshData[planetName] ? autoVedhSparshData[planetName].vedhBy : []) || [], // Ensure array
                        sparshBy: (autoVedhSparshData[planetName] ? autoVedhSparshData[planetName].sparshBy : []) || [] // Ensure array
                    };
                }
                const rashiDignityKey = determineRashiDignity(planetName, pos.rashiNumber);
                const nakshatraInfluenceKey = determineNakshatraInfluence(planetName, pos.nakshatraName, pos.nakshatraPada);
                const nakshatraPadaDignityKey = determineNakshatraPadaDignity(planetName, pos.nakshatraName, pos.nakshatraPada);
                const conjunctionKey = determineConjunctionRelationKey(planetName, positions);
                return {
                    ...planetChar, rashiNumber: pos.rashiNumber, nakshatraName: pos.nakshatraName, nakshatraPada: pos.nakshatraPada,
                    derivedRashiDignityKey: rashiDignityKey, derivedNakshatraInfluenceKey: nakshatraInfluenceKey,
                    derivedNakshatraPadaDignityKey: nakshatraPadaDignityKey, derivedConjunctionKey: conjunctionKey,
                    vedhBy: autoVedhSparshData[planetName] ? autoVedhSparshData[planetName].vedhBy : [],
                    sparshBy: autoVedhSparshData[planetName] ? autoVedhSparshData[planetName].sparshBy : []
                };
            });
            createInputForm();
            showCustomAlert("Dignities, Vedh, and Sparsh derived for Current Day and populated in Step 2 table.");
        }
        function getPlanetaryDataFromForm() {
            const planetDataArray = [];
            ALL_PLANETS.forEach(planetName => {
                const planetChar = CURRENT_PLANETARY_CHARACTERISTICS.find(p => p.name === planetName);
                if (!planetChar) {
                    console.warn(`Planet ${planetName} not found in CURRENT_PLANETARY_CHARACTERISTICS in getPlanetaryDataFromForm.`);
                    planetDataArray.push({
                        name: planetName, rashiDignityKey: 'default_rashi', nakshatraLordRelationshipKey: 'default_nlr',
                        nakshatraPadaDignityKey: 'default_pada_dignity', relationshipKey: 'no_conjunction',
                        isRetrograde: false, isCombust: false, vedhBy: [], sparshBy: []
                    }); return;
                }
                planetDataArray.push({
                    name: planetName,
                    rashiDignityKey: planetChar.derivedRashiDignityKey || 'default_rashi',
                    nakshatraLordRelationshipKey: planetChar.derivedNakshatraInfluenceKey || 'default_nlr',
                    nakshatraPadaDignityKey: planetChar.derivedNakshatraPadaDignityKey || 'default_pada_dignity',
                    relationshipKey: planetChar.derivedConjunctionKey || 'no_conjunction',
                    isRetrograde: document.getElementById(`isRetrograde-${planetName}`) ? document.getElementById(`isRetrograde-${planetName}`).checked : false,
                    isCombust: document.getElementById(`isCombust-${planetName}`) ? document.getElementById(`isCombust-${planetName}`).checked : false,
                    vedhBy: planetChar.vedhBy || [],
                    sparshBy: planetChar.sparshBy || []
                });
            });
            return planetDataArray;
        }
        function calculateScoresForGivenPositions(planetaryPositionsData, isCurrentDay = true) {
            const calculatedScores = {};
            const planetStates = {};
            const positionsToUse = {};
            if (Array.isArray(planetaryPositionsData)) { planetaryPositionsData.forEach(p => positionsToUse[p.name] = p); }
            else { Object.assign(positionsToUse, planetaryPositionsData); }

            ALL_PLANETS.forEach(planetName => {
                const pData = positionsToUse[planetName];
                if (!pData || (planetName !== "Uranus" && (pData.rashiNumber === undefined || pData.rashiNumber === null || !pData.nakshatraName || pData.nakshatraPada === undefined || pData.nakshatraPada === null))) {
                    if (planetName !== "Uranus") { console.warn(`Missing position data for ${planetName} in calculateScoresForGivenPositions (pass 1)`); }
                    planetStates[planetName] = { compositeDignityScore: 0, isRetrograde: (pData && pData.isRetrograde !== undefined) ? pData.isRetrograde : false };
                    return;
                }
                const rashiDignityKey = (pData.rashiNumber !== null) ? determineRashiDignity(planetName, pData.rashiNumber) : 'default_rashi';
                const nlrDignityKey = (pData.nakshatraName !== null && pData.nakshatraPada !== null) ? determineNakshatraInfluence(planetName, pData.nakshatraName, pData.nakshatraPada) : 'default_nlr';
                const rashiScore = DIGNITY_SCORES_RASHI[rashiDignityKey] || DIGNITY_SCORES_RASHI.default_rashi;
                const nlrScore = NAKSHATRA_INFLUENCE_SCORES[nlrDignityKey] || NAKSHATRA_INFLUENCE_SCORES.default_nlr;
                let isRetro = false;
                if (isCurrentDay) {
                    const retroCheckbox = document.getElementById(`isRetrograde-${planetName}`);
                    isRetro = retroCheckbox ? retroCheckbox.checked : (pData.isRetrograde || false);
                } else { isRetro = pData.isRetrograde || false; }
                planetStates[planetName] = { compositeDignityScore: rashiScore + nlrScore, isRetrograde: isRetro };
            });

            ALL_PLANETS.forEach(planetName => {
                const pData = positionsToUse[planetName];
                const charData = isCurrentDay ? CURRENT_PLANETARY_CHARACTERISTICS.find(p => p.name === planetName) : pData;
                if (!pData || !charData || (planetName !== "Uranus" && (pData.rashiNumber === undefined || pData.rashiNumber === null || !pData.nakshatraName || pData.nakshatraPada === undefined || pData.nakshatraPada === null))) {
                    if (planetName !== "Uranus") console.warn(`Missing data for ${planetName} during score calculation for a day.`);
                    calculatedScores[planetName] = { rashiTotal: 0, nlrTotal: 0, padaTotal: 0, rashiDignityKeyDisplay: 'N/A', nakshatraLordRelationshipKeyDisplay: 'N/A', nakshatraPadaDignityKeyDisplay: 'N/A', conjunctionKeyDisplay: 'N/A', isRetrogradeDisplay: false, isCombustDisplay: false, vedhByDisplay: [], sparshByDisplay: [] };
                    return;
                }
                const rashiDignityKey = (pData.rashiNumber !== null) ? determineRashiDignity(planetName, pData.rashiNumber) : 'default_rashi';
                const nlrDignityKey = (pData.nakshatraName !== null && pData.nakshatraPada !== null) ? determineNakshatraInfluence(planetName, pData.nakshatraName, pData.nakshatraPada) : 'default_nlr';
                const padaDignityKey = (pData.nakshatraName !== null && pData.nakshatraPada !== null) ? determineNakshatraPadaDignity(planetName, pData.nakshatraName, pData.nakshatraPada) : 'default_pada_dignity';
                const conjunctionKey = isCurrentDay ? (charData.derivedConjunctionKey || 'no_conjunction') : determineConjunctionRelationKey(planetName, positionsToUse);
                let isRetrograde = false, isCombust = false;
                if (isCurrentDay) {
                    const retroCheckbox = document.getElementById(`isRetrograde-${planetName}`);
                    const combustCheckbox = document.getElementById(`isCombust-${planetName}`);
                    isRetrograde = retroCheckbox ? retroCheckbox.checked : (charData.isRetrograde || false);
                    isCombust = combustCheckbox ? combustCheckbox.checked : (charData.isCombust || false);
                } else { isRetrograde = pData.isRetrograde || false; isCombust = pData.isCombust || false; }
                const autoVedhSparshForDay = isCurrentDay ? { vedhBy: charData.vedhBy || [], sparshBy: charData.sparshBy || [] } : (calculateAutoVedhAndSparshForAllPlanets(positionsToUse)[planetName] || { vedhBy: [], sparshBy: [] });
                const rashiScoreComponent = DIGNITY_SCORES_RASHI[rashiDignityKey] || DIGNITY_SCORES_RASHI.default_rashi;
                const nlrScoreComponent = NAKSHATRA_INFLUENCE_SCORES[nlrDignityKey] || NAKSHATRA_INFLUENCE_SCORES.default_nlr;
                const nakshatraPadaScoreComponent = NAKSHATRA_PADA_DIGNITY_SCORES[padaDignityKey] || NAKSHATRA_PADA_DIGNITY_SCORES.default_pada_dignity;
                let commonFactorsScore = 0;
                commonFactorsScore += RELATIONSHIP_SCORES[conjunctionKey] || RELATIONSHIP_SCORES.no_conjunction;
                if (isRetrograde) commonFactorsScore += PLANET_RETROGRADE_SCORES[planetName] !== undefined ? PLANET_RETROGRADE_SCORES[planetName] : 0;
                if (isCombust) commonFactorsScore += PLANET_COMBUST_SCORES[planetName] !== undefined ? PLANET_COMBUST_SCORES[planetName] : 0;
                (autoVedhSparshForDay.sparshBy || []).forEach(sparshPlanet => {
                    if (sparshPlanet && BENEFIC_PLANETS.includes(sparshPlanet) && PLANET_ASPECT_STRENGTHS[sparshPlanet] !== undefined) {
                        const inherentStrength = PLANET_ASPECT_STRENGTHS[sparshPlanet];
                        const causingPlanetState = planetStates[sparshPlanet];
                        const dignityModifier = (1 + ((causingPlanetState?.compositeDignityScore || 0) * DIGNITY_ASPECT_STRENGTH_FACTOR));
                        let sparshEffect = +1 * inherentStrength * dignityModifier;
                        if ((causingPlanetState?.isRetrograde || false) && !["Rahu", "Ketu", "Sun", "Moon"].includes(sparshPlanet)) sparshEffect *= RETRO_BENEFIC_SPARSH_MULTIPLIER;
                        commonFactorsScore += sparshEffect;
                    }
                });
                (autoVedhSparshForDay.vedhBy || []).forEach(vedhPlanet => {
                    if (vedhPlanet && MALEFIC_PLANETS.includes(vedhPlanet) && PLANET_ASPECT_STRENGTHS[vedhPlanet] !== undefined) {
                        const inherentStrength = PLANET_ASPECT_STRENGTHS[vedhPlanet];
                        const causingPlanetState = planetStates[vedhPlanet];
                        const dignityModifier = (1 + ((causingPlanetState?.compositeDignityScore || 0) * DIGNITY_ASPECT_STRENGTH_FACTOR));
                        let vedhEffect = -1 * inherentStrength * dignityModifier;
                        if ((causingPlanetState?.isRetrograde || false) && !["Rahu", "Ketu", "Sun", "Moon"].includes(vedhPlanet)) vedhEffect *= RETRO_MALEFIC_VEDH_MULTIPLIER;
                        commonFactorsScore += vedhEffect;
                    }
                });
                calculatedScores[planetName] = {
                    rashiTotal: rashiScoreComponent + commonFactorsScore, nlrTotal: nlrScoreComponent + commonFactorsScore,
                    padaTotal: nakshatraPadaScoreComponent + commonFactorsScore, rashiDignityKeyDisplay: rashiDignityKey,
                    nakshatraLordRelationshipKeyDisplay: nlrDignityKey, nakshatraPadaDignityKeyDisplay: padaDignityKey,
                    conjunctionKeyDisplay: conjunctionKey, isRetrogradeDisplay: isRetrograde, isCombustDisplay: isCombust,
                    vedhByDisplay: autoVedhSparshForDay.vedhBy || [], sparshByDisplay: autoVedhSparshForDay.sparshBy || []
                };
            });
            return calculatedScores;
        }
        function displayCurrentDayScores(scores) {
            resultsBody.innerHTML = '';
            ALL_PLANETS.forEach(planetName => {
                const planetScoreData = scores[planetName];
                if (!planetScoreData) {
                    console.warn("No score data for planet:", planetName, "in displayCurrentDayScores");
                    const row = resultsBody.insertRow(); row.insertCell().textContent = planetName;
                    row.insertCell({ colspan: 11 }).textContent = "Score data missing."; return;
                }
                const getColorClass = (score) => score > 0.01 ? 'total-score-positive' : (score < -0.01 ? 'total-score-negative' : 'total-score-neutral');
                const row = resultsBody.insertRow();
                const createScoreInputCell = (planet, scoreType, scoreValue) => {
                    const cell = row.insertCell(); const input = document.createElement('input');
                    input.type = 'number'; input.step = '0.01';
                    input.className = `manual-score-input ${getColorClass(scoreValue)}`;
                    input.dataset.planet = planet; input.dataset.scoreType = scoreType;
                    input.value = scoreValue.toFixed(2);
                    input.addEventListener('input', handleManualScoreChange);
                    cell.appendChild(input); return cell;
                };
                row.insertCell().textContent = planetName;
                row.insertCell().textContent = formatDisplayKey(planetScoreData.rashiDignityKeyDisplay);
                row.insertCell().textContent = formatDisplayKey(planetScoreData.nakshatraLordRelationshipKeyDisplay);
                row.insertCell().textContent = formatDisplayKey(planetScoreData.nakshatraPadaDignityKeyDisplay);
                row.insertCell().textContent = formatDisplayKey(planetScoreData.conjunctionKeyDisplay);
                row.insertCell().textContent = planetScoreData.isRetrogradeDisplay ? 'Yes' : 'No';
                row.insertCell().textContent = planetScoreData.isCombustDisplay ? 'Yes' : 'No';
                row.insertCell().textContent = (planetScoreData.vedhByDisplay || []).join(', ') || '-';
                row.insertCell().textContent = (planetScoreData.sparshByDisplay || []).join(', ') || '-';
                createScoreInputCell(planetName, 'rashiTotal', planetScoreData.rashiTotal);
                createScoreInputCell(planetName, 'nlrTotal', planetScoreData.nlrTotal);
                createScoreInputCell(planetName, 'padaTotal', planetScoreData.padaTotal);
            });
        }
        function handleManualScoreChange(event) {
            const inputElement = event.target;
            const planetName = inputElement.dataset.planet;
            const scoreType = inputElement.dataset.scoreType;
            const newValue = parseFloat(inputElement.value);
            if (isNaN(newValue)) return;
            if (currentPlanetaryScoresForMarket[planetName]) {
                currentPlanetaryScoresForMarket[planetName][scoreType] = newValue;
            } else {
                currentPlanetaryScoresForMarket[planetName] = { rashiTotal: 0, nlrTotal: 0, padaTotal: 0 };
                currentPlanetaryScoresForMarket[planetName][scoreType] = newValue;
            }
            const getColorClass = (score) => score > 0.01 ? 'total-score-positive' : (score < -0.01 ? 'total-score-negative' : 'total-score-neutral');
            inputElement.className = `manual-score-input ${getColorClass(newValue)}`;
            initiateCryptoCategoryTrendCalculation(); // Renamed
            calculateAndDisplayPriceLevels();
            calculateAndDisplayACTS(currentPlanetaryScoresForMarket); // Recalculate ACTS
            calculateAndDisplayCoinScores(); // Recalculate Coin Scores
        }
        async function initiateScoreCalculation() {
            calculateButton.disabled = true; calculateButton.classList.add("opacity-50", "cursor-not-allowed");
            resultsBody.innerHTML = `<tr><td colspan="12" class="loading-text">Calculating current day scores...</td></tr>`;
            cryptoCategoryTrendsBody.innerHTML = `<tr><td colspan="7" class="loading-text">Planetary scores being updated...</td></tr>`; // Renamed
            priceLevelsTableBody.innerHTML = `<tr><td colspan="4" class="loading-text">Planetary scores being updated...</td></tr>`;
            individualPlanetPriceLevelsTableBody.innerHTML = `<tr><td colspan="4" class="loading-text">Planetary scores being updated...</td></tr>`;
            document.getElementById('actsRashiScore').textContent = "Calculating...";
            document.getElementById('actsNlrScore').textContent = "Calculating...";
            document.getElementById('actsPadaScore').textContent = "Calculating...";
            document.getElementById('actsRashiPiWi').textContent = "Calculating...";
            document.getElementById('actsNlrPiWi').textContent = "Calculating...";
            document.getElementById('actsPadaPiWi').textContent = "Calculating...";
            document.getElementById('actsSignModifierS').textContent = "Calculating...";
            document.getElementById('actsNakshatraModifierN').textContent = "Calculating...";
            document.getElementById('actsTimingFactorT').textContent = "Calculating...";
            if (coinScoresTableBody) coinScoresTableBody.innerHTML = `<tr><td colspan="6" class="loading-text">Planetary scores being updated...</td></tr>`;


            await new Promise(resolve => setTimeout(resolve, 100));
            try {
                const currentDayRawPositions = getPlanetaryPositionsFromTopTable();
                currentPlanetaryScoresForMarket = calculateScoresForGivenPositions(currentDayRawPositions, true);
                displayCurrentDayScores(currentPlanetaryScoresForMarket);
                calculateAndDisplayACTS(currentPlanetaryScoresForMarket); // Calculate and display ACTS
                calculateAndDisplayCoinScores(); // Calculate and display Coin Scores

                const futurePositionsInputArrays = getFuturePlanetaryPositionsFromInput();
                futurePlanetaryScoresData = [];
                for (let i = 0; i < 5; i++) {
                    const futureDayScores = calculateScoresForGivenPositions(futurePositionsInputArrays[i], false);
                    futurePlanetaryScoresData.push(futureDayScores);
                }
                if (Object.keys(currentPlanetaryScoresForMarket).length > 0) {
                    initiateCryptoCategoryTrendCalculation(); // Renamed
                    calculateAndDisplayPriceLevels();
                } else {
                    showCustomAlert("Could not calculate current planetary scores. Please check inputs.");
                }
            } catch (error) {
                console.error("Error in score calculation process:", error);
                showCustomAlert("An error occurred during score calculation. Check console.");
                resultsBody.innerHTML = `<tr><td colspan="12" class="loading-text">Error calculating. Check console.</td></tr>`;
            } finally {
                calculateButton.disabled = false; calculateButton.classList.remove("opacity-50", "cursor-not-allowed");
            }
        }
        function getFuturePlanetaryPositionsFromInput() {
            const futureData = [];
            for (let day = 1; day <= 5; day++) {
                const dayPositions = {};
                ALL_PLANETS.forEach(planetName => {
                    const rashiSelect = document.getElementById(`future-d${day}-rashi-${planetName}`);
                    const nakshatraSelect = document.getElementById(`future-d${day}-nakshatra-${planetName}`);
                    const padaInput = document.getElementById(`future-d${day}-pada-${planetName}`);
                    dayPositions[planetName] = {
                        name: planetName,
                        rashiNumber: rashiSelect && rashiSelect.value ? parseInt(rashiSelect.value) : null,
                        nakshatraName: nakshatraSelect && nakshatraSelect.value ? standardizeNakshatraName(nakshatraSelect.value) : null,
                        nakshatraPada: padaInput && padaInput.value ? parseInt(padaInput.value) : null,
                        isRetrograde: (fetchedFutureDaysPositions[day - 1]?.find(p => p.name === planetName)?.isRetrograde) || false,
                        isCombust: (fetchedFutureDaysPositions[day - 1]?.find(p => p.name === planetName)?.isCombust) || false,
                    };
                });
                futureData.push(dayPositions);
            }
            return futureData;
        }
        let cryptoCategory_masterTrendData = []; // Renamed
        let cryptoCategory_currentSortKey = null; // Renamed
        let cryptoCategory_isSortAscending = true; // Renamed
        const cryptoCategory_FIXED_TOP_CATEGORIES = ["Layer 1", "AI"]; // Example categories to pin

        function cryptoCategory_getTrendAndColor(score) { // Renamed
            let trend = "", trendColorClass = "";
            if (score >= 0.3) { trend = "Strongly Bullish"; trendColorClass = "trend-positive"; }
            else if (score >= 0.1) { trend = "Bullish"; trendColorClass = "trend-positive"; }
            else if (score > -0.1) { trend = "Neutral"; trendColorClass = "trend-neutral"; }
            else if (score > -0.3) { trend = "Bearish"; trendColorClass = "trend-negative"; }
            else { trend = "Strongly Bearish"; trendColorClass = "trend-negative"; }
            return { trend, trendColorClass };
        }
        function calculateAllCryptoCategoryData(planetFinalScores) { // Renamed and adapted
            const allData = [];
            for (const category in cryptoCategoryAdjustedWeights) { // Use cryptoCategoryAdjustedWeights
                const weights = cryptoCategoryAdjustedWeights[category];
                let rashiScoreCategory = 0, nlrScoreCategory = 0, padaScoreCategory = 0;
                ALL_PLANETS.forEach(planetName => {
                    const pScores = planetFinalScores[planetName]; const pWeight = weights[planetName] || 0;
                    if (pScores) {
                        rashiScoreCategory += (pScores.rashiTotal || 0) * pWeight;
                        nlrScoreCategory += (pScores.nlrTotal || 0) * pWeight;
                        padaScoreCategory += (pScores.padaTotal || 0) * pWeight;
                    }
                });
                const trendRashi = cryptoCategory_getTrendAndColor(rashiScoreCategory);
                const trendNlr = cryptoCategory_getTrendAndColor(nlrScoreCategory);
                const trendPada = cryptoCategory_getTrendAndColor(padaScoreCategory);
                allData.push({
                    categoryName: category, // Use categoryName
                    rashiScore: rashiScoreCategory, rashiTrend: trendRashi.trend,
                    rashiTrendColorClass: trendRashi.trendColorClass, nlrScore: nlrScoreCategory, nlrTrend: trendNlr.trend,
                    nlrTrendColorClass: trendNlr.trendColorClass, padaScore: padaScoreCategory, padaTrend: trendPada.trend,
                    padaTrendColorClass: trendPada.trendColorClass
                });
            }
            return allData;
        }
        function renderCryptoCategoryTrendTable(dataToRender) { // Renamed
            cryptoCategoryTrendsBody.innerHTML = '';
            if (dataToRender.length === 0) {
                cryptoCategoryTrendsBody.innerHTML = `<tr><td colspan="7" class="loading-text">No crypto categories match or scores not calculated.</td></tr>`; return;
            }
            dataToRender.forEach(item => {
                const row = cryptoCategoryTrendsBody.insertRow();
                const getColorClass = (score) => score > 0.01 ? 'total-score-positive' : (score < -0.01 ? 'total-score-negative' : 'total-score-neutral');
                row.innerHTML = `
                    <td class="category-name">${item.categoryName}</td> <td class="${getColorClass(item.rashiScore)}">${item.rashiScore.toFixed(2)}</td> <td class="${item.rashiTrendColorClass}" style="font-weight:bold;">${item.rashiTrend}</td>
                    <td class="${getColorClass(item.nlrScore)}">${item.nlrScore.toFixed(2)}</td> <td class="${item.nlrTrendColorClass}" style="font-weight:bold;">${item.nlrTrend}</td>
                    <td class="${getColorClass(item.padaScore)}">${item.padaScore.toFixed(2)}</td> <td class="${item.padaTrendColorClass}" style="font-weight:bold;">${item.padaTrend}</td>
                `;
            });
        }
        function applyFiltersAndSortCryptoCategory() { // Renamed
            if (cryptoCategory_masterTrendData.length === 0) { renderCryptoCategoryTrendTable([]); return; }
            let processedData = [...cryptoCategory_masterTrendData];
            const selectedPerspective = filterPerspectiveCryptoCategory.value;
            const selectedTrend = filterTrendCryptoCategory.value;
            if (selectedTrend !== "all") {
                processedData = processedData.filter(item => {
                    if (selectedPerspective === "any") return item.rashiTrend === selectedTrend || item.nlrTrend === selectedTrend || item.padaTrend === selectedTrend;
                    if (selectedPerspective === "long") return item.rashiTrend === selectedTrend;
                    if (selectedPerspective === "medium") return item.nlrTrend === selectedTrend;
                    if (selectedPerspective === "short") return item.padaTrend === selectedTrend;
                    return false;
                });
            }
            const topCategoriesData = []; const otherCategoriesData = [];
            processedData.forEach(item => {
                if (cryptoCategory_FIXED_TOP_CATEGORIES.includes(item.categoryName)) {
                    // Find index to maintain order if multiple fixed items
                    const fixedIndex = cryptoCategory_FIXED_TOP_CATEGORIES.indexOf(item.categoryName);
                    topCategoriesData[fixedIndex] = item;
                }
                else otherCategoriesData.push(item);
            });
            const finalTopCategories = topCategoriesData.filter(Boolean);
            if (cryptoCategory_currentSortKey) {
                otherCategoriesData.sort((a, b) => {
                    let valA, valB;
                    if (['rashiTrend', 'nlrTrend', 'padaTrend'].includes(cryptoCategory_currentSortKey)) {
                        const trendOrder = ["Strongly Bullish", "Bullish", "Neutral", "Bearish", "Strongly Bearish"];
                        valA = trendOrder.indexOf(a[cryptoCategory_currentSortKey]); valB = trendOrder.indexOf(b[cryptoCategory_currentSortKey]);
                        if (valA < valB) return cryptoCategory_isSortAscending ? -1 : 1; if (valA > valB) return cryptoCategory_isSortAscending ? 1 : -1; return 0;
                    } else {
                        valA = a[cryptoCategory_currentSortKey]; valB = b[cryptoCategory_currentSortKey];
                        if (valA === undefined || valB === undefined) return 0;
                        return cryptoCategory_isSortAscending ? valA - valB : valB - valA;
                    }
                });
            }
            renderCryptoCategoryTrendTable([...finalTopCategories, ...otherCategoriesData]); updateSortIndicatorsCryptoCategory();
        }
        function updateSortIndicatorsCryptoCategory() { // Renamed
            document.querySelectorAll('.crypto-category-results-table .sortable-header .sort-indicator').forEach(span => span.textContent = '');
            if (cryptoCategory_currentSortKey) {
                let headerIdMapping = {
                    'rashiScore': 'headerLongTermScoreCryptoCategory', 'rashiTrend': 'headerLongTermTrendCryptoCategory',
                    'nlrScore': 'headerMediumTermScoreCryptoCategory', 'nlrTrend': 'headerMediumTermTrendCryptoCategory',
                    'padaScore': 'headerShortTermScoreCryptoCategory', 'padaTrend': 'headerShortTermTrendCryptoCategory'
                };
                const indicatorSpan = document.querySelector(`#${headerIdMapping[cryptoCategory_currentSortKey]} .sort-indicator`);
                if (indicatorSpan) indicatorSpan.textContent = cryptoCategory_isSortAscending ? ' ' : ' ';
            }
        }
        async function initiateCryptoCategoryTrendCalculation() { // Renamed
            updateCryptoCategoryTrendsButton.disabled = true; updateCryptoCategoryTrendsButton.classList.add("opacity-50");
            applyFilterButtonCryptoCategory.disabled = true;
            cryptoCategoryTrendsBody.innerHTML = `<tr><td colspan="7" class="loading-text">Updating crypto category trends...</td></tr>`;
            await new Promise(resolve => setTimeout(resolve, 50));
            try {
                if (currentPlanetaryScoresForMarket && Object.keys(currentPlanetaryScoresForMarket).length > 0) {
                    cryptoCategory_masterTrendData = calculateAllCryptoCategoryData(currentPlanetaryScoresForMarket);
                    applyFiltersAndSortCryptoCategory();
                } else cryptoCategoryTrendsBody.innerHTML = `<tr><td colspan="7" class="loading-text">Calculate planetary scores first.</td></tr>`;
            } catch (error) {
                console.error("Error in crypto category score calculation:", error);
                cryptoCategoryTrendsBody.innerHTML = `<tr><td colspan="7" class="loading-text">Error updating. Check console.</td></tr>`;
            } finally {
                updateCryptoCategoryTrendsButton.disabled = false; updateCryptoCategoryTrendsButton.classList.remove("opacity-50");
                applyFilterButtonCryptoCategory.disabled = false;
            }
        }
        function displayCryptoCategoryWeightages() { // Renamed
            detailedWeightagesSection.innerHTML = '';
            for (const categoryName in cryptoCategoryAdjustedWeights) { // Use cryptoCategoryAdjustedWeights
                if (cryptoCategoryAdjustedWeights.hasOwnProperty(categoryName)) {
                    const weights = cryptoCategoryAdjustedWeights[categoryName];
                    const categoryContainer = document.createElement('div');
                    categoryContainer.className = 'weightage-category-container table-container'; // Renamed class
                    const title = document.createElement('h4');
                    title.className = 'weightage-category-title'; // Renamed class
                    title.textContent = categoryName; // Already displayable
                    categoryContainer.appendChild(title);
                    const table = document.createElement('table');
                    table.className = 'min-w-full weightage-details-table';
                    const thead = table.createTHead();
                    thead.className = 'weightage-table-header';
                    const headerRow = thead.insertRow();
                    headerRow.insertCell().textContent = 'Planet';
                    headerRow.insertCell().textContent = 'Weightage';
                    const tbody = table.createTBody();
                    ALL_PLANETS.forEach(planet => {
                        const weight = weights[planet] !== undefined ? weights[planet] : 0;
                        const row = tbody.insertRow();
                        row.insertCell().textContent = planet;
                        const weightCell = row.insertCell();
                        weightCell.textContent = weight.toFixed(3);
                        if (weight > 0) weightCell.classList.add('total-score-positive');
                        else if (weight < 0) weightCell.classList.add('total-score-negative');
                    });
                    categoryContainer.appendChild(table);
                    detailedWeightagesSection.appendChild(categoryContainer);
                }
            }
        }
        function populateCoinDropdownForPriceLevels() { // Renamed from populateCryptoCategoryDropdownForPriceLevels
            priceLevelCoinSelect.innerHTML = '<option value="">-- Select Coin --</option>'; // Updated default text
            Object.keys(coinProfiles).forEach(coinName => { // Iterate over coinProfiles keys
                const option = document.createElement('option');
                option.value = coinName;
                option.textContent = coinName;
                priceLevelCoinSelect.appendChild(option);
            });
        }
        function calculateAndDisplayPriceLevels() {
            const inputPrice = parseFloat(priceLevelInputPrice.value);
            const selectedCoinKey = priceLevelCoinSelect.value; // Renamed variable
            const selectedCoinName = priceLevelCoinSelect.options[priceLevelCoinSelect.selectedIndex]?.text || "Selected Coin"; // Renamed variable

            priceLevelsTableBody.innerHTML = '';
            individualPlanetPriceLevelsTableBody.innerHTML = '';
            individualPlanetLevelsTitle.textContent = `Individual Planet Target Prices for ${selectedCoinName} (Current Day Scores)`; // Updated text
            if (isNaN(inputPrice) || inputPrice <= 0) {
                const msg = `<tr><td colspan="4" class="loading-text">Please enter a valid price.</td></tr>`;
                priceLevelsTableBody.innerHTML = msg;
                individualPlanetPriceLevelsTableBody.innerHTML = `<tr><td colspan="4" class="loading-text">Enter valid price above.</td></tr>`;
                renderPriceChart(null, null, null, null); return;
            }
            if (!selectedCoinKey) { // Check if a coin is selected
                const msg = `<tr><td colspan="4" class="loading-text">Please select a coin.</td></tr>`; // Updated text
                priceLevelsTableBody.innerHTML = msg;
                individualPlanetPriceLevelsTableBody.innerHTML = `<tr><td colspan="4" class="loading-text">Select coin above.</td></tr>`; // Updated text
                renderPriceChart(null, null, null, null); return;
            }
            if (Object.keys(currentPlanetaryScoresForMarket).length === 0) {
                const msg = `<tr><td colspan="4" class="loading-text">Planetary scores not calculated. Please calculate scores first.</td></tr>`;
                priceLevelsTableBody.innerHTML = msg;
                individualPlanetPriceLevelsTableBody.innerHTML = `<tr><td colspan="4" class="loading-text">Calculate planetary scores first.</td></tr>`;
                renderPriceChart(null, null, null, null); return;
            }
            const coinSpecificProfileWeights = coinProfiles[selectedCoinKey]; // Use coin's own profile for weights
            if (!coinSpecificProfileWeights) { // Use coinSpecificProfileWeights
                const msg = `<tr><td colspan="4" class="loading-text">Planetary profile for selected coin not found.</td></tr>`; // Updated text
                priceLevelsTableBody.innerHTML = msg;
                individualPlanetPriceLevelsTableBody.innerHTML = `<tr><td colspan="4" class="loading-text">Coin profile not found.</td></tr>`; // Updated text
                renderPriceChart(null, null, null, null); console.error("Planetary profile not found for coin:", selectedCoinKey); return;
            }
            const perspectives = [
                { name: "Rashi", scoreKey: "rashiTotal", color: 'rgba(255, 99, 132, 1)' },
                { name: "Nakshatra Lord", scoreKey: "nlrTotal", color: 'rgba(54, 162, 235, 1)' },
                { name: "Nakshatra Pada", scoreKey: "padaTotal", color: 'rgba(75, 192, 192, 1)' }
            ];
            const chartDataForOverall = []; const chartDataForIndividual = [];
            perspectives.forEach(perspective => {
                let combinedScorePerspective = 0;
                ALL_PLANETS.forEach(planetName => {
                    const planetScores = currentPlanetaryScoresForMarket[planetName];
                    const planetWeight = coinSpecificProfileWeights[planetName] || 0; // Use coin's profile weight for this planet
                    if (planetScores && planetScores[perspective.scoreKey] !== undefined) {
                        combinedScorePerspective += planetScores[perspective.scoreKey] * planetWeight;
                    }
                });
                const baseOffset = inputPrice * combinedScorePerspective * LEVEL_SENSITIVITY_FACTOR;
                const R_S_levels = [
                    { name: "R2 (Resistance 2)", value: inputPrice + 2 * baseOffset }, { name: "R1 (Resistance 1)", value: inputPrice + 1 * baseOffset },
                    { name: "Pivot", value: inputPrice }, { name: "S1 (Support 1)", value: inputPrice - 1 * baseOffset },
                    { name: "S2 (Support 2)", value: inputPrice - 2 * baseOffset }
                ];
                R_S_levels.forEach(level => {
                    const row = priceLevelsTableBody.insertRow();
                    row.insertCell().textContent = perspective.name; row.insertCell().textContent = level.name;
                    row.insertCell().textContent = combinedScorePerspective.toFixed(3); row.insertCell().textContent = level.value.toFixed(2);
                });
                const overallTargetPrice = inputPrice * (1 + combinedScorePerspective);
                const targetRow = priceLevelsTableBody.insertRow(); targetRow.classList.add('level-target');
                targetRow.insertCell().textContent = perspective.name; targetRow.insertCell().textContent = "Overall Target Price";
                targetRow.insertCell().textContent = combinedScorePerspective.toFixed(3); targetRow.insertCell().textContent = overallTargetPrice.toFixed(2);
                chartDataForOverall.push({
                    label: `${perspective.name} Overall Target (Current)`, targetPrice: overallTargetPrice, color: perspective.color, isCurrent: true
                });
            });
            if (priceLevelsTableBody.innerHTML === '') { priceLevelsTableBody.innerHTML = `<tr><td colspan="4" class="loading-text">Could not calculate overall levels.</td></tr>`; }
            ALL_PLANETS.forEach((planetName, planetIndex) => {
                perspectives.forEach((perspective, perspectiveIndex) => {
                    const planetScores = currentPlanetaryScoresForMarket[planetName];
                    const planetWeightInProfile = coinSpecificProfileWeights[planetName] || 0; // Use coin's profile weight
                    if (planetScores && planetScores[perspective.scoreKey] !== undefined) {
                        const planetScorePerspective = planetScores[perspective.scoreKey];
                        const weightedPlanetScore = planetScorePerspective * planetWeightInProfile;
                        const individualTargetPrice = inputPrice * (1 + weightedPlanetScore);
                        const row = individualPlanetPriceLevelsTableBody.insertRow();
                        row.insertCell().textContent = planetName; row.insertCell().textContent = perspective.name;
                        row.insertCell().textContent = weightedPlanetScore.toFixed(3); row.insertCell().textContent = individualTargetPrice.toFixed(2);
                        chartDataForIndividual.push({
                            label: `${planetName} - ${perspective.name} Target (Current)`, targetPrice: individualTargetPrice,
                            color: `hsla(${(planetIndex * 35 + perspectiveIndex * 10) % 360}, 70%, 60%, 0.7)`, isCurrent: true
                        });
                    } else {
                        const row = individualPlanetPriceLevelsTableBody.insertRow();
                        row.insertCell().textContent = planetName; row.insertCell().textContent = perspective.name;
                        row.insertCell().textContent = "N/A"; row.insertCell().textContent = "N/A";
                    }
                });
            });
            if (individualPlanetPriceLevelsTableBody.innerHTML === '') { individualPlanetPriceLevelsTableBody.innerHTML = `<tr><td colspan="4" class="loading-text">Could not calculate individual planet levels. Ensure scores are present.</td></tr>`; }
            futurePlanetaryScoresData.forEach((dayScores, dayIndex) => {
                perspectives.forEach(perspective => {
                    let combinedFutureScore = 0;
                    ALL_PLANETS.forEach(planetName => {
                        const planetFutureScores = dayScores[planetName];
                        const planetWeight = coinSpecificProfileWeights[planetName] || 0; // Use coin's profile weight
                        if (planetFutureScores && planetFutureScores[perspective.scoreKey] !== undefined) {
                            combinedFutureScore += planetFutureScores[perspective.scoreKey] * planetWeight;
                        }
                    });
                    const futureOverallTarget = inputPrice * (1 + combinedFutureScore);
                    chartDataForOverall.push({
                        label: `${perspective.name} Overall Target (Future D${dayIndex + 1})`, targetPrice: futureOverallTarget,
                        color: perspective.color, isCurrent: false, futureDayIndex: dayIndex
                    });
                });
                ALL_PLANETS.forEach((planetName, planetIndex) => {
                    perspectives.forEach((perspective, perspectiveIndex) => {
                        const planetFutureScores = dayScores[planetName];
                        const planetWeightInProfile = coinSpecificProfileWeights[planetName] || 0; // Use coin's profile weight
                        if (planetFutureScores && planetFutureScores[perspective.scoreKey] !== undefined) {
                            const planetFutureScorePerspective = planetFutureScores[perspective.scoreKey];
                            const weightedFuturePlanetScore = planetFutureScorePerspective * planetWeightInProfile;
                            const individualFutureTarget = inputPrice * (1 + weightedFuturePlanetScore);
                            chartDataForIndividual.push({
                                label: `${planetName} - ${perspective.name} Target (Future D${dayIndex + 1})`, targetPrice: individualFutureTarget,
                                color: `hsla(${(planetIndex * 35 + perspectiveIndex * 10) % 360}, 70%, 60%, 0.7)`,
                                isCurrent: false, futureDayIndex: dayIndex
                            });
                        }
                    });
                });
            });
            renderPriceChart(inputPrice, selectedCoinName, chartDataForOverall, chartDataForIndividual); // Use selectedCoinName
        }
        function renderPriceChart(inputPrice, selectedItemName, overallTargetDataForChart, individualPlanetTargetDataForChart) { // Renamed selectedSectorName
            const ctx = document.getElementById('priceForecastChart').getContext('2d');
            if (priceForecastChartInstance) { priceForecastChartInstance.destroy(); }
            if (!inputPrice || !selectedItemName || !overallTargetDataForChart || !individualPlanetTargetDataForChart) {
                if (ctx) {
                    ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
                    ctx.font = "16px Inter"; ctx.fillStyle = "#4a5568"; ctx.textAlign = "center";
                    ctx.fillText("Enter Price, Coin, and Calculate Scores to see the chart.", ctx.canvas.width / 2, ctx.canvas.height / 2); // Updated text
                } return;
            }
            const xLabels = ['Current D1', 'Current D2', 'Current D3', 'Current D4', 'Current D5', 'Future D1', 'Future D2', 'Future D3', 'Future D4', 'Future D5'];
            const datasets = [];
            datasets.push({
                label: 'Input Price', data: Array(10).fill(inputPrice), borderColor: 'rgba(128, 128, 128, 1)',
                borderDash: [5, 5], fill: false, tension: 0.1, pointRadius: 0,
            });
            overallTargetDataForChart.forEach(data => {
                const chartPoints = Array(10).fill(null);
                if (data.isCurrent) { for (let i = 0; i < 5; i++) chartPoints[i] = data.targetPrice; }
                else { chartPoints[5 + data.futureDayIndex] = data.targetPrice; }
                datasets.push({
                    label: data.label.replace("(Current)", "").replace("(Future D", "(FD"), data: chartPoints,
                    borderColor: data.color, fill: false, tension: 0.1, borderWidth: 2, spanGaps: true
                });
            });
            individualPlanetTargetDataForChart.forEach(data => {
                const chartPoints = Array(10).fill(null);
                if (data.isCurrent) { for (let i = 0; i < 5; i++) chartPoints[i] = data.targetPrice; }
                else { chartPoints[5 + data.futureDayIndex] = data.targetPrice; }
                datasets.push({
                    label: data.label.replace("(Current)", "").replace("(Future D", "(FD"), data: chartPoints,
                    borderColor: data.color, borderWidth: 1, hidden: true, fill: false, tension: 0.1, spanGaps: true
                });
            });
            priceForecastChartInstance = new Chart(ctx, {
                type: 'line', data: { labels: xLabels, datasets: datasets },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    plugins: {
                        title: { display: true, text: `10-Day Price Forecast for ${selectedItemName} (Base: ${inputPrice.toFixed(2)})`, font: { size: 16 } }, // Use selectedItemName
                        legend: {
                            position: 'top', labels: {
                                font: { size: 10 }, boxWidth: 20,
                                filter: function (legendItem, chartData) { return legendItem.text.includes('Overall Target') && !legendItem.text.includes('(FD'); }
                            }
                        },
                        tooltip: { mode: 'index', intersect: false, }
                    },
                    scales: {
                        x: { title: { display: true, text: 'Day' } },
                        y: {
                            beginAtZero: false, title: { display: true, text: 'Price' },
                            ticks: { callback: function (value, index, values) { return value.toFixed(2); } }
                        }
                    },
                    animation: { duration: 0 }
                }
            });
        }
        function loadTradingViewChart(symbolToLoad) {
            const symbolInput = document.getElementById('tvSymbolInput');
            const symbol = symbolToLoad || symbolInput.value || "NSE:RELIANCE";
            symbolInput.value = symbol;
            const container = document.getElementById('tv_chart_container'); container.innerHTML = '';
            if (typeof TradingView !== 'undefined') {
                tvWidgetInstance = new TradingView.widget({
                    "autosize": true, "symbol": symbol, "interval": "D", "timezone": "Etc/UTC", "theme": "light", "style": "1",
                    "locale": "en", "toolbar_bg": "#f1f3f6", "enable_publishing": false, "allow_symbol_change": true,
                    "container_id": "tv_chart_container", "hide_top_toolbar": false, "withdateranges": true
                });
            } else {
                console.error("TradingView library is not loaded.");
                container.innerHTML = '<p class="text-red-500 text-center">TradingView library could not be loaded. Please check script includes.</p>';
            }
        }

        // --- Astrological Climate Trend Score (ACTS) Calculation & Display ---
        function calculateAndDisplayACTS(planetScores) {
            const perspectives = [
                { name: "Rashi", key: "rashiTotal", elementId: "actsRashiScore", piwiElementId: "actsRashiPiWi" },
                { name: "Nakshatra Lord", key: "nlrTotal", elementId: "actsNlrScore", piwiElementId: "actsNlrPiWi" },
                { name: "Pada", key: "padaTotal", elementId: "actsPadaScore", piwiElementId: "actsPadaPiWi" }
            ];

            const signModifierElement = document.getElementById('actsSignModifierS');
            const nakshatraModifierElement = document.getElementById('actsNakshatraModifierN');
            const timingFactorElement = document.getElementById('actsTimingFactorT');


            // Calculate S (Sum of Sign Modifiers for Uranus, Saturn, Jupiter, Mercury)
            let totalSignModifierS = 0;
            const signModifierPlanets = ["Uranus", "Saturn", "Jupiter", "Mercury"];
            signModifierPlanets.forEach(modPlanetName => {
                const pChar = CURRENT_PLANETARY_CHARACTERISTICS.find(p => p.name === modPlanetName);
                let rashiNameOfPlanet = null;
                if (pChar && pChar.rashiNumber !== null && RASHI_NUMBER_TO_NAME[pChar.rashiNumber]) {
                    rashiNameOfPlanet = RASHI_NUMBER_TO_NAME[pChar.rashiNumber];
                }

                if (rashiNameOfPlanet && SIGN_MODIFIER_MATRIX[rashiNameOfPlanet] && SIGN_MODIFIER_MATRIX[rashiNameOfPlanet][modPlanetName] !== undefined) {
                    totalSignModifierS += SIGN_MODIFIER_MATRIX[rashiNameOfPlanet][modPlanetName];
                }
            });
            if (signModifierElement) {
                signModifierElement.textContent = totalSignModifierS.toFixed(2);
                signModifierElement.className = totalSignModifierS > 0.01 ? 'total-score-positive' : (totalSignModifierS < -0.01 ? 'total-score-negative' : 'total-score-neutral');
            }


            // Calculate N (Moon Nakshatra Modifier)
            let nakshatraModifierN = 0;
            const moonChar = CURRENT_PLANETARY_CHARACTERISTICS.find(p => p.name === "Moon");
            if (moonChar && moonChar.nakshatraName) {
                const stdMoonNakshatra = standardizeNakshatraName(moonChar.nakshatraName);
                if (stdMoonNakshatra && NAKSHATRA_MODIFIER_SCORES[stdMoonNakshatra] !== undefined) {
                    nakshatraModifierN = NAKSHATRA_MODIFIER_SCORES[stdMoonNakshatra];
                }
            }
            if (nakshatraModifierElement) {
                nakshatraModifierElement.textContent = nakshatraModifierN.toFixed(2);
                nakshatraModifierElement.className = nakshatraModifierN > 0.01 ? 'total-score-positive' : (nakshatraModifierN < -0.01 ? 'total-score-negative' : 'total-score-neutral');
            }

            // Calculate T (Timing Factor = Tithi Score + Moon Phase Score)
            let timingFactorT = 0;
            const selectedTithi = tithiSelect.value;
            const selectedMoonPhase = moonPhaseSelect.value;

            if (TITHI_SCORES[selectedTithi] !== undefined) {
                timingFactorT += TITHI_SCORES[selectedTithi];
            }
            if (MOON_PHASE_SCORES[selectedMoonPhase] !== undefined) {
                timingFactorT += MOON_PHASE_SCORES[selectedMoonPhase];
            }
            if (timingFactorElement) {
                timingFactorElement.textContent = timingFactorT.toFixed(2);
                timingFactorElement.className = timingFactorT > 0.01 ? 'total-score-positive' : (timingFactorT < -0.01 ? 'total-score-negative' : 'total-score-neutral');
            }


            perspectives.forEach(perspective => {
                let sigmaPiWi = 0; // Sum of (Pi * Wi) for this perspective
                const scoreElement = document.getElementById(perspective.elementId);
                const piwiScoreElement = document.getElementById(perspective.piwiElementId);


                if (!planetScores || Object.keys(planetScores).length === 0) {
                    if (scoreElement) {
                        scoreElement.textContent = "N/A";
                        scoreElement.className = 'total-score-neutral';
                    }
                    if (piwiScoreElement) {
                        piwiScoreElement.textContent = "N/A";
                        piwiScoreElement.className = 'total-score-neutral';
                    }
                    return;
                }

                ALL_PLANETS.forEach(planetName => {
                    const pScoreData = planetScores[planetName];
                    let pi = 0;

                    if (pScoreData && pScoreData[perspective.key] !== undefined && pScoreData[perspective.key] !== null) {
                        const scoreVal = pScoreData[perspective.key];
                        if (scoreVal > 0.01) pi = 1;
                        else if (scoreVal < -0.01) pi = -1;
                    } else {
                        pi = 0;
                    }

                    let wi = ACTS_PLANET_WEIGHTS[planetName];
                    if (wi === undefined) { wi = 0; }
                    sigmaPiWi += pi * wi;
                });

                if (piwiScoreElement) {
                    piwiScoreElement.textContent = sigmaPiWi.toFixed(2);
                    piwiScoreElement.className = sigmaPiWi > 0.01 ? 'total-score-positive' : (sigmaPiWi < -0.01 ? 'total-score-negative' : 'total-score-neutral');
                }

                const finalActsScore = sigmaPiWi + totalSignModifierS + nakshatraModifierN + timingFactorT;

                if (scoreElement) {
                    scoreElement.textContent = finalActsScore.toFixed(2);
                    scoreElement.className = finalActsScore > 0.01 ? 'total-score-positive' : (finalActsScore < -0.01 ? 'total-score-negative' : 'total-score-neutral');
                }
            });
        }

        function populateTimingFactorDropdowns() {
            // Populate Tithi Dropdown
            const tithis = Object.keys(TITHI_SCORES);
            tithis.forEach(tithi => {
                const option = document.createElement('option');
                option.value = tithi;
                option.textContent = tithi;
                tithiSelect.appendChild(option);
            });

            // Populate Moon Phase Dropdown
            const moonPhases = Object.keys(MOON_PHASE_SCORES);
            moonPhases.forEach(phase => {
                const option = document.createElement('option');
                option.value = phase;
                option.textContent = phase;
                moonPhaseSelect.appendChild(option);
            });
        }

        function populateCoinFilterDropdown() {
            ALL_PLANETS.forEach(planet => {
                const option = document.createElement('option');
                option.value = planet;
                option.textContent = planet;
                filterCoinByPlanetSelect.appendChild(option);
            });
        }

        function calculateAndDisplayCoinScores() {
            if (!coinScoresTableBody || !currentPlanetaryScoresForMarket || Object.keys(currentPlanetaryScoresForMarket).length === 0) {
                if (coinScoresTableBody) coinScoresTableBody.innerHTML = `<tr><td colspan="6" class="loading-text">Calculate planetary scores first.</td></tr>`;
                return;
            }

            const selectedPlanetFilter = filterCoinByPlanetSelect.value;
            coinScoresTableBody.innerHTML = ''; // Clear previous results

            let coinsToDisplay = Object.keys(coinProfiles);

            if (selectedPlanetFilter !== "all") {
                coinsToDisplay = coinsToDisplay.filter(coinName => coinProfiles[coinName] && coinProfiles[coinName].hasOwnProperty(selectedPlanetFilter));
            }

            if (coinsToDisplay.length === 0) {
                coinScoresTableBody.innerHTML = `<tr><td colspan="6" class="loading-text">No coins match the selected planet filter.</td></tr>`;
                return;
            }

            coinsToDisplay.forEach(coinName => {
                const profile = coinProfiles[coinName];
                if (!profile) return;

                let rashiAffinity = 0;
                let nakshatraAffinity = 0;
                let padaAffinity = 0;

                for (const planet in profile) {
                    if (profile.hasOwnProperty(planet) && currentPlanetaryScoresForMarket[planet]) {
                        const weight = profile[planet];
                        const planetScores = currentPlanetaryScoresForMarket[planet];

                        rashiAffinity += (planetScores.rashiTotal || 0) * weight;
                        nakshatraAffinity += (planetScores.nlrTotal || 0) * weight;
                        padaAffinity += (planetScores.padaTotal || 0) * weight;
                    }
                }

                const row = coinScoresTableBody.insertRow();
                const getColorClass = (score) => score > 0.01 ? 'total-score-positive' : (score < -0.01 ? 'total-score-negative' : 'total-score-neutral');

                row.insertCell().textContent = coinName;
                row.insertCell().textContent = coinCategories[coinName] || 'N/A';
                row.insertCell().textContent = Object.keys(profile).join(', ');

                let cellRashi = row.insertCell(); cellRashi.textContent = rashiAffinity.toFixed(2); cellRashi.className = getColorClass(rashiAffinity);
                let cellNakshatra = row.insertCell(); cellNakshatra.textContent = nakshatraAffinity.toFixed(2); cellNakshatra.className = getColorClass(nakshatraAffinity);
                let cellPada = row.insertCell(); cellPada.textContent = padaAffinity.toFixed(2); cellPada.className = getColorClass(padaAffinity);
            });
        }


        window.onload = async () => {
            console.log("DEBUG: window.onload started at", new Date().toLocaleTimeString());
            if (!PLANET_PADA_DIGNITIES_DATA || Object.keys(PLANET_PADA_DIGNITIES_DATA).length < ALL_PLANETS.length || !PLANET_PADA_DIGNITIES_DATA["Sun"] || PLANET_PADA_DIGNITIES_DATA["Sun"].length < 100) {
                console.error("CRITICAL: PLANET_PADA_DIGNITIES_DATA seems incomplete or missing for one or more planets.");
                showCustomAlert("ERROR: Astrological Pada data is missing or incomplete. Calculations may be inaccurate. Please ensure all planets have full Pada data.");
            }

            populateTimingFactorDropdowns(); // Populate Tithi and Moon Phase dropdowns
            populateCoinFilterDropdown(); // Populate coin filter dropdown

            await fetchMoonData();

            createPlanetaryPositionsInputTable();
            createFuturePlanetaryPositionsInputTables();
            createInputForm();
            deriveAndPopulateDignities();
            displayCryptoCategoryWeightages(); // Renamed
            populateCoinDropdownForPriceLevels(); // Renamed and updated to populate coins
            renderPriceChart(null, null, null, null);
            loadTradingViewChart();
            calculateAndDisplayACTS(currentPlanetaryScoresForMarket); // Initial ACTS display (likely N/A)
            calculateAndDisplayCoinScores(); // Initial coin scores display

            document.querySelectorAll('.crypto-category-results-table .sortable-header').forEach(header => { // Updated class
                header.addEventListener('click', () => {
                    const sortKey = header.getAttribute('data-sort-key');
                    if (cryptoCategory_currentSortKey === sortKey) cryptoCategory_isSortAscending = !cryptoCategory_isSortAscending; // Use renamed vars
                    else { cryptoCategory_currentSortKey = sortKey; cryptoCategory_isSortAscending = sortKey.includes('Score') ? false : true; }
                    applyFiltersAndSortCryptoCategory(); // Renamed
                });
            });
            customModalCloseButton.addEventListener('click', () => customModal.classList.remove('active'));
            customModal.addEventListener('click', (event) => { if (event.target === customModal) customModal.classList.remove('active'); });
            let alertMessage = "";
            if (fetchedCurrentDayPositions) {
                let missingPlanets = [];
                fetchedCurrentDayPositions.forEach(p => {
                    if (p.name !== "Uranus" && (p.rashiNumber === null || !p.nakshatraName || p.nakshatraPada === null)) {
                        missingPlanets.push(p.name);
                    }
                });
                if (missingPlanets.length === 0) {
                    alertMessage = "Page loaded. Planetary positions automatically set from Gochar API (Uranus positions may be default/null if not in API). Please verify Step 1 inputs before deriving dignities.";
                } else {
                    alertMessage = `Page loaded. Gochar data for today is partially incomplete (missing/invalid data for: ${missingPlanets.join(', ')}). Uranus positions may also be default. Please verify API or set positions manually.`;
                }
            } else {
                alertMessage = "Page loaded. Gochar data fetch failed or was incomplete. Step 1 positions may be unselected. Please verify API or set positions manually.";
            }
            showCustomAlert(alertMessage);
            console.log("DEBUG: window.onload finished at", new Date().toLocaleTimeString());
        };
    </script>



    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
    <!-- Swiper Js file -->
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <!-- script file -->
    <script src="./js/index.js"></script>

</body>

</html>