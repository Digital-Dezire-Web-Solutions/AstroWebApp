<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Astro Market Web App</title>
    <!-- swiper slider css CDN -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.1/css/all.min.css"
        integrity="sha512-5Hs3dF2AEPkpNAR7UiOHba+lRSJNeM2ECkwxUIxC1Q/FLycGTbNapWXB4tP889k5T5Ju8fs4b1P5z/iB4nMfSQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <!-- Tempus Dominus CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link rel="stylesheet" href="./css/style.css">

</head>

<body>


    <!-- __________________________________ 
     Our header Comp 
     ------------------------ -->

    <header class="header-comp">
        <div class="common-container3">

            <div class="header-flex-bx flex item-between">

                <div class="left-header-logo flex item-start gap">
                    <img src="./images/astrology.png" alt="">

                    <h6>Astroyogi</h6>

                </div>

                <div class="right-navbar class-rel flex item-start gap">
                    <div class="navbar class-rel">
                        <nav class="nav class-rel">
                            <div class="nav-lists flex item-start">
                                <li><a href="#">Calendar</a></li>
                                <li><a href="#">Market</a></li>
                                <li><a href="#">Kundali</a></li>
                                <li><a href="#">Affirmations</a></li>
                                <li><a href="#">Runes</a></li>
                                <li><a href="#">Healing</a></li>
                                <li><a href="#">Wisdom</a></li>
                            </div>
                        </nav>
                    </div>

                    <div class="header-icons-flex-bx class-rel flex gap">

                        <a href="#">
                            <button class="headr-btn">
                                <ion-icon name="cart-outline"></ion-icon>
                                <span>Store</span>
                            </button>
                        </a>

                        <a href="#">
                            <button id="login_btn" class="headr-btn headr-btn2">
                                <ion-icon name="person"></ion-icon>
                                <span>Login</span>
                            </button>
                        </a>

                    </div>

                    <button class="menu-bar-btn">
                        <i class="fa-solid fa-bars-staggered"></i>
                    </button>

                </div>

            </div>

        </div>
    </header>

    <!-- _______________________
       Our Login Reg Comp 
       ------------------ -->

    <section class="login-reg-comp">

        <div class="login-bx ">

            <button class="close-form-btn">
                <i class="fa-solid fa-xmark"></i>
            </button>

            <div class="login-info">

                <div class="login-logo">
                    <img src="./images/astrology.png" alt="">
                </div>



                <div class="comn-heading">
                    <h4>Sign In to Astrology </h4>
                    <!-- <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Minima maxime est obcaecati.</p> -->
                </div>

                <div class="login-form">
                    <form action="#">

                        <div class="inpt-bx">
                            <label for="email">Email Address</label>
                            <div class="inpt">
                                <input type="email" name="email" placeholder="Enter your email address..."
                                    autocomplete="off" required>
                            </div>
                        </div>

                        <div class="inpt-bx">
                            <label for="email">Password</label>
                            <div class="inpt">
                                <input type="password" name="password" placeholder="Enter your password..."
                                    autocomplete="off" required>
                            </div>
                        </div>




                    </form>

                    <div class="form-btns-flex">

                        <button class="form-btn">
                            Sign In
                        </button>

                        <button class="form-btn form-btn2" id="newAcnt">
                            Create Account
                        </button>

                    </div>

                </div>
            </div>

            <div class="reg-info">

                <div class="login-logo">
                    <img src="./images/astrology.png" alt="">
                </div>

                <div class="comn-heading">
                    <h4>Sign Up to Astrology </h4>
                    <!-- <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Minima maxime est obcaecati.</p> -->
                </div>

                <div class="login-form">
                    <form action="#">

                        <div class="inpt-bx">
                            <label for="name">Name</label>
                            <div class="inpt">
                                <input type="text" name="name" placeholder="Enter your Name" autocomplete="off"
                                    required>
                            </div>
                        </div>

                        <div class="inpt-bx">
                            <label for="name">Email</label>
                            <div class="inpt">
                                <input type="email" name="email" placeholder="Enter your email address..."
                                    autocomplete="off" required>
                            </div>
                        </div>

                        <div class="inpt-bx">
                            <label for="password">Create Password</label>
                            <div class="inpt">
                                <input type="text" name="createpassword" placeholder="Create your password..."
                                    autocomplete="off" required>
                            </div>
                        </div>


                        <div class="inpt-bx">
                            <label for="password">Date Of Birth</label>
                            <div class="inpt">
                                <input type="text" id="calendarInput" placeholder="Choose a date" />
                            </div>
                        </div>

                        <div class="inpt-bx">
                            <label for="password">Birth Time</label>
                            <div class="inpt">
                                <input type="text" id="timePicker" class="time-picker" placeholder="Select Time">
                            </div>
                        </div>
                        <div class="inpt-bx">
                            <label for="birthplace"> Birth Place</label>
                            <div class="inpt">
                                <input type="text" name="birthplace" placeholder="Enter your birth place..."
                                    autocomplete="off" required>
                            </div>
                        </div>


                    </form>

                    <div class="form-btns-flex">

                        <button class="form-btn">
                            Create Account
                        </button>

                        <button class="form-btn  form-btn3" id="signInBtn">
                            I Already Have Account
                        </button>

                    </div>

                </div>

            </div>

        </div>

    </section>

    <!-- ______________________________
        Our kundali comp 
        ----------------- -->


    <section class="kundali-comp">
        <div class="common-container3">
            <div class="kundali-table">
                <table>
                    <thead>
                        <tr>
                            <th colspan="10" style="text-align: center; font-weight: bold; margin-top: 2rem;">
                                House Aspect by Planets ;
                                <label for="houseSelect">Select House:</label>
                                <select id="houseSelect">
                                    <option value="House1" selected>House 1</option>
                                    <option value="House2">House 2</option>
                                    <option value="House3">House 3</option>
                                    <option value="House4">House 4</option>
                                    <option value="House5">House 5</option>
                                    <option value="House6">House 6</option>
                                    <option value="House7">House 7</option>
                                    <option value="House8">House 8</option>
                                    <option value="House9">House 9</option>
                                    <option value="House10">House 10</option>
                                    <option value="House11">House 11</option>
                                    <option value="House12">House 12</option>
                                </select>
                            </th>
                        </tr>
                    </thead>
                    <tbody id="aspectData"></tbody>
                </table>
            </div>

            <script>
                const params = JSON.parse(localStorage.getItem('params'));
                const horoscopeData = JSON.parse(localStorage.getItem('horoscopeData'));
                const strengthData = JSON.parse(localStorage.getItem('strengthData'));
                const natureData = JSON.parse(localStorage.getItem('natureData'));

                const ApiUrl = "https://vedastroapi.azurewebsites.net/api/Calculate"
                const houses = [
            "House1", "House2", "House3", "House4", "House5", "House6",
            "House7", "House8", "House9", "House10", "House11", "House12"
        ];

        const planets = [
            "Sun", "Moon", "Mars", "Mercury", "Jupiter",
            "Venus", "Saturn", "Rahu", "Ketu"
        ];

        const aspectAllData = {}; // To store all aspect data for all houses

        // Fetch all house aspect data and store in aspectAllData
        async function fetchHouseAspectAllData() {
            for (let i = 0; i < houses.length; i++) {
                const house = houses[i];
                const houseAspectUrl = `${ApiUrl}/IsHouseAspectedByPlanet/HouseName/${house}/PlanetName/All9WithUpagrahas/Location/${params.location}/Time/${params.tob}/${params.dob}/+05:30`;

                try {
                    const response = await fetch(houseAspectUrl);
                    const data = await response.json();
                    const datas = data.Payload.IsHouseAspectedByPlanet.slice(0, 9);

                    // Initialize the house key with an empty object
                    aspectAllData[house] = {};
                    console.log(aspectAllData,"aspectAllData")

                    // Filter and process the aspect data for planets
                    datas.forEach(aspect => {
                        const planet = Object.keys(aspect)[0]; // Get the planet name
                        const isAspected = aspect[planet] === "True" ? "True" : "False";
                        aspectAllData[house][planet] = isAspected; // Store the aspect status
                    });
                } catch (error) {
                    console.error(`Error fetching data for ${house}:`, error);
                }
            }
        }

        // Fetch aspect data for a specific house and display in the UI
        const fetchHouseAspectData = async (house = "House1") => {
            try {
                const aspectDataDiv = document.getElementById("aspectData");
                aspectDataDiv.innerHTML = `<p class="loading">Loading...</p>`; // Show loading message while fetching data

                let tableHTML = `
                    <table>
                        <thead>
                            <tr>
                                <th>Planet</th>
                                <th>100% Aspect</th>
                                <th>75% Aspect</th>
                                <th>50% Aspect</th>
                                <th>25% Aspect</th>
                            </tr>
                        </thead>
                        <tbody>
                `;

                if (aspectAllData[house]) {
                    for (const planet of planets) {
                        const isAspected = aspectAllData[house][planet] === "True" ? "True" : "-";
                        const aspectRatios = isAspected === "True" ? ["-", "-", "-"] : findPlanetAspectRatios(planet, house);

                        tableHTML += `
                            <tr>
                                <td>${planet}</td>
                                <td>${isAspected}</td>
                                <td>${aspectRatios[0]}</td>
                                <td>${aspectRatios[1]}</td>
                                <td>${aspectRatios[2]}</td>
                            </tr>
                        `;
                    }
                } else {
                    tableHTML += `
                        <tr>
                            <td colspan="5">No data available for ${house}.</td>
                        </tr>
                    `;
                }

                tableHTML += `
                        </tbody>
                    </table>
                `;

                aspectDataDiv.innerHTML = tableHTML; // Display the table with data for the selected house
            } catch (error) {
                document.getElementById("aspectData").innerHTML = `<p class="error">Error: ${error.message}</p>`;
            }
        };

        // Function to find weaker aspect ratios
        const findPlanetAspectRatios = (planet, house) => {
            const aspectRatios = ["-", "-", "-"]; // Default percentages
            const houseIndex = parseInt(house.replace("House", "")) - 1;
            // for house 4 or 8
            const house4 = `House${(houseIndex + 6) % 12 || 12}`;
            const house8 = `House${(houseIndex + 10) % 12 || 12}`;
            // for house 5 or 9
            const house5 = `House${(houseIndex + 5) % 12 || 12}`;
            const house9 = `House${(houseIndex + 9) % 12 || 12}`;
            // for house 3 or 9
            const house3 = `House${(houseIndex + 4) % 12 || 12}`;
            const house10 = `House${(houseIndex + 11) % 12 || 12}`;

            // Fetch aspect data for each house
            if (aspectAllData[house4]?.[planet] === "True" || aspectAllData[house8]?.[planet] === "True") {
                aspectRatios[0] = "True";
            } else if (aspectAllData[house5]?.[planet] === "True" || aspectAllData[house9]?.[planet] === "True") {
                aspectRatios[1] = "True";
            } else if (aspectAllData[house3]?.[planet] === "True" || aspectAllData[house10]?.[planet] === "True") {
                aspectRatios[2] = "True";
            }

            return aspectRatios;
        };

        // Initialize
        document.addEventListener("DOMContentLoaded", async () => {
            await fetchHouseAspectAllData(); // Fetch all data on page load
            fetchHouseAspectData(); // Default fetch for House1
        });

        // Dropdown change listener
        document.getElementById("houseSelect").addEventListener("change", (event) => {
            const selectedHouse = event.target.value;
            if (selectedHouse) {
                fetchHouseAspectData(selectedHouse);
            } else {
                document.getElementById("aspectData").innerHTML = "<p>Please select a house.</p>";
            }
        });
            </script>

            <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
            <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
            <!-- Swiper Js file -->
            <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
            <!-- script file -->
            <script src="./js/index.js"></script>



</body>

</html>