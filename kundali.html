<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Kundali | Astro Nivesh</title>
    <!-- swiper slider css CDN -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.1/css/all.min.css"
        integrity="sha512-5Hs3dF2AEPkpNAR7UiOHba+lRSJNeM2ECkwxUIxC1Q/FLycGTbNapWXB4tP889k5T5Ju8fs4b1P5z/iB4nMfSQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <!-- Tempus Dominus CSS -->
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link rel="stylesheet" href="./css/style.css">
    <link rel="icon" href="/images/astrology.png" />
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-ZF2CQTE5JG"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-ZF2CQTE5JG');
    </script>
    <script src="https://cdn.pagesense.io/js/astronivesh/b70b9482d2454a09ac5feadc3675f35c.js"></script>
    <!-- JS libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>

</head>

<body>

    <!-- __________________________________ 
     Our header Comp 
     ------------------------ -->
    <!-- 
     <header class="header-comp">
        <div class="common-container3">

            <div class="header-flex-bx flex item-between">

                <div class="left-header-logo flex item-start gap">
                    <img src="./images/astrology.png" alt="">

                    <h6>Astro Nivesh</h6>
                    
                </div>

                <div class="right-navbar class-rel flex item-start gap">
                    <div class="navbar class-rel">
                    <nav class="nav class-rel">
                        <div class="nav-lists flex item-start">
                            <li><a href="#">Calendar</a></li>
                            <li><a href="#">Market</a></li>
                            <li><a href="#">Kundali</a></li>
                            <li><a href="#">Affirmations</a></li>
                            <li><a href="#">Runes</a></li>
                            <li><a href="#">Healing</a></li>
                            <li><a href="#">Wisdom</a></li>
                        </div>
                    </nav>
                </div>

                <div class="header-icons-flex-bx class-rel flex gap">

                    <a href="#">
                        <button class="headr-btn">
                            <ion-icon name="cart-outline"></ion-icon>
                            <span>Store</span>
                        </button>
                    </a>

                    <a href="#">
                        <button id="login_btn" class="headr-btn headr-btn2">
                            <ion-icon name="person"></ion-icon>
                            <span>Login</span>
                        </button>
                    </a>
                    
                </div>

                <button class="menu-bar-btn">
                    <i class="fa-solid fa-bars-staggered"></i>
                </button>
                
                </div>
                
            </div>
            
        </div>
     </header> -->

    <section class="top-header-comp">
        <div class="common-container3 top-header-flex flex item-between">
            <div class="left-header-logo flex item-start gap" onclick="window.location.href='home.html'">
                <img src="./images/astrology.png" alt="">

                <h6>Astro Nivesh</h6>

            </div>

            <div class="right-top-header-flex-bx flex item-start gap">

                <!-- <div class="top-hedr-bx flex item-center">
                    <div class="left-hedr-icon">
                        <ion-icon name="home"></ion-icon>
                    </div>
                    <div class="right-hedr-inof">
                        <h6>Reach Us</h6>
                        <span>601 , Ram Nagar Dewas</span>
                    </div>
                </div> -->

                <div class="top-hedr-bx flex item-center">
                    <div class="left-hedr-icon">
                        <ion-icon name="call"></ion-icon>
                    </div>
                    <div class="right-hedr-inof">
                        <h6>Talk to Us</h6>
                        <span>+91-8421616117</span>
                    </div>
                </div>


                <button class="menu-bar-btn">
                    <ion-icon name="menu"></ion-icon>
                </button>

                <div class="cart-bx cart-bx2">
                    <button class="cart-btn cart-btn2" onclick="goToCart()">
                        <span class="qty" id="cart-count2">0</span>
                        <ion-icon name="bag"></ion-icon>
                    </button>
                </div>

                <button class="apnt-btn" onclick="window.location.href='appointments.html'">
                    Talk to Astrologer
                </button>

                <div class="profile-bx" id="login_btn">
                    <ion-icon name="person-circle-outline" size="large" color="#fe7000"></ion-icon>
                    <p id="profile-name">LogIn / Reg.</p>
                </div>

            </div>

        </div>
    </section>


    <header class="header">
        <div class="common-container3 header-flex flex item-between gap">

            <div class="nav-overlay"></div>
            <div class="navbar">

                <button class="close-nav-btn">
                    <ion-icon name="close-circle"></ion-icon>
                </button>

                <div class="left-header-logo flex item-start gap mob-logo" onclick="window.location.href='home.html'">
                    <img src="./images/astrology.png" alt="">

                    <h6>Astro Nivesh</h6>

                </div>

                <div class="search-inpt-bx search-inpt-bx-mob">
                    <input type="text" name="search" id="search" placeholder="Search here...">
                    <button class="search-btn">
                        <ion-icon name="search"></ion-icon>
                    </button>
                </div>

                <nav class="nav">
                    <div class="nav-lists flex item-start">
                        <li><a href="home.html">Home</a></li>
                        <li><a href="kundali.html">Kundali</a></li>
                        <li><a href="market.html">Market</a></li>
                        <li><a href="product.html">Astro Store</a></li>
                        <li><a href="pooja.html">Pooja</a></li>
                        <li>
                            <div class="category-item">
                                <div class="category-item-box">
                                    <p>Items</p>
                                </div>
                                <div class="dropdown">
                                    <p><a href="gochar.html" style="color: black;">Gochar</a></p>
                                    <p><a href="panchang.html" style="color: black;">Panchang</a></p>
                                    <p><a href="blogs.html" style="color: black;">Blog</a></p>

                                    <div class="healing-item">
                                        <div class="healing-item-box">
                                            <p>Healing <ion-icon name="chevron-forward-outline"></ion-icon></p>
                                        </div>
                                        <div class="healing-dropdown">
                                            <div class="healing">
                                                <p><a href="healing.html?stotra=1">Bhaktamar Stotra 1 </a></p>
                                                <p><a href="healing.html?stotra=2">Bhaktamar Stotra 2 </a></p>
                                                <p><a href="healing.html?stotra=3">Bhaktamar Stotra 3 </a></p>
                                                <p><a href="healing.html?stotra=4">Bhaktamar Stotra 4 </a></p>
                                                <p><a href="healing.html?stotra=5">Bhaktamar Stotra 5 </a></p>
                                                <p><a href="healing.html?stotra=6">Bhaktamar Stotra 6 </a></p>
                                                <p><a href="healing.html?stotra=7">Bhaktamar Stotra 7 </a></p>
                                                <p><a href="healing.html?stotra=8">Bhaktamar Stotra 8 </a></p>
                                                <p><a href="healing.html?stotra=9">Bhaktamar Stotra 9 </a></p>
                                                <p><a href="healing.html?stotra=10">Bhaktamar Stotra 10 </a></p>
                                                <p><a href="healing.html?stotra=11">Bhaktamar Stotra 11 </a></p>
                                                <p><a href="healing.html?stotra=12">Bhaktamar Stotra 12 </a></p>
                                                <p><a href="healing.html?stotra=13">Bhaktamar Stotra 13 </a></p>
                                                <p><a href="healing.html?stotra=14">Bhaktamar Stotra 14 </a></p>
                                                <p><a href="healing.html?stotra=15">Bhaktamar Stotra 15 </a></p>
                                                <p><a href="healing.html?stotra=16">Bhaktamar Stotra 16 </a></p>
                                                <p><a href="healing.html?stotra=17">Bhaktamar Stotra 17 </a></p>
                                                <p><a href="healing.html?stotra=18">Bhaktamar Stotra 18 </a></p>
                                                <p><a href="healing.html?stotra=19">Bhaktamar Stotra 19 </a></p>
                                                <p><a href="healing.html?stotra=20">Bhaktamar Stotra 20 </a></p>
                                                <p><a href="healing.html?stotra=21">Bhaktamar Stotra 21 </a></p>
                                                <p><a href="healing.html?stotra=22">Bhaktamar Stotra 22 </a></p>
                                                <p><a href="healing.html?stotra=23">Bhaktamar Stotra 23 </a></p>
                                                <p><a href="healing.html?stotra=24">Bhaktamar Stotra 24 </a></p>
                                                <p><a href="healing.html?stotra=25">Bhaktamar Stotra 25 </a></p>
                                                <p><a href="healing.html?stotra=26">Bhaktamar Stotra 26 </a></p>
                                                <p><a href="healing.html?stotra=27">Bhaktamar Stotra 27 </a></p>
                                                <p><a href="healing.html?stotra=28">Bhaktamar Stotra 28 </a></p>
                                                <p><a href="healing.html?stotra=29">Bhaktamar Stotra 29 </a></p>
                                                <p><a href="healing.html?stotra=30">Bhaktamar Stotra 30 </a></p>
                                                <p><a href="healing.html?stotra=31">Bhaktamar Stotra 31 </a></p>
                                                <p><a href="healing.html?stotra=32">Bhaktamar Stotra 32 </a></p>
                                                <p><a href="healing.html?stotra=33">Bhaktamar Stotra 33 </a></p>
                                                <p><a href="healing.html?stotra=34">Bhaktamar Stotra 34 </a></p>
                                                <p><a href="healing.html?stotra=35">Bhaktamar Stotra 35 </a></p>
                                                <p><a href="healing.html?stotra=36">Bhaktamar Stotra 36 </a></p>
                                                <p><a href="healing.html?stotra=37">Bhaktamar Stotra 37 </a></p>
                                                <p><a href="healing.html?stotra=38">Bhaktamar Stotra 38 </a></p>
                                                <p><a href="healing.html?stotra=39">Bhaktamar Stotra 39 </a></p>
                                                <p><a href="healing.html?stotra=40">Bhaktamar Stotra 40 </a></p>
                                                <p><a href="healing.html?stotra=41">Bhaktamar Stotra 41 </a></p>
                                                <p><a href="healing.html?stotra=42">Bhaktamar Stotra 42 </a></p>
                                                <p><a href="healing.html?stotra=43">Bhaktamar Stotra 43 </a></p>
                                                <p><a href="healing.html?stotra=44">Bhaktamar Stotra 44 </a></p>
                                                <p><a href="healing.html?stotra=45">Bhaktamar Stotra 45 </a></p>
                                                <p><a href="healing.html?stotra=46">Bhaktamar Stotra 46 </a></p>
                                                <p><a href="healing.html?stotra=47">Bhaktamar Stotra 47 </a></p>
                                                <p><a href="healing.html?stotra=48">Bhaktamar Stotra 48 </a></p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </li>
                    </div>
                </nav>

                <div class="astrology-cont-info">

                    <!-- <div class="top-hedr-bx flex item-center">
                        <div class="left-hedr-icon">
                            <ion-icon name="home"></ion-icon>
                        </div>
                        <div class="right-hedr-inof">
                            <h6>Reach Us</h6>
                            <span>601 , Ram Nagar Dewas</span>
                        </div>
                    </div> -->

                    <div class="top-hedr-bx flex item-center">
                        <div class="left-hedr-icon">
                            <ion-icon name="call"></ion-icon>
                        </div>
                        <div class="right-hedr-inof">
                            <h6>Talk to Us</h6>
                            <span>+91-8421616117</span>
                        </div>
                    </div>

                </div>


                <button class="apnt-btn apnt-btn-mob" onclick="window.location.href='appointments.html'">
                    Talk to Astrologer
                </button>

            </div>

            <div class="right-header-flex flex item-start ">
                <div class="search-inpt-bx">
                    <input type="text" name="search" id="search" placeholder="Search here...">
                    <button class="search-btn">
                        <ion-icon name="search"></ion-icon>
                    </button>
                </div>
                <div class="cart-bx">
                    <button class="cart-btn" onclick="goToCart()">
                        <span class="qty" id="cart-count">0</span>
                        <ion-icon name="bag"></ion-icon>
                    </button>
                </div>

            </div>

        </div>
    </header>

    <!-- _______________________
       Our Login Reg Comp 
       ------------------ -->

    <section class="login-reg-comp">

        <div class="login-bx ">

            <button class="close-form-btn">
                <i class="fa-solid fa-xmark"></i>
            </button>

            <div class="login-info">

                <div class="login-logo">
                    <img src="./images/astrology.png" alt="">
                </div>



                <div class="comn-heading">
                    <h4>Sign In to Astrology </h4>
                    <!-- <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Minima maxime est obcaecati.</p> -->
                </div>

                <div class="login-form">

                    <form onsubmit="handleSubmit(event)">

                        <div class="inpt-bx">
                            <label for="email">Email Address</label>
                            <div class="inpt">
                                <input type="email" id="email" name="email" placeholder="Enter your Email..."
                                    autocomplete="off" required>

                            </div>
                        </div>

                        <div class="inpt-bx">
                            <label for="email">Password</label>
                            <div class="inpt">
                                <input type="password" id="password" name="password"
                                    placeholder="Enter your password..." autocomplete="off" required>
                            </div>
                        </div>

                        <div class="form-btns-flex">

                            <button class="form-btn" type="submit">
                                Sign In
                            </button>

                            <button type="button" class="form-btn form-btn2" id="newAcnt">
                                Create Account
                            </button>

                        </div>
                        <div id="alert" class="alert"></div>


                    </form>


                </div>
            </div>

            <div class="reg-info">

                <div class="login-logo">
                    <img src="./images/astrology.png" alt="">
                </div>

                <div class="comn-heading">
                    <h4>Sign Up to Astrology </h4>
                    <!-- <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Minima maxime est obcaecati.</p> -->
                </div>

                <div class="login-form">
                    <form onsubmit="handleCreate(event)">

                        <div class="inpt-bx">
                            <label for="name">Name</label>
                            <div class="inpt">
                                <input type="text" name="cname" placeholder="Enter your Name" autocomplete="off"
                                    required>
                            </div>
                        </div>

                        <div class="inpt-bx">
                            <label for="name">Email</label>
                            <div class="inpt">
                                <input type="email" name="cemail" placeholder="Enter your email address..."
                                    autocomplete="off" required>
                            </div>
                        </div>

                        <div class="inpt-bx">
                            <label for="password">Create Password</label>
                            <div class="inpt">
                                <input type="text" name="ccreatepassword" placeholder="Create your password..."
                                    autocomplete="off" required>
                            </div>
                        </div>


                        <div class="inpt-bx">
                            <label for="password">Date Of Birth</label>
                            <div class="inpt">
                                <input type="text" id="calendarInput" name="calendarInput"
                                    placeholder="Choose a date" />
                            </div>
                        </div>

                        <div class="inpt-bx">
                            <label for="password">Birth Time</label>
                            <div class="inpt">
                                <input type="text" id="timePicker" name="timePicker" class="time-picker"
                                    placeholder="Select Time">
                            </div>
                        </div>
                        <div class="inpt-bx">
                            <label for="birthplace">Birth Place</label>
                            <div class="inpt">
                                <input type="text" name="birthplace" placeholder="Enter your Birth Place..."
                                    autocomplete="off" required>
                            </div>
                        </div>
                        <div class="inpt-bx">
                            <label for="consonent">Consonent of your name</label>
                            <div class="inpt">
                                <input type="text" name="consonent" placeholder="Enter your Consonent..."
                                    autocomplete="off" required>
                            </div>
                        </div>
                        <div class="inpt-bx">
                            <label for="vowel">Vowel of your name</label>
                            <div class="inpt">
                                <input type="text" name="vowel" placeholder="Enter your Vowel..." autocomplete="off"
                                    required>
                            </div>
                        </div>

                        <div class="form-btns-flex">

                            <button class="form-btn" type="submit">
                                Create Account
                            </button>

                            <button class="form-btn  form-btn3" type="button" id="signInBtn">
                                I Already Have Account
                            </button>

                        </div>

                    </form>


                </div>

            </div>
            <div class="profile-info">
                <div class="login-logo">
                    <img src="./images/astrology.png" alt="">
                </div>
                <div class="comn-heading">
                    <h4>Astro Nivesh</h4>
                </div>

                <div id="profile-body"></div>
                <a style=" display: flex; align-items: center; justify-content: center;  font-size: 18px; padding-top: 1rem;"
                    href="profile.html"><i class="fa-solid fa-user" style="margin-right: 10px;"></i>My Profile</a>
                <div class="logout-bx" id="logoutBox">
                    <p><ion-icon name="log-out"></ion-icon>Log Out</p>
                </div>
            </div>

        </div>

    </section>

    <!-- ______________________________
        Our kundali comp 
        ----------------- -->


    <section class="kundali-comp">
        <div class="common-container3">

            <div class="kundali-container">
                <h5>Kundali Chart <button class="pdf-download" id="downloadPdfBtn">Download PDF</button></h5>

                <div class="kundali-img-bx">
                    <!-- Charts -->
                    <div class="kundli-img">

                        <div class="kundali-img-nres">
                            <div id="lagnaChart" class="kundli-chart active">
                                <div id="horoscope-chart1" class="chart-container1">
                                    <!-- <p>Lagna</p> -->
                                </div>
                                <p>Lagna</p>
                            </div>
                            <div id="navamsaChart" class="kundli-chart">
                                <div id="horoscope-chart2" class="chart-container2">
                                    <!-- <p>Navamsa</p> -->
                                </div>
                                <p>Navamsa</p>
                            </div>
                        </div>
                        <div class="kundali-img-nres others">
                            <div id="navamsaChart" class="kundli-chart active">
                                <div id="horoscope-chart3" class="chart-container3">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Buttons to toggle -->
                    <div class="kundali-buttons">
                        <button id="lagnaBtn" class="active">Lagna</button>
                        <button id="navamsaBtn">Navamsa</button>
                    </div>
                    <div class="chart-toggle-buttons">
                        <!-- <button id="lagna-btn" class="active" onclick="showChart('lagna')">Lagna</button>
                        <button id="navamsa-btn" onclick="showChart('navamsa')">Navamsa</button> -->
                        <!-- <button><a href="gochar.html">Gochar</a></button>
                        <button><a href="aspectratio.html">Aspect Ratio</a></button>
                        <button><a href="birthchart.html">Birth Chart</a></button> -->
                    </div>
                    <!-- <div class="chart-toggle-buttons2"> -->
                    <!-- <button><a href="consonantvedh.html">Consonant Vedh</a></button>
                        <button><a href="dayvedh.html">Day Vedh</a></button>
                        <button><a href="frontvedh.html">Front Vedh</a></button>
                        <button><a href="lifeaspect.html">Life aspect</a></button>
                        <button><a href="lifeaspectwithpada.html">Life aspect(pada)</a></button>
                        <button><a href="rashi.html">Rashi</a></button> -->
                    <!-- <button><a href="monthlypunchang.html">Monthly Punchang</a></button> -->
                    <!-- <button><a href="tableofday.html">Table of Day</a></button> -->
                    <!-- <button><a href="tithi.html">Tithi</a></button>
                        <button><a href="profiledet.html">Profile Detail</a></button>
                        <button><a href="rashiplanetposition.html">Rashi Planet</a></button>
                        <button><a href="nakshatraPlanetPosition.html">Nakshatra Planet</a></button> -->
                    <!-- </div> -->
                </div>
            </div>

            <style>
                /* @media all and (min-width: 320px) and (max-width: 767px) {
                    .chart-toggle-buttons {
                        position: absolute;
                        bottom: -60px;
                        left: 33%;
                        transform: translateX(-50%);
                        display: flex !important;
                        gap: 10px;
                    }

                    .kundali-img-nres {
                        display: none !important;
                    }
                } */

                .kundali-container h5 {
                    margin-bottom: 1rem;
                    text-align: center;
                }

                .kundli-chart p {
                    text-align: center;
                }



                .kundali-img-bx {

                    position: relative;
                    margin-bottom: 8rem;
                }


                .kundli-img {
                    display: flex;
                    align-items: center;
                    justify-content: space-around;
                    position: relative;
                    width: 100%;
                }

                .chart-toggle-buttons2 {
                    display: grid;
                    grid-template-columns: repeat(5, 1fr);
                    gap: 10px;
                    width: 100%;
                    max-width: 110rem;
                    margin: 0px auto;
                    margin: 2rem 0;
                }

                .chart-toggle-buttons button,
                .chart-toggle-buttons2 button {
                    padding: 10px 20px;
                    border: none;
                    cursor: pointer;
                    background-color: #f0f0f0;
                    font-size: 16px;
                    border-radius: 5px;
                    transition: background-color 0.3s ease;
                }

                .chart-toggle-buttons button.active,
                .chart-toggle-buttons2 button.active {
                    background-color: #fe7000;
                    color: white;
                }

                .gochara-house {
                    display: flex;
                    flex-direction: column;
                }

                .gochara-house-btn {
                    margin-top: 1rem;
                    padding: 10px 20px;
                    border: none;
                    cursor: pointer;
                    font-size: 16px;
                    border-radius: 5px;
                    transition: background-color 0.3s ease;
                    background-color: #fe7000;
                    color: white;
                }

                .btn {
                    padding: 10px 15px;
                    margin: 5px;
                    border: none;
                    cursor: pointer;
                    background-color: lightgray;
                    transition: 0.3s;
                }

                .section {
                    display: none;
                    /* Hide all sections initially */
                }

                .visible {
                    display: block;
                    /* Show active section */
                }

                .house-factors-selc-bx {
                    margin-bottom: 2rem;
                }
            </style>
            <div class="chart-toggle-buttons2">
                <button class="btn active" onclick="setActive(0)">Planet</button>
                <button class="btn" onclick="setActive(1)">House</button>
                <button class="btn" onclick="setActive(2)">Dasa</button>
                <button class="btn" onclick="setActive(3)">Panchang</button>
                <button class="btn" onclick="setActive(4)">Gochar</button>
            </div>

            <div class="table-data">
                <div id="planet-section" class="section visible">
                    <table>
                        <thead>
                            <tr>
                                <th>Planet</th>
                                <th>R</th>
                                <th>C</th>
                                <th>Zodiac</th>
                                <th>House</th>
                                <th>Nakshatra Lord</th>
                                <th>Nakshatra</th>
                                <th>Pada</th>
                                <th>Zodiac Lord</th>
                                <th>Latitude</th>

                            </tr>
                        </thead>
                        <tbody id="planet-data"></tbody>
                    </table>
                </div>
                <!-- House data Here -->
                <div id="house-section" class="section">
                    <div class="house-factors-selc-bx">
                        <div class="house-fact-sel-bx">
                            <label for="houses">Houses</label>
                            <select id="houseDropdown">
                                <option value="1" selected>House 1</option>
                                <option value="2">House 2</option>
                                <option value="3">House 3</option>
                                <option value="4">House 4</option>
                                <option value="5">House 5</option>
                                <option value="6">House 6</option>
                                <option value="7">House 7</option>
                                <option value="8">House 8</option>
                                <option value="9">House 9</option>
                                <option value="10">House 10</option>
                                <option value="11">House 11</option>
                                <option value="12">House 12</option>
                            </select>
                        </div>

                        <div class="house-fact-sel-bx">
                            <label for="factors">Nature</label>
                            <select id="rashiNakSelect">
                                <option value="Rashi" selected>Rashi</option>
                                <option value="Nakshatra">Nakshatra</option>
                            </select>
                        </div>
                        <div class="house-fact-sel-bx">
                            <label for="factors">Divisional Chart</label>
                            <select id="divisionalSelect">
                                <option value="D1" selected>D1 - Lagna</option>
                                <option value="D3">D3</option>
                                <option value="D3-s">D3-s</option>
                                <option value="D7">D7</option>
                                <option value="D9">D9</option>
                                <option value="D10">D10</option>
                                <option value="D10-R">D10-R</option>
                                <option value="D12">D12</option>
                                <option value="D16">D16</option>
                                <option value="D20">D20</option>
                                <option value="D24">D24</option>
                                <option value="D24-R">D24-R</option>
                                <option value="D30">D30</option>
                                <option value="D40">D40</option>
                                <option value="D45">D45</option>
                                <option value="D60">D60</option>
                            </select>
                        </div>

                    </div>

                    <div class="common-container3">

                        <div class="table-data">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Nakshatra(Pada)</th>
                                        <th>Rashi</th>
                                        <th>Planets </th>
                                        <th>Nature</th>
                                        <th>Dasha</th>
                                    </tr>
                                </thead>
                                <tbody data-table="positive" class="tableBody showtablebody" id="thirdTable">
                                </tbody>
                            </table>
                            <h6 style="margin: 2rem 0 1rem 0;">Planet Aspect</h6>
                            <table>
                                <thead>
                                    <tr>
                                        <th>Nakshatra(Pada)</th>
                                        <th>Rashi</th>
                                        <th>Planets </th>
                                        <th>Nature</th>
                                        <th>Dasha</th>
                                    </tr>
                                </thead>
                                <tbody data-table="positive" class="tableBody showtablebody" id="fourthTable">
                                </tbody>
                            </table>
                            <h6 style="margin: 2rem 0 1rem 0;">Gochar</h6>
                            <table>
                                <thead>
                                    <tr>
                                        <th>Nakshatra(Pada)</th>
                                        <th>Rashi</th>
                                        <th>Planets </th>
                                        <th>Nature</th>
                                        <th>Dasha</th>
                                        <th>Gochar</th>
                                    </tr>
                                </thead>
                                <tbody data-table="positive" class="tableBody showtablebody" id="fifthTable">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Dasa Details Section -->
                <div id="dasa-section" class="section">
                    <table>
                        <thead>
                            <tr>
                                <th colspan="10" style="text-align: center; font-weight: bold; margin-top: 2rem;">
                                    Dasa Details
                                </th>
                            </tr>
                        </thead>
                        <tbody id="dasa-data"></tbody>
                    </table>

                    <div class="cards-grid grid grid-two-col grid-gap">
                        <div class="kundali-dashaCards">
                            <h6>Maha Dasha</h6>
                            <p><strong>Dasha Remaining:</strong> <span id="dasha_remaining"></span></p>
                            <p><strong>Dasha Start Date:</strong> <span id="dasha_start_date"></span></p>
                            <p><strong>Start Year:</strong> <span id="start_year"></span></p>

                            <table>
                                <thead>
                                    <tr>
                                        <th>Planet</th>
                                        <th>Mahadasha Order</th>
                                    </tr>
                                </thead>
                                <tbody id="dashaTableBody"></tbody>
                            </table>
                        </div>
                        <div class="kundali-dashaCards">

                            <h6>Char Dasha</h6>
                            <p><strong>Start Date:</strong> <span id="startDate"></span></p>

                            <table>
                                <thead>
                                    <tr>
                                        <th>Zodiac Sign</th>
                                        <th>Dasha End Date</th>
                                    </tr>
                                </thead>
                                <tbody id="charDashaTableBody"></tbody>
                            </table>
                        </div>
                        <div class="kundali-dashaCards">
                            <h6>Antar Dasha</h6>

                            <table>
                                <thead>
                                    <tr>
                                        <th>Planet</th>
                                        <th>Antardasha Order</th>
                                    </tr>
                                </thead>
                                <tbody id="antardashaTableBody"></tbody>
                            </table>
                        </div>

                        <div class="kundali-dashaCards">
                            <h6>Yogini Dasha</h6>
                            <p><strong>Start Date:</strong> <span id="yoginistartDate"></span></p>
                            <table>
                                <thead>
                                    <tr>
                                        <th>Yogini Dasha</th>
                                        <th>Yogini Lord</th>
                                        <th>End Date</th>
                                    </tr>
                                </thead>
                                <tbody id="yoginiDashaTableBody"></tbody>
                            </table>
                        </div>

                    </div>
                    <div class="kundali-dashaCards">
                        <h6>Char Dasha sub</h6>
                        <table>
                            <thead>
                                <tr>
                                    <th>Main Dasha</th>
                                    <th>Main Dasha Lord</th>
                                    <th>Sub Dasha</th>
                                    <th>Sub Dasha Start Date</th>
                                    <th>Sub Dasha End Date</th>
                                </tr>
                            </thead>
                            <tbody id="charSubDashaTableBody"></tbody>
                        </table>
                    </div>
                    <div class="kundali-dashaCards">
                        <h6>Yogini Dasha Sub</h6>
                        <table>
                            <thead>
                                <tr>
                                    <th>Yogini Dasha</th>
                                    <th>Yogini Lord</th>
                                    <th>Sub Dasha</th>
                                    <th>Start Date</th>
                                    <th>End Date</th>
                                </tr>
                            </thead>
                            <tbody id="yoginiSubDashaTableBody"></tbody>
                        </table>
                    </div>
                    <div class="cards-grid grid grid-two-col grid-gap">
                        <div class="kundali-dashaCards">
                            <h6>Paryantar Dasha</h6>
                            <table>
                                <thead>
                                    <tr>
                                        <th>Paryantardasha</th>
                                        <th>Date</th>
                                    </tr>
                                </thead>
                                <tbody id="paryantarDashaTableBody"></tbody>
                            </table>
                        </div>
                    </div>

                </div>

                <!-- Panchang Details Section -->
                <div id="panchang-section" class="section">
                    <table>
                        <thead>
                            <tr>
                                <th colspan="10" style="text-align: center; font-weight: bold; margin-top: 2rem;">
                                    Panchang Details
                                </th>
                            </tr>
                        </thead>
                        <tbody id="panchang-data"></tbody>
                    </table>
                </div>

                <!-- Gochar Details Section -->
                <div id="gochar-section" class="section">
                    <table id="gocharTable">
                        <thead>
                            <tr>
                                <th>Planet Name</th>
                                <th>Rashi</th>
                                <th>Nakshatra</th>
                                <th>Pada</th>
                                <th>Combust</th>
                                <th>Motion</th>
                                <th>Date of Entry</th>
                                <th>Date of Exit</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>
    </section>
    <!-- ____________________________
          Our Footer Comp 
          -------------------- -->

    <footer class="footer-comp">
        <div class="common-container3">

            <div class="footer-flex-bx">

                <div class="left-footer-bx">

                    <div class="left-header-logo flex item-start gap">
                        <img src="./images/astrology.png" alt="" onclick="window.location.href='home.html'">

                        <h6>Astro Nivesh</h6>


                    </div>




                    <p>
                        Astro Nivesh is best astrology website for online Astrology predictions. Talk to Astrologer on
                        call and get answers to all your worries by seeing the future life through Astrology Kundli
                        Predictions from the best Astrologers from India. Get best future predictions related to
                        Marriage, love life, Career or Health over call, chat, query or report.
                    </p>

                </div>


                <div class="right-footer-bx">

                    <div class="footer-bx">
                        <h6>Corporate Info</h6>
                        <div class="footer-li">
                            <li><a href="aboutus.html">About Us</a></li>
                            <li><a href="contactus.html">Contact Us</a></li>
                            <li><a href="termsconditions.html">Terms & Conditions</a></li>
                            <li><a href="privacypolicy.html">Privacy Policy</a></li>
                            <!-- <li><a href="shippingpolicy.html">Shipping Policy</a></li> -->
                            <li><a href="refundpolicy.html">Refund Policy</a></li>
                        </div>
                    </div>


                    <div class="footer-bx">
                        <h6>Contact Info</h6>
                        <div class="footer-li">
                            <li><a href="#"> We are available 24x7 on chat support</a></li>
                            <li><a href="#">Email ID: contact@astronivesh.com</a></li>

                            <div class="soc-icons-flex">
                                <a href="#">
                                    <ion-icon name="logo-facebook"></ion-icon>
                                </a>
                                <a href="https://www.instagram.com/astro_nivesh/">
                                    <ion-icon name="logo-instagram"></ion-icon>
                                </a>
                                <a href="#">
                                    <ion-icon name="logo-linkedin"></ion-icon>
                                </a>
                                <a href="https://www.youtube.com/@astronivesh">
                                    <ion-icon name="logo-youtube"></ion-icon>
                                </a>
                            </div>

                        </div>
                    </div>


                </div>

            </div>

            <div class="copyright-bx">
                <p>Copyright 2025 Astro Nivesh (This website is owned and managed by Shriram Lalasaheb Magar) | All
                    Rights Reserved | Dev. By: <a href="https://digitaldezire.com/">Digital Dezire</a></p>
            </div>
        </div>
    </footer>
    <script>
        const urlParams = new URLSearchParams(window.location.search);
        // const token = urlParams.get('token');
        const userIds = urlParams.get('userIds');
        // console.log(token, "token2")
        // console.log(userIds, "userIds")
        // console.log(urlParams,"urlParams")
        let token = []
        if (urlParams.size >= 1) {
            token = urlParams.get('token');
            // console.log(token,"token of admin")
        }
        else {
            token = localStorage.getItem("token");
            // console.log(token,"token of users")
        }

        const host = "https://api.astronivesh.com";
        async function fetchAllData() {
            try {
                const response = await fetch(`${host}/api/auth/getuser`, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "auth-token": token
                    }
                });

                if (!response.ok == true) {
                    throw new Error("Failed to fetch data");
                }

                const data = await response.json();
                if (urlParams.size >= 1) {
                    const responseAll = await fetch(`${host}/api/auth/getallusers`, {
                        method: "GET",
                        headers: {
                            "auth-token": token,
                            "Content-Type": "application/json",
                        },
                    });

                    if (!responseAll.ok) {
                        throw new Error("Failed to fetch users");
                    }

                    const json = await responseAll.json();
                    // console.log(json)
                    const data = json.find((i) => i._id === userIds)
                    populatePTable(data)
                    populateName(data)
                }
                else {
                    populatePTable(data)
                    populateName(data)
                }
                // localStorage.setItem("admin_id", (data.map((entry) => (entry._id))))
            } catch (error) {
                console.error(error);
                // alert("Error fetching data: " + error.message);
            }
        }

        function populatePTable(data) {
            const tableBody = document.getElementById("profile-body");
            tableBody.innerHTML = "";

            tableBody.innerHTML = `
            <div class="profile-desc">
                <h4>${data.name}</h4>
            </div>
             
            `
        }
        function populateName(data) {
            const tableBody = document.getElementById("profile-name");
            tableBody.innerHTML = "";

            tableBody.innerHTML = `
            <p>${data.name}</p>
             
            `
        }
        document.addEventListener("DOMContentLoaded", function () {
            // console.log(token, "token")
            const loginForm = document.querySelector(".login-info");
            const regInfo = document.querySelector(".reg-info");
            const profileInfo = document.querySelector(".profile-info");

            if (token) {
                // User is logged in, show profile and hide login/signup forms
                loginForm.style.display = "none";
                regInfo.style.display = "none";
                profileInfo.style.display = "block";
            } else {
                // User is not logged in, show login/signup forms
                loginForm.style.display = "block";
                regInfo.style.display = "block";
                profileInfo.style.display = "none";
                window.location.href = "./index.html";
            }

            // Logout functionality
            const logoutBox = document.getElementById("logoutBox");
            if (logoutBox) {
                logoutBox.addEventListener("click", function () {
                    localStorage.removeItem("token");
                    localStorage.removeItem('params');
                    window.location.href = "./index.html";
                });
            }
        });
    </script>
    <script>
        function setActive(index) {
            let buttons = document.querySelectorAll(".btn");
            let sections = document.querySelectorAll(".section");

            // Remove active class from all buttons and hide all sections
            buttons.forEach(btn => btn.classList.remove("active"));
            sections.forEach(section => section.classList.remove("visible"));

            // Add active class to clicked button and show corresponding section
            buttons[index].classList.add("active");
            sections[index].classList.add("visible");
        }
    </script>
    <script>
        async function fetchData() {
            try {
                const response = await fetch(`${host}/api/admindetail/all`);
                const data = await response.json();

                const api = data[0]?.apiKey || [];
                const apiKey = api[0]?.apiKey;
                // console.log(data,"data")

                if (!Array.isArray(data) || data.length === 0 || !data[0].gochar || !Array.isArray(data[0].gochar)) {
                    throw new Error("Invalid data format: 'gochar' is missing or not an array.");
                }

                let gocharData = data[0].gochar;
                // console.log(gocharData, "gocharData")
                const normalizeDate = (date) => new Date(date.getFullYear(), date.getMonth(), date.getDate());
                const today = normalizeDate(new Date());

                let filteredData = gocharData.filter(entry => {
                    const entryDate = normalizeDate(new Date(entry.date_of_entry));
                    const exitDate = normalizeDate(new Date(entry.date_of_exit));
                    return today >= entryDate && today <= exitDate;
                });

                filteredData = filteredData.reduce((unique, entry) => {
                    const exitDate = normalizeDate(new Date(entry.date_of_exit));

                    if (exitDate.getTime() === today.getTime()) {
                        unique[entry.planet_name] = entry;
                    } else if (!unique[entry.planet_name]) {
                        unique[entry.planet_name] = entry;
                    }

                    return unique;
                }, {});

                // Convert back to an array
                filteredData = Object.values(filteredData);

                const planetOrder = ["Ascendant", "Sun", "Moon", "Mars", "Mercury", "Jupiter", "Venus", "Saturn", "Rahu", "Ketu"];

                // Sort based on custom planet order
                filteredData.sort((a, b) => {
                    return planetOrder.indexOf(a.planet_name) - planetOrder.indexOf(b.planet_name);
                });
                // Populate the table
                const tableBody = document.querySelector("#gocharTable tbody");
                tableBody.innerHTML = "";

                filteredData.forEach(entry => {
                    const row = `<tr>
                <td>${entry.planet_name || "N/A"}</td>
                <td>${entry.rashi || "N/A"}</td>
                <td>${entry.nakshatra || "N/A"}</td>
                <td>${entry.pada || "N/A"}</td>
                <td>${entry.combust ? "Yes" : "No"}</td>
                <td>${entry.motion || "N/A"}</td>
                <td>${entry.date_of_entry || "N/A"}</td>
                <td>${entry.date_of_exit || "N/A"}</td>
            </tr>`;
                    tableBody.innerHTML += row;
                });

            } catch (error) {
                console.error("Error fetching data:", error);
            }
        }

        fetchData();
    </script>

    <script>
        // function showChart(chartType) {
        //     // Get chart containers and buttons
        //     const lagnaChart = document.getElementById("horoscope-chart1");
        //     const navamsaChart = document.getElementById("horoscope-chart2");
        //     const moreChart = document.getElementById("horoscope-chart3");
        //     const lagnaBtn = document.getElementById("lagna-btn");
        //     const navamsaBtn = document.getElementById("navamsa-btn");

        //     if (chartType === "lagna") {
        //         lagnaChart.style.display = "block";
        //         navamsaChart.style.display = "none";
        //         lagnaBtn.classList.add("active");
        //         navamsaBtn.classList.remove("active");
        //     } else if (chartType === "navamsa") {
        //         lagnaChart.style.display = "none";
        //         navamsaChart.style.display = "block";
        //         navamsaBtn.classList.add("active");
        //         lagnaBtn.classList.remove("active");
        //     }
        // }
        const lagnaBtn = document.getElementById('lagnaBtn');
        const navamsaBtn = document.getElementById('navamsaBtn');
        const lagnaChart = document.getElementById('lagnaChart');
        const navamsaChart = document.getElementById('navamsaChart');

        // Only apply toggle logic on mobile
        function handleToggle(view) {
            if (window.innerWidth < 768) {
                if (view === 'lagna') {
                    lagnaChart.classList.add('active');
                    navamsaChart.classList.remove('active');
                    lagnaBtn.classList.add('active');
                    navamsaBtn.classList.remove('active');
                } else {
                    navamsaChart.classList.add('active');
                    lagnaChart.classList.remove('active');
                    navamsaBtn.classList.add('active');
                    lagnaBtn.classList.remove('active');
                }
            }
        }

        lagnaBtn.addEventListener('click', () => handleToggle('lagna'));
        navamsaBtn.addEventListener('click', () => handleToggle('navamsa'));

    </script>
    <script>

    </script>

    <script>
        const nakshatraPadas = [];
        const nakshatras = [
            "Ashvini", "Bharani", "Krittika", "Rohini", "Mrigashira", "Ardra",
            "Punarvasu", "Pushya", "Ashlesha", "Magha", "PurvaPhalguni", "UttaraPhalguni",
            "Hasta", "Chitra", "Svati", "Vishakha", "Anuradha", "Jyeshtha", "Mula",
            "PurvaShadha", "UttaraShadha", "Sravana", "Dhanista", "Shatabhisha",
            "PurvaBhadra", "UttaraBhadra", "Revati"
        ];

        const rashis = [
            "Aries", "Taurus", "Gemini", "Cancer", "Leo", "Virgo", "Libra", "Scorpio",
            "Sagittarius", "Capricorn", "Aquarius", "Pisces"
        ];

        const zodiacMap = {
            Aries: 1,
            Taurus: 2,
            Gemini: 3,
            Cancer: 4,
            Leo: 5,
            Virgo: 6,
            Libra: 7,
            Scorpio: 8,
            Sagittarius: 9,
            Capricorn: 10,
            Aquarius: 11,
            Pisces: 12,
        };
        const planets = ["Sun", "Moon", "Mars", "Mercury", "Jupiter", "Venus", "Saturn", "Rahu", "Ketu"];
        const ucchaNeechaData = {
            "Sun": { exalted: "Aries", debilitated: "Libra" },
            "Moon": { exalted: "Taurus", debilitated: "Scorpio" },
            "Mars": { exalted: "Capricorn", debilitated: "Cancer" },
            "Mercury": { exalted: "Virgo", debilitated: "Pisces" },
            "Jupiter": { exalted: "Cancer", debilitated: "Capricorn" },
            "Venus": { exalted: "Pisces", debilitated: "Virgo" },
            "Saturn": { exalted: "Libra", debilitated: "Aries" },
            "Rahu": { exalted: "Gemini", debilitated: "Sagittarius" },
            "Ketu": { exalted: "Sagittarius", debilitated: "Gemini" }
        };

        const planetaryRelations = {
            "Sun": { friends: ["Moon", "Mars", "Jupiter"], enemies: ["Venus", "Saturn"] },
            "Moon": { friends: ["Sun", "Mercury"], enemies: ["Rahu", "Ketu"] },
            "Mars": { friends: ["Sun", "Moon", "Jupiter"], enemies: ["Mercury"] },
            "Mercury": { friends: ["Sun", "Venus"], enemies: ["Moon", "Mars"] },
            "Jupiter": { friends: ["Sun", "Moon", "Mars"], enemies: ["Venus", "Mercury"] },
            "Venus": { friends: ["Mercury", "Saturn"], enemies: ["Sun", "Moon"] },
            "Saturn": { friends: ["Venus", "Mercury"], enemies: ["Sun", "Moon", "Mars"] },
            "Rahu": { friends: ["Venus", "Saturn", "Mercury"], enemies: ["Sun", "Moon", "Mars"] },
            "Ketu": { friends: ["Saturn"], enemies: ["Sun", "Moon"] }
        };

        const rashiLords = {
            "Aries": "Mars", "Taurus": "Venus", "Gemini": "Mercury", "Cancer": "Moon",
            "Leo": "Sun", "Virgo": "Mercury", "Libra": "Venus", "Scorpio": "Mars",
            "Sagittarius": "Jupiter", "Capricorn": "Saturn", "Aquarius": "Saturn", "Pisces": "Jupiter"
        };

        const nakshatraLords = {
            "Ashvini": "Ketu", "Bharani": "Venus", "Krittika": "Sun", "Rohini": "Moon",
            "Mrigashira": "Mars", "Ardra": "Rahu", "Punarvasu": "Jupiter", "Pushya": "Saturn",
            "Ashlesha": "Mercury", "Magha": "Ketu", "Purva Phalguni": "Venus", "UttaraPhalguni": "Sun",
            "Hasta": "Moon", "Chitra": "Mars", "Svati": "Rahu", "Vishakha": "Jupiter",
            "Anuradha": "Saturn", "Jyeshtha": "Mercury", "Mula": "Ketu", "PurvaShadha": "Venus",
            "UttaraShadha": "Sun", "Sravana": "Moon", "Dhanista": "Mars", "Shatabhisha": "Rahu",
            "PurvaBhadra": "Jupiter", "UttaraBhadra": "Saturn", "Revati": "Mercury"
        };

        const ucchaNeechaDegrees = {
            "Sun": { exalted: { nakshatra: "Bharani", pada: 2 }, debilitated: { nakshatra: "Svati", pada: 1 } },
            "Moon": { exalted: { nakshatra: "Krittika", pada: 1 }, debilitated: { nakshatra: "Anuradha", pada: 4 } },
            "Mars": { exalted: { nakshatra: "Dhanista", pada: 1 }, debilitated: { nakshatra: "Pushya", pada: 4 } },
            "Mercury": { exalted: { nakshatra: "UttaraPhalguni", pada: 4 }, debilitated: { nakshatra: "UttaraBhadra", pada: 2 } },
            "Jupiter": { exalted: { nakshatra: "Punarvasu", pada: 4 }, debilitated: { nakshatra: "Dhanista", pada: 2 } },
            "Venus": { exalted: { nakshatra: "UttaraBhadra", pada: 4 }, debilitated: { nakshatra: "UttaraPhalguni", pada: 2 } },
            "Saturn": { exalted: { nakshatra: "Svati", pada: 3 }, debilitated: { nakshatra: "Ashvini", pada: 4 } },
            "Rahu": { exalted: { nakshatra: "Rohini", pada: 2 }, debilitated: { nakshatra: "Jyeshtha", pada: 1 } },
            "Ketu": { exalted: { nakshatra: "Jyeshtha", pada: 4 }, debilitated: { nakshatra: "Rohini", pada: 3 } }
        };

        const planetaryRelations2 = {
            "Sun": { friends: ["Moon", "Mars", "Jupiter"], enemies: ["Venus", "Saturn"] },
            "Moon": { friends: ["Sun", "Mercury"], enemies: ["Rahu", "Ketu"] },
            "Mars": { friends: ["Sun", "Moon", "Jupiter"], enemies: ["Mercury"] },
            "Mercury": { friends: ["Sun", "Venus"], enemies: ["Moon", "Mars"] },
            "Jupiter": { friends: ["Sun", "Moon", "Mars"], enemies: ["Venus", "Mercury"] },
            "Venus": { friends: ["Mercury", "Saturn"], enemies: ["Sun", "Moon"] },
            "Saturn": { friends: ["Venus", "Mercury"], enemies: ["Sun", "Moon", "Mars"] },
            "Rahu": { friends: ["Venus", "Saturn", "Mercury"], enemies: ["Sun", "Moon"] },
            "Ketu": { friends: ["Mars", "Venus", "Saturn"], enemies: ["Sun", "Moon"] }
        };
    </script>
    <script>
        async function fetchUserData() {
            try {
                const response = await fetch(`${host}/api/detail/fetchalldetail`, {
                    method: "GET",
                    headers: {
                        "Content-Type": "application/json",
                        "auth-token": token
                    }
                });

                const response2 = await fetch(`${host}/api/admindetail/all`);
                const data = await response2.json();

                if (!Array.isArray(data) || data.length === 0 || !data[0].gochar || !Array.isArray(data[0].gochar)) {
                    throw new Error("Invalid data format: 'gochar' is missing or not an array.");
                }

                let filteredData = data[0].gochar;
                // console.log(gocharData, "gocharData")
                const normalizeDate = (date) => new Date(date.getFullYear(), date.getMonth(), date.getDate());
                const today = normalizeDate(new Date());

                let gocharData = filteredData.filter(entry => {
                    const entryDate = normalizeDate(new Date(entry.date_of_entry));
                    const exitDate = normalizeDate(new Date(entry.date_of_exit));
                    return today >= entryDate && today <= exitDate;
                });

                gocharData = gocharData.reduce((unique, entry) => {
                    const exitDate = normalizeDate(new Date(entry.date_of_exit));

                    if (exitDate.getTime() === today.getTime()) {
                        unique[entry.planet_name] = entry;
                    } else if (!unique[entry.planet_name]) {
                        unique[entry.planet_name] = entry;
                    }

                    return unique;
                }, {});

                // Convert back to an array
                gocharData = Object.values(gocharData);

                // console.log(filteredData, "Filtered gocharData");

                if (!response.ok) {
                    throw new Error("Failed to fetch data");
                }
                const datass = await response.json();

                // check users
                if (urlParams.size >= 1) {
                    const responseUser = await fetch(`${host}/api/auth/getuser`, {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                            "auth-token": token
                        }
                    });

                    if (!responseUser.ok == true) {
                        throw new Error("Failed to fetch data");
                    }

                    const dataUser = await responseUser.json();
                    // console.log(dataUser, "data")
                    if (dataUser.role === 'admin') {
                        // console.log("admin")
                        const responseUser2 = await fetch(`${host}/api/detail/fetchuserdetails/${userIds}`, {
                            method: "GET",
                            headers: {
                                "auth-token": token,
                                "Content-Type": "application/json",
                            },
                        });
                        if (!responseUser2.ok) {
                            throw new Error("Failed to fetch users");
                        }
                        const userDatasss = await responseUser2.json();
                        // console.log(userDatasss,"userDatasss")
                        // console.log(userIds,"userIds")
                        const datass = userDatasss;
                        // console.log(datass, "datass")
                        initializeData(datass, gocharData)
                    }
                }
                else {
                    initializeData(datass, gocharData)
                }
                // initializeData(datass, gocharData)

            } catch (error) {
                console.error("Error fetching data:", error);
            }
        }
        fetchUserData()


        nakshatras.forEach((nakshatra, index) => {
            for (let pada = 1; pada <= 4; pada++) {
                const rashiIndex = Math.floor((index * 4 + (pada - 1)) / 9) % 12;
                nakshatraPadas.push({ nakshatra, pada, rashi: rashis[rashiIndex] });
            }
        });

        function getStatus(planet, rashi) {
            const exaltedSign = ucchaNeechaData[planet]?.exalted;
            const debilitatedSign = ucchaNeechaData[planet]?.debilitated;

            if (rashi === exaltedSign) return "Uccha (Exalted)";
            if (rashi === debilitatedSign) return "Neecha (Debilitated)";

            const rashiLord = rashiLords[rashi];
            const friends = planetaryRelations[planet]?.friends || [];
            const enemies = planetaryRelations[planet]?.enemies || [];

            if (rashiLord === planet) return "Own";
            if (friends.includes(rashiLord)) return "Mitra (Friend)";
            if (enemies.includes(rashiLord)) return "Shatru (Enemy)";

            return "Neutral";
        }

        const position = []; // Store objects in an array
        function displayAllStatuses() {
            planets.forEach(planet => {
                // console.log(planet, "planets")
                rashis.forEach(rashi => {
                    const status = getStatus(planet, rashi);
                    // console.log(status, "status")
                    position.push({
                        planet: planet,
                        rashi: rashi,
                        status: status
                    });
                });
            });
        }
        displayAllStatuses();
        // console.log(position, "position");

        // Nakshatra status
        function getStatusNak(planet, nakshatra, pada) {
            const exalted = ucchaNeechaDegrees[planet].exalted;
            const debilitated = ucchaNeechaDegrees[planet].debilitated;

            if (nakshatra === exalted.nakshatra && pada === exalted.pada) return "Uccha (Exalted)";
            if (nakshatra === debilitated.nakshatra && pada === debilitated.pada) return "Neecha (Debilitated)";

            const nakshatraLord = nakshatraLords[nakshatra];
            const friends = planetaryRelations2[planet].friends;
            const enemies = planetaryRelations2[planet].enemies;

            if (friends.includes(nakshatraLord)) return "Mitra (Friend)";
            if (enemies.includes(nakshatraLord)) return "Shatru (Enemy)";

            return "Neutral";
        }
        const nakshatraPosition = [];
        function displayStatus() {
            planets.forEach(planet => {
                nakshatras.forEach(nakshatra => {
                    for (let pada = 1; pada <= 4; pada++) {
                        const status = getStatusNak(planet, nakshatra, pada);

                        nakshatraPosition.push({
                            planet: planet,
                            nakshatra: nakshatra,
                            pada: pada,
                            status: status
                        });
                    }
                });
            })
        }
        displayStatus();

        async function initializeData(datass, gocharData, selectedHouse = "1") {
            // console.log(datass, "inside datass")
            // console.log(gocharData,"gocharData")
            let GocharData = gocharData;
            let horoscopeData = datass[0]?.horoscopeData || [];
            let dashas = datass[0]?.dashas || [];
            let rashiData = datass[0]?.rashiData || [];
            console.log(rashiData,"rashiData")
            let chart1Url = datass[0]?.chart1Url || [];
            let chart2Url = datass[0]?.chart2Url || datass[0]?.chart9Url || [];
            let chart3Url = datass[0]?.chart3Url || []
            let chart3sUrl = datass[0]?.chart3sUrl || []
            let chart7Url = datass[0]?.chart7Url || []
            let chart10Url = datass[0]?.chart10Url || []
            let chart10rUrl = datass[0]?.chart10rUrl || []
            let chart12Url = datass[0]?.chart12Url || []
            let chart16Url = datass[0]?.chart16Url || []
            let chart20Url = datass[0]?.chart20Url || []
            let chart24Url = datass[0]?.chart24Url || []
            let chart24rUrl = datass[0]?.chart24rUrl || []
            let chart30Url = datass[0]?.chart30Url || []
            let chart40Url = datass[0]?.chart40Url || []
            let chart45Url = datass[0]?.chart45Url || []
            let chart60Url = datass[0]?.chart60Url || []
            let mahaDashaData = datass[0]?.mahaDashaData || [];
            let antarDashaData = datass[0]?.antarDashaData || [];
            let charDashaData = datass[0]?.charDashaData || [];
            let charsubDashaData = datass[0]?.charsubDashaData || [];
            let yoginiDashaData = datass[0]?.yoginiDashaData || [];
            let yoginisubDashaData = datass[0]?.yoginisubDashaData || [];
            let paryantarDashaData = datass[0]?.paryantarDashaData || [];

            // Function to populate the table
            const populateHouseTable = (selectedHouse = "1") => {
                // const resultTable = document.getElementById("resultbody").querySelector("tbody");
                // resultTable.innerHTML = "";

                // Get horoscopeData from localStorage

                let planets = [];

                if (horoscopeData && horoscopeData.response) {
                    const planetDatas = horoscopeData.response;

                    const createHouses = (startZodiacNumber) => {
                        const houses = [];
                        let currentNumber = startZodiacNumber;
                        for (let i = 0; i < 12; i++) {
                            houses.push(currentNumber);
                            currentNumber = currentNumber === 12 ? 1 : currentNumber + 1;
                        }
                        return houses;
                    };

                    // Map Planet Data
                    const mapHPlanetData = (data) => {
                        if (Array.isArray(data)) {
                            return data.map((planet) => ({
                                name: planet.full_name,
                                nakshatra: planet.nakshatra,
                                pada: planet.nakshatra_pada,
                                retro: planet.retro,
                                is_combust: planet.is_combust,
                                zodiac: planet.zodiac,
                                zodiacNumber: zodiacMap[planet.zodiac] || "-",
                                houses: createHouses(zodiacMap[planet.zodiac] || 1),
                            }));
                        } else if (typeof data === "object" && data !== null) {
                            return Object.values(data).map((planet) => ({
                                name: planet.full_name,
                                nakshatra: planet.nakshatra,
                                pada: planet.nakshatra_pada,
                                retro: planet.retro,
                                is_combust: planet.is_combust,
                                zodiac: planet.zodiac,
                                zodiacNumber: zodiacMap[planet.zodiac] || "-",
                                houses: createHouses(zodiacMap[planet.zodiac] || 1),
                            }));
                        } else {
                            console.error("Unexpected data format for planets:", data);
                            return [];
                        }
                    };

                    planets = mapHPlanetData(planetDatas).slice(0, 10);
                }

                const defaultNakshatra = planets[0]?.nakshatra || "Ashvini";
                const defaultPada = planets[0]?.pada || 1;

                let currentIndex = nakshatraPadas.findIndex(
                    (n) => n.nakshatra === defaultNakshatra && n.pada === defaultPada
                );

                let currentIndex2 = nakshatraPadas.findIndex(
                    (n) => n.nakshatra === defaultNakshatra && n.pada === defaultPada
                );


                let storedPadas = [];
                let comparisonData = []; // Store comparison data for use in resultTable


                for (let house = 1; house <= 12; house++) {
                    currentIndex2 = (currentIndex2 + 9) % nakshatraPadas.length;

                    for (let i = 0; i < 10; i++) {
                        const padaIndex = (currentIndex2 + i) % nakshatraPadas.length;
                        const pada = nakshatraPadas[padaIndex];
                        storedPadas.push(nakshatraPadas[padaIndex]);
                    }
                }
                for (let house = 1; house <= 12; house++) {
                    if (selectedHouse !== "all" && house !== parseInt(selectedHouse, 10)) {
                        currentIndex = (currentIndex + 9) % nakshatraPadas.length;
                        continue;
                    }

                    const ascendant = planets[0];
                    const ascendantHouseValue = ascendant.houses[selectedHouse - 1];
                    // console.log(ascendant)


                    planets.forEach((planet) => {
                        // console.log(planet,"planet")
                        let oneHundredPercent = "-";
                        let seventyFivePercent = "-";
                        let fiftyPercent = "-";
                        let twentyFivePercent = "-";

                        if (selectedHouse === "5" || selectedHouse === "9") {
                            let matchingPlanets = ["Jupiter", "Rahu", "Ketu"].filter(name => name === planet.name);
                            if (matchingPlanets.length > 0) {
                                oneHundredPercent = matchingPlanets.join(", ");
                            }
                        }
                        if (selectedHouse === "4" || selectedHouse === "8") {
                            let matchingPlanets = ["Mars"].filter(name => name === planet.name);
                            if (matchingPlanets.length > 0) {
                                oneHundredPercent = matchingPlanets.join(", ");
                            }
                        }
                        if (selectedHouse === "3" || selectedHouse === "10") {
                            let matchingPlanets = ["Saturn"].filter(name => name === planet.name);
                            if (matchingPlanets.length > 0) {
                                oneHundredPercent = matchingPlanets.join(", ");
                            }
                        }
                        if (planet.houses[0] === ascendantHouseValue || planet.houses[6] === ascendantHouseValue) {
                            oneHundredPercent = planet.name;
                        }
                        if (planet.houses[3] === ascendantHouseValue || planet.houses[7] === ascendantHouseValue) {
                            seventyFivePercent = planet.name;
                        }
                        if (planet.houses[4] === ascendantHouseValue || planet.houses[8] === ascendantHouseValue) {
                            fiftyPercent = planet.name;
                        }
                        if (planet.houses[2] === ascendantHouseValue || planet.houses[9] === ascendantHouseValue) {
                            twentyFivePercent = planet.name;
                        }

                        // Save comparison data
                        comparisonData.push({
                            name: planet.name,
                            oneHundredPercent,
                            seventyFivePercent,
                            fiftyPercent,
                            twentyFivePercent,
                        });
                    });


                    for (let i = 0; i < 9; i++) {
                        const padaIndex = (currentIndex + i) % nakshatraPadas.length;
                        const pada = nakshatraPadas[padaIndex];
                        // console.log(pada, "pada")
                        // console.log(currentIndex,"currentIndex")

                        // Find all matching planets
                        const matchingPlanets = planets.filter(
                            (planet) => planet.nakshatra === pada.nakshatra && planet.pada === pada.pada
                        );


                        let planetNames = matchingPlanets.length > 0 ? matchingPlanets.map((planet) => planet.name).join(", ") : "-";
                        let dashakeys = [];

                        matchingPlanets.forEach((planet) => {
                            Object.entries(dashas).forEach(([key, value]) => {
                                if (value.name === planet.name) {
                                    dashakeys.push(key, value);
                                }
                            });
                        });

                        const dashaText = dashakeys.length > 0 ? `(${dashakeys.join(", ")})` : "";
                        // console.log(dashakeys,"dashaText")

                        // Find planets with percentage matches
                        let oneHundredPercentNames = comparisonData
                            .filter((data) => data.oneHundredPercent !== "-")
                            .map((data) => data.oneHundredPercent);
                        let seventyFivePercentNames = comparisonData
                            .filter((data) => data.seventyFivePercent !== "-")
                            .map((data) => data.seventyFivePercent);
                        let fiftyPercentNames = comparisonData
                            .filter((data) => data.fiftyPercent !== "-")
                            .map((data) => data.fiftyPercent);
                        let twentyFivePercentNames = comparisonData
                            .filter((data) => data.twentyFivePercent !== "-")
                            .map((data) => data.twentyFivePercent);

                        const retroPlanets = matchingPlanets.filter((planet) => planet.retro).map(() => "R").join(", ");
                        const combustPlanets = matchingPlanets.filter((planet) => planet.is_combust).map(() => "C").join(", ");
                        comparisonData.push({
                            pada: pada,
                        });
                    }

                    // console.log(comparisonData,"comparisonData")

                    // let planetTable = document.getElementById("planetTable");
                    // let matchedTable = document.getElementById("matchedTable");
                    let selectedDivisional = document.getElementById("divisionalSelect").value;
                    let selectedRasNak = document.getElementById("rashiNakSelect").value;

                    updateTable(comparisonData, storedPadas, position, nakshatraPosition);
                    function updateTable(comparisonData, padas, position, nakshatraPosition) {
                        let divisionalData = rashiData[selectedDivisional];
                        console.log(selectedDivisional)


                        // Clear existing content
                        const chartContainer3 = document.getElementById("horoscope-chart3");

                        const lagnaNavamsaDiv = document.querySelector(".kundali-img-nres:not(.others)");
                        const othersDiv = document.querySelector(".kundali-img-nres.others");
                        const kundaliButtons = document.querySelector(".kundali-buttons");

                        chartContainer1.innerHTML = "";
                        chartContainer2.innerHTML = "";
                        chartContainer3.innerHTML = "";

                        if (selectedDivisional === "D1") {
                            // Show Lagna/Navamsa
                            lagnaNavamsaDiv.style.display = "flex";
                            othersDiv.style.display = "none";// Or "block" based on your layout

                            chartContainer1.innerHTML = chart1Url;
                            chartContainer2.innerHTML = chart2Url;
                        } else {
                            // Show other charts
                            lagnaNavamsaDiv.style.display = "none";
                            othersDiv.style.display = "block";
                            kundaliButtons.style.display = "none";

                            switch (selectedDivisional) {
                                case "D3":
                                    chartContainer3.innerHTML = chart3Url;
                                    break;
                                case "D3-s":
                                    chartContainer3.innerHTML = chart3sUrl;
                                    break;
                                case "D7":
                                    chartContainer3.innerHTML = chart7Url;
                                    break;
                                case "D9":
                                    chartContainer3.innerHTML = chart2Url;
                                    break;
                                case "D10":
                                    chartContainer3.innerHTML = chart10Url;
                                    break;
                                case "D10-R":
                                    chartContainer3.innerHTML = chart10rUrl;
                                    break;
                                case "D12":
                                    chartContainer3.innerHTML = chart12Url;
                                    break;
                                case "D16":
                                    chartContainer3.innerHTML = chart16Url;
                                    break;
                                case "D20":
                                    chartContainer3.innerHTML = chart20Url;
                                    break;
                                case "D24":
                                    chartContainer3.innerHTML = chart24Url;
                                    break;
                                case "D24-R":
                                    chartContainer3.innerHTML = chart24rUrl;
                                    break;
                                case "D30":
                                    chartContainer3.innerHTML = chart30Url;
                                    break;
                                case "D40":
                                    chartContainer3.innerHTML = chart40Url;
                                    break;
                                case "D45":
                                    chartContainer3.innerHTML = chart45Url;
                                    break;
                                case "D60":
                                    chartContainer3.innerHTML = chart60Url;
                                    break;
                                default:
                                    chartContainer3.innerHTML = "No chart available";
                            }
                        }
                        // console.log(rashiData, "rashiData")
                        // console.log(position, "position")
                        // console.log(nakshatraPosition, "nakshatraPosition")
                        // console.log(selectedRasNak, "selectedRasNak")
                        // console.log(comparisonData, "comparisonData")

                        // planetTable.innerHTML = ``;

                        let allMatchingPlanets = [];

                        if (padas && Array.isArray(padas)) {
                            padas.forEach((pada) => {
                                let matchingPlanets = planets.filter(
                                    (planet) => planet.nakshatra === pada.nakshatra && planet.pada === pada.pada
                                );

                                if (matchingPlanets.length > 0) {
                                    allMatchingPlanets.push(...matchingPlanets);
                                }
                            });
                        }

                        // Sorting function
                        comparisonData.sort((a, b) => {
                            let getValue = (data) => {
                                if (data.oneHundredPercent && data.oneHundredPercent !== "-") return 100;
                                if (data.seventyFivePercent && data.seventyFivePercent !== "-") return 75;
                                if (data.fiftyPercent && data.fiftyPercent !== "-") return 50;
                                if (data.twentyFivePercent && data.twentyFivePercent !== "-") return 25;
                                return 0;
                            };

                            // Sort by Nakshatra first (alphabetically)
                            let nakshatraA = a.nakshatra || "";
                            let nakshatraB = b.nakshatra || "";
                            let nakshatraDiff = nakshatraA.localeCompare(nakshatraB);
                            if (nakshatraDiff !== 0) return nakshatraDiff;

                            // Sort by Pada (ascending order)
                            let padaA = a.pada ? parseInt(a.pada) : 0;
                            let padaB = b.pada ? parseInt(b.pada) : 0;
                            if (padaA !== padaB) return padaA - padaB;

                            // Sort by percentage (descending order)
                            return getValue(b) - getValue(a);
                        });

                        let firstTableData = [];
                        let secondTableData = [];

                        comparisonData.forEach((data) => {
                            // console.log(data, "data");
                            let planetName = data.planetName && data.planetName !== "-" ? data.planetName : null;

                            let hundred = data.oneHundredPercent && data.oneHundredPercent !== "-" ? data.oneHundredPercent : "";
                            let seventyFive = data.seventyFivePercent && data.seventyFivePercent !== "-" ? data.seventyFivePercent : "";
                            let fifty = data.fiftyPercent && data.fiftyPercent !== "-" ? data.fiftyPercent : "";
                            let twentyFive = data.twentyFivePercent && data.twentyFivePercent !== "-" ? data.twentyFivePercent : "";

                            let percentageText = "";
                            if (!planetName) {
                                if (hundred) {
                                    planetName = hundred;
                                    percentageText = " ";
                                } else if (seventyFive) {
                                    planetName = seventyFive;
                                    percentageText = " 75%";
                                } else if (fifty) {
                                    planetName = fifty;
                                    percentageText = " 50%";
                                } else if (twentyFive) {
                                    planetName = twentyFive;
                                    percentageText = " 25%";
                                } else {
                                    planetName = null;
                                }
                            } else {
                                if (hundred === planetName) {
                                    percentageText = " ";
                                } else if (seventyFive === planetName) {
                                    percentageText = " 75%";
                                } else if (fifty === planetName) {
                                    percentageText = " 50%";
                                } else if (twentyFive === planetName) {
                                    percentageText = " 25%";
                                }
                            }

                            if (planetName) {
                                if (planetName === "Ascendant" && selectedHouse !== "1") {
                                    return;
                                }

                                const matchedPlanet = allMatchingPlanets.find((p) => p.name === planetName);
                                const retro = matchedPlanet?.retro;
                                const combust = matchedPlanet?.is_combust;

                                let retroPlanet = retro ? '&#8634;' : "";
                                let combustPlanet = combust ? '&#128293;' : "";

                                let matchedNakshatra = matchedPlanet?.nakshatra || "";
                                let matchedPada = matchedPlanet?.pada || "";

                                let matchedD = [];
                                if (divisionalData) {
                                    matchedD = divisionalData.find((i) => i.name === planetName);
                                }
                                let matchedRashis = matchedD?.zodiac || "";
                                console.log(matchedRashis,"matchedRashis")

                                let positionValue = [];
                                let status = [];

                                if (selectedRasNak === "Rashi") {
                                    positionValue = position.find((i) => i.planet === planetName && i.rashi === matchedRashis);

                                    if (positionValue?.status === "Uccha (Exalted)") {
                                        status = 'color-pos-bx1';
                                    } else if (positionValue?.status === "Own") {
                                        status = 'color-pos-bx2';
                                    } else if (positionValue?.status === "Mitra (Friend)") {
                                        status = 'color-pos-bx3';
                                    } else if (positionValue?.status === "Neutral") {
                                        status = 'color-pos-bx4';
                                    } else if (positionValue?.status === "Shatru (Enemy)") {
                                        status = 'color-pos-bx5';
                                    } else if (positionValue?.status === "Neecha (Debilitated)") {
                                        status = 'color-pos-bx6';
                                    }
                                } else {
                                    positionValue = nakshatraPosition.find((i) => i.planet === planetName && i.nakshatra === matchedNakshatra && i.pada === matchedPada);

                                    if (positionValue?.status === "Uccha (Exalted)") {
                                        status = 'color-pos-bx1';
                                    } else if (positionValue?.status === "Mitra (Friend)") {
                                        status = 'color-pos-bx3';
                                    } else if (positionValue?.status === "Neutral") {
                                        status = 'color-pos-bx4';
                                    } else if (positionValue?.status === "Shatru (Enemy)") {
                                        status = 'color-pos-bx5';
                                    } else if (positionValue?.status === "Neecha (Debilitated)") {
                                        status = 'color-pos-bx6';
                                    }
                                }

                                // console.log(positionValue,"positionValue")

                                let dashakeys = [];
                                Object.entries(dashas).forEach(([key, value]) => {
                                    if (value.name === planetName) {
                                        dashakeys.push({ key, value });
                                    }
                                });

                                // let dashaText = dashakeys.length > 0 ? `(${dashakeys.join(", ")})` : "-";

                                const dashaLabels = {
                                    major: "Mahadasha (MD)",
                                    minor: "Antardasha (AD)",
                                    sub_minor: "Pratyantar Dasha (PD)",
                                    sub_sub_minor: "Sookshma Dasha (SD)"
                                };

                                let dashaForms = dashakeys.map(({ key }) => dashaLabels[key] || key);

                                // Extract actual dasha values (ensuring valid data)
                                let dashaValues = dashakeys.map(({ value }) => value ? value : null).filter(Boolean);

                                // Format outputs
                                let dashaForm = dashaForms.length > 0 ? dashaForms.join(", ") : "-";
                                let dashavalueForm = dashaValues.length > 0 ? dashaValues : "-";

                                let dashaStart = dashaValues.length > 0 ? new Date(dashaValues[0].start).toISOString().split("T")[0] : "-";
                                let dashaEnd = dashaValues.length > 0 ? new Date(dashaValues[0].end).toISOString().split("T")[0] : "-";

                                // console.log(dashaStart, "dashaStart");
                                // console.log(dashaEnd, "dashaEnd");


                                // Store in an array
                                firstTableData.push({
                                    nakshatra: matchedNakshatra,
                                    pada: matchedPada,
                                    rashi: matchedRashis,
                                    planet: planetName,
                                    positionValue: positionValue,
                                    status: status,
                                    percentageText: percentageText,
                                    retroPlanet: retroPlanet,
                                    combustPlanet: combustPlanet,
                                    dashaForm: dashaForm,
                                    dashaStart: dashaStart,
                                    dashaEnd: dashaEnd
                                });

                                // Append planet data row
                                //                             const row = `
                                //     <tr>
                                //         <td class="td-span">
                                //             <span>${matchedNakshatra}(${matchedPada})</span>
                                //         </td>
                                //         <td class="td-span">
                                //             <span>${matchedRashis}</span>
                                //         </td>
                                //         <td class="td-span">
                                //             <span>${planetName} ${percentageText} ${retroPlanet} ${combustPlanet}</span>
                                //         </td>
                                //         <td class="td-span">
                                //             <div class="color-bx ${status}" data-tooltip="${positionValue?.status ? positionValue.status : ''}"></div>
                                //         </td>
                                //         <td class="td-span">
                                //             <span>${dashaForm}</span>
                                //         </td>
                                //     </tr>
                                // `;

                                //                             planetTable.innerHTML += row;
                            }
                        });

                        // ADD PADA DETAILS EVEN IF NO PLANETS MATCH
                        comparisonData.forEach((data) => {
                            // console.log(data, "data");

                            let planetName = data.planetName && data.planetName !== "-" ? data.planetName : null;

                            let matchedPadas = data.pada?.pada || "";
                            let matchedNakshatras = data.pada?.nakshatra || "";
                            let matchedRashi = data.pada?.rashi || "";
                            if (matchedPadas) {
                                secondTableData.push({
                                    nakshatra: matchedNakshatras,
                                    pada: matchedPadas,
                                    rashi: matchedRashi
                                });
                                //                                 const row = `
                                // <tr>
                                // <td class="td-span"><span>${matchedNakshatras}(${matchedPadas})</span></td>
                                // <td class="td-span"><span>${matchedRashi}</span></td>
                                // <td class="td-span"><span>${planetName || "-"}</span></td>
                                // <td class="td-span"><span>-</span></td>
                                // <td class="td-span"><span>-</span></td>
                                // </tr>
                                // `;

                                //                                 planetTable.innerHTML += row;
                            }

                        });
                        // Compare and generate the third table
                        let thirdTableContent = "";
                        let fourthTableContent = "";
                        let fifthTableContent = "";
                        let matchedNakshatras = new Set();
                        let matchedPlanets = new Set(); // Track planets added to the third table

                        secondTableData.forEach((entry2) => {
                            let matches = firstTableData.filter(entry1 => entry1.nakshatra === entry2.nakshatra);
                            let matchPlanetsList = matches.filter((i) => i.pada === entry2.pada);
                            // console.log(matches, "matches")
                            // console.log(matchPlanetsList,"matchPlanetsList")

                            // Extract and join all matching planet-related values
                            let planetsText = matchPlanetsList.map(mp => mp.planet).join(", ");
                            let percentageText = matchPlanetsList.map(mp => mp.percentageText).join(", ");
                            let retroPlanets = matchPlanetsList.map(mp => mp.retroPlanet).join(", ");
                            let combustPlanets = matchPlanetsList.map(mp => mp.combustPlanet).join(", ");
                            let statusClass = matchPlanetsList.length > 0 ? matchPlanetsList[0].status : "-";
                            let positionStatus = matchPlanetsList.length > 0 ? matchPlanetsList[0].positionValue : "-";
                            let dashaform2 = matchPlanetsList.length > 0 ? matchPlanetsList[0].dashaForm : "-"
                            let dashaformStart = matchPlanetsList.length > 0 ? matchPlanetsList[0].dashaStart : "-"
                            let dashaformEnd = matchPlanetsList.length > 0 ? matchPlanetsList[0].dashaEnd : "-"

                            if (!planetsText) {
                                const planetText2 = planets.find(j => j.nakshatra === entry2.nakshatra && j.pada === entry2.pada);
                                planetsText = planetText2 ? planetText2.name : "";
                                retroPlanets = planetText2?.retro === true ? '&#8634;' : "";
                                combustPlanets = planetText2?.is_combust === true ? '&#128293;' : "";

                                let matchedD = [];
                                if (divisionalData) {
                                    matchedD = divisionalData.find((i) => i.name === planetText2?.name);
                                }
                                // console.log(matchedD,"matchedD")
                                let matchedRashis = matchedD?.zodiac || "";
                                // console.log(matchedRashis,"matchedRashis")

                                let positionValue = [];
                                let status = [];

                                if (selectedRasNak === "Rashi") {
                                    positionValue = position.find((i) => i.planet === planetText2?.name && i.rashi === matchedRashis);
                                    if (positionValue?.status === "Uccha (Exalted)") {
                                        status = 'color-pos-bx1';
                                    } else if (positionValue?.status === "Own") {
                                        status = 'color-pos-bx2';
                                    } else if (positionValue?.status === "Mitra (Friend)") {
                                        status = 'color-pos-bx3';
                                    } else if (positionValue?.status === "Neutral") {
                                        status = 'color-pos-bx4';
                                    } else if (positionValue?.status === "Shatru (Enemy)") {
                                        status = 'color-pos-bx5';
                                    } else if (positionValue?.status === "Neecha (Debilitated)") {
                                        status = 'color-pos-bx6';
                                    }
                                } else {
                                    positionValue = nakshatraPosition.find((i) => i.planet === planetText2?.name && i.nakshatra === planetText2?.nakshatra && i.pada === planetText2?.pada);

                                    if (positionValue?.status === "Uccha (Exalted)") {
                                        status = 'color-pos-bx1';
                                    } else if (positionValue?.status === "Mitra (Friend)") {
                                        status = 'color-pos-bx3';
                                    } else if (positionValue?.status === "Neutral") {
                                        status = 'color-pos-bx4';
                                    } else if (positionValue?.status === "Shatru (Enemy)") {
                                        status = 'color-pos-bx5';
                                    } else if (positionValue?.status === "Neecha (Debilitated)") {
                                        status = 'color-pos-bx6';
                                    }
                                }
                                statusClass = status;
                                positionStatus = positionValue;
                                // console.log(status,"status")

                                let dashakeys = [];
                                Object.entries(dashas).forEach(([key, value]) => {
                                    if (value.name === planetText2?.name) {
                                        dashakeys.push({ key, value });
                                    }
                                });

                                // let dashaText = dashakeys.length > 0 ? `(${dashakeys.join(", ")})` : "-";

                                const dashaLabels = {
                                    major: "Mahadasha (MD)",
                                    minor: "Antardasha (AD)",
                                    sub_minor: "Pratyantar Dasha (PD)",
                                    sub_sub_minor: "Sookshma Dasha (SD)"
                                };

                                let dashaForms = dashakeys.map(({ key }) => dashaLabels[key] || key);

                                // Extract actual dasha values (ensuring valid data)
                                let dashaValues = dashakeys.map(({ value }) => value ? value : null).filter(Boolean);

                                // Format outputs
                                let dashaForm = dashaForms.length > 0 ? dashaForms.join(", ") : "-";
                                let dashavalueForm = dashaValues.length > 0 ? dashaValues : "-";

                                let dashaStart = dashaValues.length > 0 ? new Date(dashaValues[0].start).toISOString().split("T")[0] : "-";
                                let dashaEnd = dashaValues.length > 0 ? new Date(dashaValues[0].end).toISOString().split("T")[0] : "-";

                                dashaform2 = dashaForm
                                dashaformStart = dashaStart
                                dashaformEnd = dashaEnd

                            }
                            // Add all matched planets to the set
                            matchPlanetsList.forEach(mp => matchedPlanets.add(mp.planet));
                            if (planetsText.includes("Ascendant")) {
                                percentageText = " "
                                retroPlanets = " "
                                combustPlanets = " "
                            }
                            thirdTableContent += `
        <tr>
            <td class="td-span"><span>${entry2.nakshatra}(${entry2.pada})</span></td>
            <td class="td-span"><span>${entry2.rashi}</span></td>
            <td class="td-span"><span>${planetsText || "-"} ${percentageText ? percentageText : " "} ${retroPlanets ? retroPlanets : " "} ${combustPlanets ? combustPlanets : " "} </span></td>
            <td class="td-span">
                <div class="color-bx ${statusClass}" data-tooltip="${positionStatus?.status}"></div>
            </td>
            <td class="td-span">
                <span>${dashaform2 !== "-" && dashaform2 ?
                                    `${dashaform2} <i class="color-bx color-pos-bx4 fa-regular fa-eye mx-2" data-tooltip="${dashaformStart} - ${dashaformEnd}"></i>`
                                    : "-"}</span>
            </td>
        </tr>`;
                        });

                        // Find Nakshatras in Table 1 that are not in Table 2 and exclude matched planets
                        firstTableData.forEach(entry1 => {
                            console.log(entry1,"entry1")
                            // console.log(entry1.dashavalueForm.find((i) => i.end),"end")
                            if (!matchedNakshatras.has(entry1.nakshatra) && !matchedPlanets.has(entry1.planet)) {
                                fourthTableContent += `
                                <tr>
                                    <td class="td-span"><span>${entry1.nakshatra}(${entry1.pada})</span></td>
                                    <td class="td-span"><span>${entry1.rashi}</span></td>
                                    <td class="td-span"><span>${entry1.planet || "-"} ${entry1?.percentageText || " "} ${entry1?.retroPlanet || " "} ${entry1?.combustPlanet || " "} </span></td>
                                    <td class="td-span">
                                        <div class="color-bx ${entry1?.status || "-"}" data-tooltip="${entry1?.positionValue?.status ? entry1?.positionValue.status : '-'}"></div>
                                    </td>
                                    <td class="td-span">
                                        <span data-tooltip="tooltips">
                                            ${entry1.dashaForm && entry1.dashaForm !== "-" ?
                                        `${entry1.dashaForm} <i class="color-bx color-pos-bx4 fa-regular fa-eye mx-2" class="fa-regular fa-eye mx-2" data-tooltip="${entry1.dashaStart} - ${entry1.dashaEnd}"></i>`
                                        : "-"} </span>
                                    </td>
                                </tr>`;
                            }
                        });
                        // Find Nakshatras in Table 1 that are not in Table 2 and exclude matched planets
                        secondTableData.forEach(entry1 => {

                            // console.log(entry1, "entry1")

                            // console.log(GocharData,"gocharData")
                            let matchGocharPlanet = GocharData.find((i) => i.nakshatra === entry1.nakshatra && i.pada === entry1.pada)
                            // console.log(matchGocharPlanet, "matchGocharPlanet")

                            if (matchGocharPlanet) {
                                let positionValue = [];
                                let status = [];

                                if (selectedRasNak === "Rashi") {
                                    positionValue = position.find((i) => i.planet === matchGocharPlanet.planet_name && i.rashi === matchGocharPlanet.rashi);

                                    if (positionValue?.status === "Uccha (Exalted)") {
                                        status = 'color-pos-bx1';
                                    } else if (positionValue?.status === "Own") {
                                        status = 'color-pos-bx2';
                                    } else if (positionValue?.status === "Mitra (Friend)") {
                                        status = 'color-pos-bx3';
                                    } else if (positionValue?.status === "Neutral") {
                                        status = 'color-pos-bx4';
                                    } else if (positionValue?.status === "Shatru (Enemy)") {
                                        status = 'color-pos-bx5';
                                    } else if (positionValue?.status === "Neecha (Debilitated)") {
                                        status = 'color-pos-bx6';
                                    }
                                } else {
                                    positionValue = nakshatraPosition.find((i) => i.planet === matchGocharPlanet.planet_name && i.nakshatra === matchGocharPlanet.nakshatra && i.pada === matchGocharPlanet.pada);

                                    if (positionValue?.status === "Uccha (Exalted)") {
                                        status = 'color-pos-bx1';
                                    } else if (positionValue?.status === "Mitra (Friend)") {
                                        status = 'color-pos-bx3';
                                    } else if (positionValue?.status === "Neutral") {
                                        status = 'color-pos-bx4';
                                    } else if (positionValue?.status === "Shatru (Enemy)") {
                                        status = 'color-pos-bx5';
                                    } else if (positionValue?.status === "Neecha (Debilitated)") {
                                        status = 'color-pos-bx6';
                                    }
                                }
                                fifthTableContent += `
                                <tr>
                                    <td class="td-span"><span>${entry1.nakshatra}(${entry1.pada})</span></td>
                                    <td class="td-span"><span>${entry1.rashi}</span></td>
                                    <td class="td-span"><span>${matchGocharPlanet.planet_name || "-"}  ${matchGocharPlanet?.motion === "retrograde" ? "&#8634;" : " "} ${matchGocharPlanet?.combust === "true" ? "&#128293" : " "} </span></td>
                                    <td class="td-span">
                                        <div class="color-bx ${status || "-"}" data-tooltip="${positionValue?.status ? positionValue.status : '-'}"></div>
                                    </td>
                                    <td class="td-span">
                                        <span>${entry1?.dashaForm || "-"}</span>
                                    </td>
                                    <td class="td-span">
                                       <span>
                                         ${matchGocharPlanet?.nakshatra
                                        ? `${matchGocharPlanet.nakshatra} (${matchGocharPlanet.pada || ""}) <i class="color-bx color-pos-bx4 fa-regular fa-eye mx-2" class="fa-regular fa-eye mx-2" data-tooltip="${matchGocharPlanet.date_of_entry} - ${matchGocharPlanet.date_of_exit}"></i>`
                                        : "-"}</span>
                                    </td>
                                </tr>`;
                            }
                        });

                        // Append the matched and unmatched data to respective tables
                        document.getElementById("thirdTable").innerHTML = thirdTableContent;
                        document.getElementById("fourthTable").innerHTML = fourthTableContent;
                        document.getElementById("fifthTable").innerHTML = fifthTableContent;
                    }

                    // Event listener for divisional chart selection
                    document.getElementById("rashiNakSelect").addEventListener("change", (event) => {
                        selectedRasNak = event.target.value;

                        // Disable divisional chart selection if Nakshatra is selected
                        const divisionalSelect = document.getElementById("divisionalSelect");
                        if (selectedRasNak === "Nakshatra") {
                            divisionalSelect.disabled = true;
                        } else {
                            divisionalSelect.disabled = false;
                        }

                        updateTable(comparisonData, storedPadas, position, nakshatraPosition);
                    });

                    // Event listener for divisional chart selection
                    document.getElementById("divisionalSelect").addEventListener("change", (event) => {
                        selectedDivisional = event.target.value;
                        updateTable(comparisonData, storedPadas, position, nakshatraPosition);
                    });

                    currentIndex = (currentIndex + 9) % nakshatraPadas.length;
                }
            };

            // Event listener for house selection
            document.getElementById("houseDropdown").addEventListener("change", (event) => {
                const selectedHouse = event.target.value;
                populateHouseTable(selectedHouse);
            });

            const chartContainer1 = document.getElementById("horoscope-chart1");
            chartContainer1.innerHTML = chart1Url;
            const chartContainer2 = document.getElementById("horoscope-chart2");
            chartContainer2.innerHTML = chart2Url;


            if (horoscopeData && horoscopeData.response) {
                const planetDatas = horoscopeData.response;
                // Function to check if a value is defined
                const isDefined = (value) => value !== undefined && value !== null && value !== "";

                // Map Planet Data
                const mapPlanetData = (data) => {
                    if (Array.isArray(data)) {
                        // If data is an array, map directly
                        return data.map((planet) => ({
                            name: planet.full_name,
                            zodiac: planet.zodiac,
                            house: planet.house,
                            nakshatra: planet.nakshatra,
                            nakshatra_lord: planet.nakshatra_lord,
                            zodiac_lord: planet.zodiac_lord,
                            latitude: planet.local_degree,
                            rishi: planet.nakshatra_lord,
                            nakshatra_pada: planet.nakshatra_pada,
                            relation: planet.zodiac_lord,
                            retro: planet.retro,
                            is_combust: planet.is_combust,
                        }));
                    } else if (typeof data === "object" && data !== null) {
                        // If data is an object, map its values
                        return Object.values(data).map((planet) => ({
                            name: planet.full_name,
                            zodiac: planet.zodiac,
                            house: planet.house,
                            nakshatra: planet.nakshatra,
                            nakshatra_lord: planet.nakshatra_lord,
                            zodiac_lord: planet.zodiac_lord,
                            latitude: planet.local_degree,
                            rishi: planet.nakshatra_lord,
                            nakshatra_pada: planet.nakshatra_pada,
                            relation: planet.zodiac_lord,
                            retro: planet.retro,
                            is_combust: planet.is_combust,
                        }));
                    } else {
                        console.error("Unexpected data format for planets:", data);
                        return [];
                    }
                };

                // Map Dasa Details
                const mapDasaDetails = (data) => {
                    return {
                        birth_dasa: planetDatas.birth_dasa,
                        current_dasa: planetDatas.current_dasa,
                        lucky_gem: planetDatas.lucky_gem,
                        lucky_num: planetDatas.lucky_num,
                        lucky_colors: planetDatas.lucky_colors,
                        lucky_name_start: planetDatas.lucky_name_start,
                        lucky_letters: planetDatas.lucky_letters,
                        rasi: planetDatas.rasi,
                    };
                };

                // Map Panchang Details
                const mapPanchangDetails = (data) => {
                    return {
                        ayanamsa: planetDatas.panchang.ayanamsa,
                        ayanamsa_name: planetDatas.panchang.ayanamsa_name,
                        karana: planetDatas.panchang.karana,
                        yoga: planetDatas.panchang.yoga,
                        day_of_birth: planetDatas.panchang.day_of_birth,
                        day_lord: planetDatas.panchang.day_lord,
                        hora_lord: planetDatas.panchang.hora_lord,
                        sunrise_at_birth: planetDatas.panchang.sunrise_at_birth,
                        sunset_at_birth: planetDatas.panchang.sunset_at_birth,
                        tithi: planetDatas.panchang.tithi,
                    };
                };

                // Populate Table
                const populateTable = async () => {
                    const planetDataElement = document.getElementById("planet-data");
                    const dasaDataElement = document.getElementById("dasa-data");
                    const panchangDataElement = document.getElementById("panchang-data");

                    if (!horoscopeData || !horoscopeData.response) {
                        console.error("Horoscope data is invalid or missing.");
                        return;
                    }

                    // Map Data
                    const planets = mapPlanetData(horoscopeData.response).slice(0, 10);
                    const dasaDetails = mapDasaDetails(horoscopeData);
                    const panchangDetails = mapPanchangDetails(horoscopeData);

                    // Add Planets Data to Table
                    await planets.forEach((planet) => {
                        // Create the table row
                        const row = document.createElement("tr");

                        // Check if at least one field has valid data
                        const hasValidData = [
                            planet.name,
                            planet.zodiac,
                            planet.house,
                            planet.nakshatra,
                            planet.nakshatra_lord,
                            planet.zodiac_lord,
                            planet.latitude,
                            planet.rishi,
                            planet.nakshatra_pada,
                            planet.relation,
                            planet.is_combust,
                            planet.retro
                        ].some((value) => isDefined(value));

                        // If the row has valid data, populate the row
                        if (hasValidData) {
                            row.innerHTML = `
            <td>${isDefined(planet.name) ? planet.name : "-"}</td>
            <td>${planet.retro ? "R" : " "}</td>
            <td>${planet.is_combust ? "C" : " "}</td>
            <td>${isDefined(planet.zodiac) ? planet.zodiac : "-"}</td>
            <td>${isDefined(planet.house) ? planet.house : "-"}</td>
            <td>${isDefined(planet.nakshatra_lord) ? planet.nakshatra_lord : "-"}</td>
            <td>${isDefined(planet.nakshatra) ? planet.nakshatra : "-"}</td>
            <td>${isDefined(planet.nakshatra_pada) ? planet.nakshatra_pada : "-"}</td>
            <td>${isDefined(planet.zodiac_lord) ? planet.zodiac_lord : "-"}</td>
            <td>${isDefined(planet.latitude) ? planet.latitude : "-"}</td>
        `;

                            planetDataElement.appendChild(row);
                        }
                    });

                    // Utility function to check if a value is defined and not blank
                    function isDefined(value) {
                        return value !== undefined && value !== null && value !== "";
                    }

                    // Add Dasa Details to Table
                    dasaDataElement.innerHTML = `
<tr>
          <td colspan="2"><strong>Birth Dasa:</strong></td>
          <td colspan="8">${dasaDetails.birth_dasa || ""}</td>
        </tr>
        <tr>
          <td colspan="2"><strong>Current Dasa:</strong></td>
          <td colspan="8">${dasaDetails.current_dasa || ""}</td>
        </tr>
        <tr>
          <td colspan="2"><strong>Lucky Gem:</strong></td>
          <td colspan="8">${dasaDetails.lucky_gem || ""}</td>
        </tr>
        <tr>
          <td colspan="2"><strong>Lucky Number:</strong></td>
          <td colspan="8">${dasaDetails.lucky_num || ""}</td>
        </tr>
        <tr>
          <td colspan="2"><strong>Lucky Colors:</strong></td>
          <td colspan="8">${dasaDetails.lucky_colors || ""}</td>
        </tr>
        <tr>
          <td colspan="2"><strong>Lucky Letters:</strong></td>
          <td colspan="8">${dasaDetails.lucky_letters || ""}</td>
        </tr>
        <tr>
          <td colspan="2"><strong>Lucky Name Start:</strong></td>
          <td colspan="8">${dasaDetails.lucky_name_start || ""}</td>
        </tr>
        <tr>
          <td colspan="2"><strong>Rasi:</strong></td>
          <td colspan="8">${dasaDetails.rasi || ""}</td>
        </tr>
  `;
                    // Add Dasa Details to Table
                    panchangDataElement.innerHTML = `
<tr>
          <td colspan="2"><strong>Ayanamsa:</strong></td>
          <td colspan="8">${panchangDetails.ayanamsa || ""}</td>
        </tr>
        <tr>
          <td colspan="2"><strong>Ayanamsa_name:</strong></td>
          <td colspan="8">${panchangDetails.ayanamsa_name || ""}</td>
        </tr>
        <tr>
          <td colspan="2"><strong>Karana:</strong></td>
          <td colspan="8">${panchangDetails.karana || ""}</td>
        </tr>
        <tr>
          <td colspan="2"><strong>Yoga:</strong></td>
          <td colspan="8">${panchangDetails.yoga || ""}</td>
        </tr>
        <tr>
          <td colspan="2"><strong>Day of birth:</strong></td>
          <td colspan="8">${panchangDetails.day_of_birth || ""}</td>
        </tr>
        <tr>
          <td colspan="2"><strong>Day lord:</strong></td>
          <td colspan="8">${panchangDetails.day_lord || ""}</td>
        </tr>
        <tr>
          <td colspan="2"><strong>Hora lord:</strong></td>
          <td colspan="8">${panchangDetails.hora_lord || ""}</td>
        </tr>
        <tr>
          <td colspan="2"><strong>Sunrise at birth:</strong></td>
          <td colspan="8">${panchangDetails.sunrise_at_birth || ""}</td>
        </tr>
        <tr>
          <td colspan="2"><strong>Sunset at birth:</strong></td>
          <td colspan="8">${panchangDetails.sunset_at_birth || ""}</td>
        </tr>
        <tr>
          <td colspan="2"><strong>Tithi:</strong></td>
          <td colspan="8">${panchangDetails.tithi || ""}</td>
        </tr>
  `;
                };

                populateHouseTable("1");
                populateTable()

            } else {
                console.error("Horoscope data not found or invalid in localStorage.");
            }
            async function DashaData() {
                const dashaInfo = mahaDashaData.response;
                const antardashaInfo = antarDashaData.response;
                const chardashaInfo = charDashaData.response;
                const charsubdashaInfo = charsubDashaData.response;
                const yoginidashaInfo = yoginiDashaData.response;
                const yoginisubdashaInfo = yoginisubDashaData.response;
                const paryantardashaInfo = paryantarDashaData.response;
                // console.log(dashaInfo, "dashaInfo")
                // console.log(antardashaInfo, "antardashaInfo")
                // console.log(chardashaInfo, "charDashaData")
                // console.log(charsubdashaInfo, "charsubDashaData")
                // console.log(yoginidashaInfo, "yoginidashaInfo")
                // console.log(yoginisubdashaInfo, "yoginisubdashaInfo")
                // console.log(paryantardashaInfo, "paryantardashaInfo")

                // Set top information
                document.getElementById("dasha_remaining").innerText = dashaInfo.dasha_remaining_at_birth;
                document.getElementById("dasha_start_date").innerText = dashaInfo.dasha_start_date;
                document.getElementById("start_year").innerText = dashaInfo.start_year;

                // Populate table
                const tableBody = document.getElementById("dashaTableBody");
                dashaInfo.mahadasha.forEach((planet, index) => {
                    const row = `<tr>
                                <td>${planet}</td>
                                <td>${dashaInfo.mahadasha_order[index]}</td>
                            </tr>`;
                    tableBody.innerHTML += row;
                });

                // Populate table of antar dasha
                const andarTableBody = document.getElementById("antardashaTableBody");
                antardashaInfo.antardashas.forEach((planetList, i) => {
                    planetList.forEach((planet, j) => {
                        const arow = `<tr>
                                    <td>${planet}</td>
                                    <td>${antardashaInfo.antardasha_order[i][j] || "N/A"}</td>
                                 </tr>`;
                        andarTableBody.innerHTML += arow;
                    });
                })

                // Display start date
                document.getElementById("startDate").textContent = chardashaInfo.start_date;

                // Populate table
                const chartableBody = document.getElementById("charDashaTableBody");
                chardashaInfo.dasha_list.forEach((sign, index) => {
                    const crow = `<tr>
                    <td>${sign}</td>
                    <td>${chardashaInfo.dasha_end_dates[index] || "N/A"}</td>
                 </tr>`;
                    chartableBody.innerHTML += crow;
                });

                // Populate table
                const charstableBody = document.getElementById("charSubDashaTableBody");
                charsubdashaInfo.forEach(dasha => {
                    dasha.sub_dasha_list.forEach((subDasha, index) => {
                        const csrow = `<tr>
                                    <td>${dasha.main_dasha}</td>
                                    <td>${dasha.main_dasha_lord}</td>
                                    <td>${subDasha}</td>
                                    <td>${dasha.sub_dasha_start_date || "N/A"}</td>
                                    <td>${dasha.sub_dasha_end_dates[index] || "N/A"}</td>
                                 </tr>`;
                        charstableBody.innerHTML += csrow;
                    });
                });

                const paryanttableBody = document.getElementById("paryantarDashaTableBody");
                paryantardashaInfo.paryantardasha.forEach((parrow, parrowIndex) => {
                    parrow.forEach((entry, colIndex) => {
                        let parstartDatevalues = [];

                        if (typeof entry === "string") {
                            values = entry.split("/"); // Normal case
                        } else if (Array.isArray(entry)) {
                            values = entry; // Use array directly
                        } else {
                            console.warn("Unexpected entry format:", entry);
                            return; // Skip this entry
                        }

                        const parstartDate = paryantardashaInfo.paryantardasha_order[parrowIndex]?.[colIndex] || "N/A";
                        values.forEach((value, i) => {
                            const parrow = `<tr>
                                    <td>${value || "-"}</td>
                                    <td>${parstartDate[i] || "-"}</td>
                                </tr>`;

                            paryanttableBody.innerHTML += parrow;
                        });
                    });
                });

                // yoginiDasha
                const yogintableBody = document.getElementById("yoginiDashaTableBody");
                // yoginistartDate
                // Display start date
                document.getElementById("yoginistartDate").textContent = yoginidashaInfo.start_date;
                yoginidashaInfo.dasha_list.forEach((dasha, index) => {
                    const dashaEndDate = yoginidashaInfo.dasha_end_dates[index] || "-";
                    const dashaLord = yoginidashaInfo.dasha_lord_list[index] || "-";

                    const rowHTML = `<tr>
                            <td>${dasha}</td>
                            <td>${dashaLord}</td>
                            <td>${dashaEndDate}</td>
                        </tr>`;

                    yogintableBody.innerHTML += rowHTML;
                });

                // yoginisub 

                const yoginsubtableBody = document.getElementById("yoginiSubDashaTableBody");
                yoginisubdashaInfo.forEach((mainDashaEntry, index) => {
                    // console.log(mainDashaEntry,"mainDashaEntry")
                    const mainDasha = mainDashaEntry.main_dasha || "-";
                    const mainDashaLord = mainDashaEntry.main_dasha_lord || "-";
                    let rowHTML = `<tr>
                          <td rowspan="${mainDashaEntry.sub_dasha_list.length}">${mainDasha}</td>
                          <td rowspan="${mainDashaEntry.sub_dasha_list.length}">${mainDashaLord}</td>`;

                    mainDashaEntry.sub_dasha_list.forEach((subDasha, subIndex) => {
                        // console.log(mainDashaEntry,"mainDashaEntry")
                        const subDashaStart = mainDashaEntry.sub_dasha_start_dates || "-";
                        const subDashaEnd = mainDashaEntry.sub_dasha_end_dates || "-";
                        // console.log(subDashaStart,"subDashaStart")
                        // console.log(subDashaEnd,"subDashaEnd")

                        if (subIndex > 0) rowHTML += "<tr>";
                        rowHTML += `<td>${subDasha}</td>
                        <td>${subDashaStart}</td>
                        <td>${subDashaEnd}</td>
                    </tr>`;
                    });
                    yoginsubtableBody.innerHTML += rowHTML;
                });
            }

            DashaData();
        }
        window.onload = async function () {
            await fetchAllData()
        };
    </script>
    <script>
        // Place this outside your generatePDF function, preferably at the top of your script
        let pdfReadImageData = null;
        let generatedDoc = null;

        function loadPdfReadImage(callback) {
            const img = new Image();
            img.crossOrigin = "Anonymous"; // Ensure cross-origin loading if image is not from the same domain
            img.onload = function () {
                const canvas = document.createElement('canvas');
                canvas.width = img.width;
                canvas.height = img.height;
                const ctx = canvas.getContext('2d');
                ctx.drawImage(img, 0, 0);
                pdfReadImageData = canvas.toDataURL('image/png');
                console.log("PDF Read Image Loaded successfully.");
                callback();
            };
            img.onerror = function () {
                console.error("Failed to load pdf-read.png image.");
                callback(); // Call callback even if image fails to load
            };
            img.src = './images/pdf-read.png'; // **Verify this path is correct**
        }

        // Call this function once before generatePDF is ever called, e.g., on DOMContentLoaded
        document.addEventListener('DOMContentLoaded', () => {
            const btn = document.getElementById('downloadPdfBtn');
            btn.disabled = true;
            btn.style.backgroundColor = 'gray';
            loadPdfReadImage(() => {
                // You can generate PDF here or just let the button click trigger it
                console.log("Image pre-loading complete. PDF generation is ready.");
                setTimeout(() => {
                    generatePDF();
                }, 1000);
            });
            document.getElementById('downloadPdfBtn').addEventListener('click', downloadPDF);
        });

        async function generatePDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF({ orientation: 'portrait', unit: 'mm', format: 'a4' });
            const pageWidth = doc.internal.pageSize.getWidth();
            const pageHeight = doc.internal.pageSize.getHeight();
            let pageNum = 1;
            const userResponse = await fetch(`${host}/api/auth/getuser`, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "auth-token": token
                }
            });

            if (!userResponse.ok == true) {
                throw new Error("Failed to fetch data");
            }

            const userData = await userResponse.json();

            const header = () => {
                doc.setFontSize(10);
                doc.text(`${userData.name}`, 10, 10);
                doc.text('Get free chart (kundli) at https://www.astronivesh.com', pageWidth - 10, 10, { align: 'right' });
                doc.line(10, 12, pageWidth - 10, 12);
            };


            const footer = () => {
                const y = pageHeight - 10;
                doc.setLineWidth(0.3);
                doc.line(10, y - 5, pageWidth - 10, y - 5);
                doc.setFontSize(10);
                doc.text(`https://www.astronivesh.com, E-mail: contact@astronivesh.com, Phone: +91 84216 16117, Page No. ${pageNum}`, pageWidth / 2, y, { align: 'center' });
            };

            const addTableSection = (title, tableElement, yOffset = 25) => {
                if (tableElement) {
                    doc.setFontSize(14);
                    doc.text(title, 10, 20);
                    doc.autoTable({
                        html: tableElement, startY: yOffset, headStyles: {
                            fillColor: '#fe7000' // Apply orange background to the header row
                        }
                    });
                }
            };

            const addTableToPage = async (title, tableElement, startY) => {
                if (tableElement && tableElement.querySelector('tbody').innerHTML.trim() !== "") {
                    doc.setFontSize(12);
                    doc.text(title, 10, startY);
                    await doc.autoTable({
                        html: tableElement, startY: startY + 5, margin: { left: 10, right: 10 }, headStyles: {
                            fillColor: '#fe7000' // Apply orange background to the header row
                        }
                    });
                    return doc.autoTable.previous.finalY + 10;
                } else {
                    console.log(`Table "${title}" is empty for the current house.`);
                    return startY;
                }
            };
            async function addChartToPage(element, x, y, width, height) {
                // Use html2canvas or similar to capture from element directly
                const canvas = await html2canvas(element);
                const imgData = canvas.toDataURL('image/png');
                doc.addImage(imgData, 'PNG', x, y, width, height);
                return true;
            }

            // New helper function to add the image if space permits
            const addImageIfSpace = (lastContentY) => {
                if (!pdfReadImageData) {
                    console.log("Image data not loaded, skipping image addition.");
                    return;
                }

                const imgWidth = 185;
                const originalImgWidthPx = 500;
                const originalImgHeightPx = 150;
                const imgHeight = (imgWidth / originalImgWidthPx) * originalImgHeightPx;

                const imgX = pageWidth - 10 - imgWidth;
                const footerHeight = 20;
                const minSpaceRequired = imgHeight;

                // Check if there's enough space between the last content and the footer
                if (pageHeight - lastContentY - footerHeight >= minSpaceRequired) {
                    const imgY = pageHeight - footerHeight - imgHeight; // 5mm padding from the footer area
                    doc.addImage(pdfReadImageData, 'PNG', imgX, imgY, imgWidth, imgHeight);
                    console.log(`Image added at Y: ${imgY} on Page ${pageNum}`);
                } else {
                    console.log(`Not enough space on page ${pageNum}. Last content Y: ${lastContentY}, Required space: ${minSpaceRequired}, Available: ${pageHeight - lastContentY - footerHeight}`);
                }
            };

            const addNewPage = () => {
                doc.addPage();
                pageNum++;
                header();
                footer();
            };

            // First Page
            await new Promise((resolve) => {
                getCircularImage('./images/astrology.png', 100, function (circularImageData) {
                    const imgX = (pageWidth - 100) / 2;
                    const imgY = 50;
                    doc.addImage(circularImageData, 'PNG', imgX, imgY, 100, 100);
                    doc.setFontSize(20);
                    doc.text("Astro Nivesh", pageWidth / 2, imgY + 120, { align: 'center' });
                    resolve();
                });
            });

            // Second Page: Panchang Details and Planetary Positions
            addNewPage();
            let currentY = 20;

            const panchangElement = document.getElementById("panchang-section");
            if (panchangElement) {
                const table = panchangElement.querySelector("table");
                if (table) {
                    doc.setFontSize(14);
                    doc.text("Panchang Details", 10, currentY);
                    doc.autoTable({
                        html: table, startY: currentY + 5, headStyles: {
                            fillColor: '#fe7000' // Apply orange background to the header row
                        }
                    });
                    currentY = doc.autoTable.previous.finalY + 10;
                }
            }

            const planetElement = document.getElementById("planet-section");
            if (planetElement) {
                const table = planetElement.querySelector("table");
                if (table) {
                    doc.setFontSize(14);
                    doc.text("Planetary Positions", 10, currentY);
                    doc.autoTable({
                        html: table, startY: currentY + 5, headStyles: {
                            fillColor: '#fe7000' // Apply orange background to the header row
                        }
                    });
                }
            }
            addImageIfSpace(currentY);

            // Next Pages: House Details (House 1 to House 12)
            const houseSection = document.getElementById('house-section');
            const houseDropdown = document.getElementById('houseDropdown');
            const tableDataContainer = houseSection.querySelector(".table-data");

            if (houseSection && houseDropdown && tableDataContainer) {
                for (let i = 1; i <= 12; i++) {
                    addNewPage();
                    doc.setFontSize(14);
                    doc.text(`House ${i} Details`, 10, 20);
                    let yPosition = 25;

                    console.log(`Processing House: ${i}`);
                    const originalValue = houseDropdown.value;
                    houseDropdown.value = i;
                    houseDropdown.dispatchEvent(new Event('change'));

                    await new Promise((resolve) => setTimeout(resolve, 500));

                    const thirdTableElement = tableDataContainer.querySelector("#thirdTable").closest("table");
                    if (thirdTableElement) {
                        yPosition = await addTableToPage(`Nakshatra(Pada), Rashi, Planets, Nature, Dasha`, thirdTableElement, yPosition);
                    }

                    const fourthTableElement = tableDataContainer.querySelector("#fourthTable").closest("table");
                    if (fourthTableElement) {
                        yPosition = await addTableToPage(`Planet Aspect`, fourthTableElement, yPosition);
                    }

                    const fifthTableElement = tableDataContainer.querySelector("#fifthTable").closest("table");
                    if (fifthTableElement) {
                        await addTableToPage(`Gochar`, fifthTableElement, yPosition);
                    }
                    addImageIfSpace(yPosition);

                    houseDropdown.value = originalValue;
                }

                // New page(s) for charts
                addNewPage();
                doc.setFontSize(14);
                doc.text("Kundli Charts", 10, 20);
                let chartY = 25;
                const chartWidth = pageWidth / 3 - 15;
                const chartHeight = 70;
                const chartXStart = 10;
                let chartRow = 0;
                let chartCol = 0;
                let chartIndex = 0;

                const divisionalSelectElement = document.getElementById('divisionalSelect');
                const divisionalOptions = Array.from(divisionalSelectElement.options).map(opt => opt.value);
                // const othersDivElement = document.querySelector(".kundali-img-nres.others"); 

                async function fetchChartUrls() {
                    const response = await fetch(`${host}/api/detail/fetchalldetail`, {
                        method: "GET",
                        headers: {
                            "Content-Type": "application/json",
                            "auth-token": token
                        }
                    });
                    const data = await response.json();
                    return data?.[0] || {};
                }

                const allChartUrls = await fetchChartUrls();

                // Map divisional label to corresponding chart URL key in allChartUrls
                const chartMap = {
                    "D1": allChartUrls?.chart1Url,
                    "D3": allChartUrls?.chart3Url,
                    "D3-s": allChartUrls?.chart3sUrl,
                    "D7": allChartUrls?.chart7Url,
                    "D9": allChartUrls?.chart9Url || allChartUrls?.chart2Url,
                    "D10": allChartUrls?.chart10Url,
                    "D10-R": allChartUrls?.chart10rUrl,
                    "D12": allChartUrls?.chart12Url,
                    "D16": allChartUrls?.chart16Url,
                    "D20": allChartUrls?.chart20Url,
                    "D24": allChartUrls?.chart24Url,
                    "D24-R": allChartUrls?.chart24rUrl,
                    "D30": allChartUrls?.chart30Url,
                    "D40": allChartUrls?.chart40Url,
                    "D45": allChartUrls?.chart45Url,
                    "D60": allChartUrls?.chart60Url,
                };

                for (const divisional of divisionalOptions) {
                    const chartHtml = chartMap[divisional];
                    if (!chartHtml || chartHtml.trim() === "") continue;

                    // Parse the chart HTML string safely
                    const parser = new DOMParser();
                    const parsedDoc = parser.parseFromString(chartHtml, "text/html");

                    // Create a temp div and append parsed content
                    const tempDiv = document.createElement("div");
                    tempDiv.style.position = "absolute";
                    tempDiv.style.left = "-9999px";
                    tempDiv.style.top = "0";
                    tempDiv.style.width = "auto";
                    tempDiv.style.height = "auto";
                    tempDiv.style.background = "white"; // Optional: improve contrast
                    tempDiv.append(...parsedDoc.body.childNodes);
                    document.body.appendChild(tempDiv);

                    await new Promise(resolve => setTimeout(resolve, 300)); // Give DOM time

                    const x = chartXStart + chartCol * (chartWidth + 5);
                    const y = 25 + chartRow * (chartHeight + 10);

                    try {
                        const result = await addChartToPage(tempDiv, x, y, chartWidth, chartHeight);
                        if (result) {
                            chartY = Math.max(chartY, y + chartHeight + 5);

                            if (chartCol < 2) {
                                chartCol++;
                            } else {
                                chartCol = 0;
                                chartRow++;
                            }

                            if ((chartIndex + 1) % 6 === 0) {
                                addImageIfSpace(chartY);
                                addNewPage();
                                doc.setFontSize(14);
                                doc.text("Kundli Charts (Continued)", 10, 20);
                                chartY = 25;
                                chartRow = 0;
                                chartCol = 0;
                            }

                            chartIndex++;
                        }
                    } catch (error) {
                        console.error("Error adding chart:", divisional, error);
                    }

                    tempDiv.remove(); // Clean up
                }
                addImageIfSpace(chartY);
            }
            // Next Pages: Dasha Details
            addNewPage();
            const dasaTitle = "Dasha Details";
            const dasaElement = document.getElementById("dasa-section");
            if (dasaElement) {
                doc.setFontSize(14);
                doc.text(dasaTitle, 10, 20);
                let dasaYOffset = 25;

                const dasaDetailsTable = dasaElement.querySelector("table");
                if (dasaDetailsTable) {
                    doc.autoTable({
                        html: dasaDetailsTable, startY: dasaYOffset, headStyles: {
                            fillColor: '#fe7000'
                        }
                    });
                    dasaYOffset = doc.autoTable.previous.finalY + 10;
                }

                const mahaDashaTable = dasaElement.querySelector(".kundali-dashaCards:nth-child(1) table");
                if (mahaDashaTable) {
                    doc.setFontSize(12);
                    doc.text("Maha Dasha", 10, dasaYOffset);
                    doc.autoTable({
                        html: mahaDashaTable, startY: dasaYOffset + 5, headStyles: {
                            fillColor: '#fe7000' // Apply orange background to the header row
                        }
                    });
                    dasaYOffset = doc.autoTable.previous.finalY + 10;
                }

                const charDashaTable = dasaElement.querySelector(".kundali-dashaCards:nth-child(2) table");
                if (charDashaTable) {
                    doc.setFontSize(12);
                    doc.text("Char Dasha", 10, dasaYOffset);
                    doc.autoTable({
                        html: charDashaTable, startY: dasaYOffset + 5, headStyles: {
                            fillColor: '#fe7000' // Apply orange background to the header row
                        }
                    });
                    dasaYOffset = doc.autoTable.previous.finalY + 10;
                }
                addImageIfSpace(dasaYOffset);

                const antarDashaTable = dasaElement.querySelector(".kundali-dashaCards:nth-child(3) table");
                if (antarDashaTable) {
                    addNewPage();
                    doc.setFontSize(14);
                    doc.text("Dasha Details (Continued)", 10, 20);
                    doc.setFontSize(12);
                    doc.text("Antar Dasha", 10, 25);
                    doc.autoTable({
                        html: antarDashaTable, startY: 30, headStyles: {
                            fillColor: '#fe7000' // Apply orange background to the header row
                        }
                    });
                    dasaYOffset = doc.autoTable.previous.finalY + 10;
                }
                addImageIfSpace(dasaYOffset);

                const yoginiDashaTable = dasaElement.querySelector(".kundali-dashaCards:nth-child(4) table");
                if (yoginiDashaTable) {
                    addNewPage();
                    doc.setFontSize(14);
                    doc.text("Dasha Details (Continued)", 10, 20);
                    doc.setFontSize(12);
                    doc.text("Yogini Dasha", 10, 25);
                    doc.autoTable({
                        html: yoginiDashaTable, startY: 30, headStyles: {
                            fillColor: '#fe7000' // Apply orange background to the header row
                        }
                    });
                    dasaYOffset = doc.autoTable.previous.finalY + 10;
                }
                addImageIfSpace(dasaYOffset);

                const charSubDashaTable = dasaElement.querySelector(".kundali-dashaCards:nth-child(5) table");
                if (charSubDashaTable) {
                    addNewPage();
                    doc.setFontSize(14);
                    doc.text("Dasha Details (Continued)", 10, 20);
                    doc.setFontSize(12);
                    doc.text("Char Dasha Sub", 10, 25);
                    doc.autoTable({
                        html: charSubDashaTable, startY: 30, headStyles: {
                            fillColor: '#fe7000' // Apply orange background to the header row
                        }
                    });
                    dasaYOffset = doc.autoTable.previous.finalY + 10;
                }
                addImageIfSpace(dasaYOffset);

                const yoginiSubDashaTable = dasaElement.querySelector(".kundali-dashaCards:nth-child(6) table");
                if (yoginiSubDashaTable) {
                    addNewPage();
                    doc.setFontSize(14);
                    doc.text("Dasha Details (Continued)", 10, 20);
                    doc.setFontSize(12);
                    doc.text("Yogini Dasha Sub", 10, 25);
                    doc.autoTable({
                        html: yoginiSubDashaTable, startY: 30, headStyles: {
                            fillColor: '#fe7000'
                        }
                    });
                    dasaYOffset = doc.autoTable.previous.finalY + 10;
                }
                addImageIfSpace(dasaYOffset);

                const paryantarDashaTable = dasaElement.querySelector(".kundali-dashaCards:nth-child(7) table");
                if (paryantarDashaTable) {
                    addNewPage();
                    doc.setFontSize(14);
                    doc.text("Dasha Details (Continued)", 10, 20);
                    doc.setFontSize(12);
                    doc.text("Paryantar Dasha", 10, 25);
                    doc.autoTable({
                        html: paryantarDashaTable, startY: 30, headStyles: {
                            fillColor: '#fe7000'
                        }
                    });
                }
                addImageIfSpace(dasaYOffset);
            }
            // doc.save("kundli-report.pdf");
            generatedDoc = doc;
            const btn = document.getElementById('downloadPdfBtn');
            btn.disabled = false;
            btn.style.backgroundColor = '#fe7000';
        }
        function downloadPDF() {
            if (generatedDoc) {
                generatedDoc.save("kundli-report.pdf");
            } else {
                console.warn("PDF not yet generated. Please wait.");
                // Optionally, show a message to the user
            }
        }

        function getCircularImage(imageSrc, diameterMM, callback) {
            const img = new Image();
            img.crossOrigin = "Anonymous";
            img.onload = function () {
                const dpi = 300;
                const pxPerMM = dpi / 25.4;
                const diameterPx = diameterMM * pxPerMM;
                const canvas = document.createElement("canvas");
                canvas.width = diameterPx;
                canvas.height = diameterPx;
                const ctx = canvas.getContext("2d");
                ctx.beginPath();
                ctx.arc(diameterPx / 2, diameterPx / 2, diameterPx / 2, 0, Math.PI * 2);
                ctx.closePath();
                ctx.clip();
                ctx.drawImage(img, 0, 0, diameterPx, diameterPx);
                const highResImage = canvas.toDataURL("image/png", 1.0);
                callback(highResImage);
            };
            img.src = imageSrc;
        }
    </script>

    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
    <!-- Swiper Js file -->
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <!-- script file -->
    <script src="./js/index.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>


</body>

</html>