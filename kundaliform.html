<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Astro Market Web App</title>
    <!-- swiper slider css CDN -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.1/css/all.min.css"
        integrity="sha512-5Hs3dF2AEPkpNAR7UiOHba+lRSJNeM2ECkwxUIxC1Q/FLycGTbNapWXB4tP889k5T5Ju8fs4b1P5z/iB4nMfSQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <!-- Tempus Dominus CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link rel="stylesheet" href="./css/style.css">

</head>

<body>


    <!-- __________________________________ 
     Our header Comp 
     ------------------------ -->

    <header class="header-comp">
        <div class="common-container3">

            <div class="header-flex-bx flex item-between">

                <div class="left-header-logo flex item-start gap">
                    <img src="./images/astrology.png" alt="">

                    <h6>Astroyogi</h6>

                </div>

                <div class="right-navbar class-rel flex item-start gap">
                    <div class="navbar class-rel">
                        <nav class="nav class-rel">
                            <div class="nav-lists flex item-start">
                                <li><a href="#">Calendar</a></li>
                                <li><a href="#">Market</a></li>
                                <li><a href="#">Kundali</a></li>
                                <li><a href="#">Affirmations</a></li>
                                <li><a href="#">Runes</a></li>
                                <li><a href="#">Healing</a></li>
                                <li><a href="#">Wisdom</a></li>
                            </div>
                        </nav>
                    </div>

                    <div class="header-icons-flex-bx class-rel flex gap">

                        <a href="#">
                            <button class="headr-btn">
                                <ion-icon name="cart-outline"></ion-icon>
                                <span>Store</span>
                            </button>
                        </a>

                        <a href="#">
                            <button id="login_btn" class="headr-btn headr-btn2">
                                <ion-icon name="person"></ion-icon>
                                <span>Login</span>
                            </button>
                        </a>

                    </div>

                    <button class="menu-bar-btn">
                        <i class="fa-solid fa-bars-staggered"></i>
                    </button>

                </div>

            </div>

        </div>
    </header>

    <!-- _______________________
       Our Login Reg Comp 
       ------------------ -->

    <section class="login-reg-comp">

        <div class="login-bx ">

            <button class="close-form-btn">
                <i class="fa-solid fa-xmark"></i>
            </button>

            <div class="login-info">

                <div class="login-logo">
                    <img src="./images/astrology.png" alt="">
                </div>



                <div class="comn-heading">
                    <h4>Sign In to Astrology </h4>
                    <!-- <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Minima maxime est obcaecati.</p> -->
                </div>

                <div class="login-form">
                    <form action="#">

                        <div class="inpt-bx">
                            <label for="email">Email Address</label>
                            <div class="inpt">
                                <input type="email" name="email" placeholder="Enter your email address..."
                                    autocomplete="off" required>
                            </div>
                        </div>

                        <div class="inpt-bx">
                            <label for="email">Password</label>
                            <div class="inpt">
                                <input type="password" name="password" placeholder="Enter your password..."
                                    autocomplete="off" required>
                            </div>
                        </div>




                    </form>

                    <div class="form-btns-flex">

                        <button class="form-btn">
                            Sign In
                        </button>

                        <button class="form-btn form-btn2" id="newAcnt">
                            Create Account
                        </button>

                    </div>

                </div>
            </div>

            <div class="reg-info">

                <div class="login-logo">
                    <img src="./images/astrology.png" alt="">
                </div>

                <div class="comn-heading">
                    <h4>Sign Up to Astrology </h4>
                    <!-- <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Minima maxime est obcaecati.</p> -->
                </div>

                <div class="login-form">
                    <form action="#">

                        <div class="inpt-bx">
                            <label for="name">Name</label>
                            <div class="inpt">
                                <input type="text" name="name" placeholder="Enter your Name" autocomplete="off"
                                    required>
                            </div>
                        </div>

                        <div class="inpt-bx">
                            <label for="name">Email</label>
                            <div class="inpt">
                                <input type="email" name="email" placeholder="Enter your email address..."
                                    autocomplete="off" required>
                            </div>
                        </div>

                        <div class="inpt-bx">
                            <label for="password">Create Password</label>
                            <div class="inpt">
                                <input type="text" name="createpassword" placeholder="Create your password..."
                                    autocomplete="off" required>
                            </div>
                        </div>


                        <div class="inpt-bx">
                            <label for="password">Date Of Birth</label>
                            <div class="inpt">
                                <input type="text" id="calendarInput" placeholder="Choose a date" />
                            </div>
                        </div>

                        <div class="inpt-bx">
                            <label for="password">Birth Time</label>
                            <div class="inpt">
                                <input type="text" id="timePicker" class="time-picker" placeholder="Select Time">
                            </div>
                        </div>
                        <div class="inpt-bx">
                            <label for="birthplace"> Birth Place</label>
                            <div class="inpt">
                                <input type="text" name="birthplace" placeholder="Enter your birth place..."
                                    autocomplete="off" required>
                            </div>
                        </div>


                    </form>

                    <div class="form-btns-flex">

                        <button class="form-btn">
                            Create Account
                        </button>

                        <button class="form-btn  form-btn3" id="signInBtn">
                            I Already Have Account
                        </button>

                    </div>

                </div>

            </div>

        </div>

    </section>

    <!-- ______________________________
        Our kundali form 
        ----------------- -->

    <section class="kundali-form-comp">
        <div class="common-container3">

            <div class="kundali-form-main">

                <div class="kundali-form-bx">
                    <h4>Kundali / Birth Chart</h4>

                    <div class="kundali_form">
                        <h6>Enter Birth Details</h6>
                        <form action="#" class="kundaliform" id="kundaliform">
                            <div class="inpt-bx">
                                <label for="fullname">Full Name</label>
                                <div class="inpt">
                                    <input type="text" name="fullname" id="fullname" placeholder="Enter your name..."
                                        autocomplete="off" required />
                                </div>
                            </div>

                            <div class="inpt-bx">
                                <label for="gender">Gender</label>
                                <div class="inpt">
                                    <select name="gender" id="gender">
                                        <option value="male">Male</option>
                                        <option value="female">Female</option>
                                    </select>
                                </div>
                            </div>

                            <div class="kundali-birth-flex">
                                <div class="inpt-bx">
                                    <label for="day">Day</label>
                                    <div class="inpt">
                                        <input type="number" id="day" class="day" min="1" max="31" required />
                                    </div>
                                </div>

                                <div class="inpt-bx">
                                    <label for="month">Month</label>
                                    <div class="inpt">
                                        <input type="number" id="month" class="month" min="1" max="12" required />
                                    </div>
                                </div>

                                <div class="inpt-bx">
                                    <label for="year">Year</label>
                                    <div class="inpt">
                                        <input type="number" id="year" class="year" min="1900" max="2100" required />
                                    </div>
                                </div>
                            </div>

                            <div class="kundali-birth-flex">
                                <div class="inpt-bx">
                                    <label for="hours">Hours</label>
                                    <div class="inpt">
                                        <input type="number" id="hours" class="hours" min="0" max="23" required />
                                    </div>
                                </div>

                                <div class="inpt-bx">
                                    <label for="minutes">Minutes</label>
                                    <div class="inpt">
                                        <input type="number" id="minutes" class="minutes" min="0" max="59" required />
                                    </div>
                                </div>

                                <div class="inpt-bx">
                                    <label for="seconds">Seconds</label>
                                    <div class="inpt">
                                        <input type="number" id="seconds" class="seconds" min="0" max="59" />
                                    </div>
                                </div>
                            </div>

                            <div class="inpt-bx">
                                <label for="birthplace">Birth Place</label>
                                <div class="inpt">
                                    <input type="text" id="birthplace" class="birthplace"
                                        placeholder="Enter birth place..." required />
                                </div>
                            </div>

                            <a href="./kundali.html">
                                <button class="form-btn kundli-btn" type="submit">
                                    Get Kundali
                                </button>
                            </a>

                        </form>
                    </div>
                </div>

            </div>

        </div>
    </section>
    <script>
        document.getElementById('kundaliform').addEventListener('submit', async function (e) {
            e.preventDefault();

            // Date of Birth
            const day = document.getElementById('day').value.padStart(2, '0');
            const month = document.getElementById('month').value.padStart(2, '0');
            const year = document.getElementById('year').value;

            // Time of Birth
            const hours = document.getElementById('hours').value.padStart(2, '0');
            const minutes = document.getElementById('minutes').value.padStart(2, '0');
            const seconds = document.getElementById('seconds').value || '00';

            // Form data
            const textInput = document.getElementById('fullname').value;
            const gender = document.getElementById('gender').value;
            const date = `${day}/${month}/${year}`;
            const time = `${hours}:${minutes}`;
            const location = document.getElementById('birthplace').value;

            // const loading = document.getElementById('loading');
            // const error = document.getElementById('error');
            // loading.style.display = 'block';

            try {
                const formattedDate = date.split('-').reverse().join('/');

                // Fetch location coordinates
                const altitudeUrl = `https://vedastroapi.azurewebsites.net/api/Calculate/AddressToGeoLocation/Address/${encodeURIComponent(
                    location
                )}/Ayanamsa/Raman`;
                const response1 = await fetch(altitudeUrl);
                if (!response1.ok) throw new Error("Failed to fetch location data.");
                const data1 = await response1.json();
                const lat = data1.Payload.AddressToGeoLocation.Latitude;
                const lon = data1.Payload.AddressToGeoLocation.Longitude;

                const params = {
                    api_key: "740c3002-e2c8-579c-af20-d71510bdbd4c",
                    dob: formattedDate,
                    tob: time,
                    lat,
                    lon,
                    location,
                    tz: 5.5,
                    lang: "en",
                    D1: "D1",
                    D9: "D9",
                };

                const strengthUrl = `https://vedastroapi.azurewebsites.net/api/Calculate/PlanetStrength/PlanetName/All/Location/${location}/Time/${params.tob}/${params.dob}/+05:30`
                const response4 = await fetch(strengthUrl);
                if (!response4.ok) throw new Error("Failed to fetch horoscope data.");
                const strengthData = await response4.json();

                const natureUrl = `https://vedastroapi.azurewebsites.net/api/Calculate/IsPlanetBenefic/PlanetName/All/Location/${location}/Time/${params.tob}/${params.dob}/+05:30`
                const response5 = await fetch(natureUrl);
                if (!response5.ok) throw new Error("Failed to fetch nature data.");
                const natureData = await response5.json();

                const benificAspectUrl = `https://vedastroapi.azurewebsites.net/api/Calculate/IsPlanetAspectedByBeneficPlanets/PlanetName/All9WithUpagrahas/Location/${location}/Time/${params.tob}/${params.dob}/+05:30`
                const response6 = await fetch(benificAspectUrl);
                if (!response6.ok) throw new Error("Failed to fetch aspect by planet data.");
                const benificAspectData = await response6.json();

                // Fetch horoscope data
                const baseUrl = "https://api.vedicastroapi.com/v3-json/horoscope/";
                const horoscopeUrl = `${baseUrl}planet-details?dob=${params.dob}&tob=${params.tob}&lat=${params.lat}&lon=${params.lon}&tz=${params.tz}&api_key=${params.api_key}&lang=${params.lang}`;
                const response2 = await fetch(horoscopeUrl);
                if (!response2.ok) throw new Error("Failed to fetch horoscope data.");
                const horoscopeData = await response2.json();

                // Fetch charts
                const chart1Url = `${baseUrl}chart-image?dob=${params.dob}&tob=${params.tob}&lat=${params.lat}&lon=${params.lon}&tz=${params.tz}&div=${params.D1}&color=%23ff3366&style=north&api_key=${params.api_key}&lang=${params.lang}`;
                const chart2Url = `${baseUrl}chart-image?dob=${params.dob}&tob=${params.tob}&lat=${params.lat}&lon=${params.lon}&tz=${params.tz}&div=${params.D9}&color=%23ff3366&style=north&api_key=${params.api_key}&lang=${params.lang}`;

                // Save data to localStorage
                localStorage.setItem('horoscopeData', JSON.stringify(horoscopeData));
                localStorage.setItem('strengthData', JSON.stringify(strengthData));
                localStorage.setItem('natureData', JSON.stringify(natureData));
                localStorage.setItem('params', JSON.stringify(params));
                try {
                    // Fetch the chart data
                    const response3 = await fetch(chart1Url);
                    const chart1Data = await response3.text();

                    const response4 = await fetch(chart2Url);
                    const chart2Data = await response4.text();

                    // Save data to localStorage
                    localStorage.setItem("chart1Data", chart1Data);
                    localStorage.setItem("chart2Data", chart2Data);

                    // alert("Charts have been fetched and saved to localStorage!");
                } catch (error) {
                    console.error("Error fetching charts:", error);
                }

                // Redirect to kundali.html
                window.location.href = './kundali.html';
            } catch (err) {
                error.textContent = err.message;
            } finally {
                loading.style.display = 'none';
            }
        });
    </script>
    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
    <!-- Swiper Js file -->
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <!-- script file -->
    <script src="./js/index.js"></script>



</body>

</html>