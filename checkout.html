<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Checkout | Astro Nivesh</title>
    <!-- swiper slider css CDN -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.1/css/all.min.css"
        integrity="sha512-5Hs3dF2AEPkpNAR7UiOHba+lRSJNeM2ECkwxUIxC1Q/FLycGTbNapWXB4tP889k5T5Ju8fs4b1P5z/iB4nMfSQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <!-- Tempus Dominus CSS -->
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link rel="stylesheet" href="./css/style.css">
    <link rel="icon" href="/images/astrology.png" />
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-ZF2CQTE5JG"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-ZF2CQTE5JG');
    </script>
    <script src="https://cdn.pagesense.io/js/astronivesh/b70b9482d2454a09ac5feadc3675f35c.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

</head>

<body>
    <!-- __________________________________ 
     Our header Comp 
     ------------------------ -->
    <!-- 
     <header class="header-comp">
        <div class="common-container3">

            <div class="header-flex-bx flex item-between">

                <div class="left-header-logo flex item-start gap">
                    <img src="./images/astrology.png" alt="">

                    <h6>Astro Nivesh</h6>
                    
                </div>

                <div class="right-navbar class-rel flex item-start gap">
                    <div class="navbar class-rel">
                    <nav class="nav class-rel">
                        <div class="nav-lists flex item-start">
                            <li><a href="#">Calendar</a></li>
                            <li><a href="#">Market</a></li>
                            <li><a href="#">Kundali</a></li>
                            <li><a href="#">Affirmations</a></li>
                            <li><a href="#">Runes</a></li>
                            <li><a href="#">Healing</a></li>
                            <li><a href="#">Wisdom</a></li>
                        </div>
                    </nav>
                </div>

                <div class="header-icons-flex-bx class-rel flex gap">

                    <a href="#">
                        <button class="headr-btn">
                            <ion-icon name="cart-outline"></ion-icon>
                            <span>Store</span>
                        </button>
                    </a>

                    <a href="#">
                        <button id="login_btn" class="headr-btn headr-btn2">
                            <ion-icon name="person"></ion-icon>
                            <span>Login</span>
                        </button>
                    </a>
                    
                </div>

                <button class="menu-bar-btn">
                    <i class="fa-solid fa-bars-staggered"></i>
                </button>
                
                </div>
                
            </div>
            
        </div>
     </header> -->

    <section class="top-header-comp">
        <div class="common-container3 top-header-flex flex item-between">
            <div class="left-header-logo flex item-start gap">
                <img src="./images/astrology.png" alt="">

                <h6>Astro Nivesh</h6>

            </div>

            <div class="right-top-header-flex-bx flex item-start gap">

                <!-- <div class="top-hedr-bx flex item-center">
                    <div class="left-hedr-icon">
                        <ion-icon name="home"></ion-icon>
                    </div>
                    <div class="right-hedr-inof">
                        <h6>Reach Us</h6>
                        <span>601 , Ram Nagar Dewas</span>
                    </div>
                </div> -->

                <div class="top-hedr-bx flex item-center">
                    <div class="left-hedr-icon">
                        <ion-icon name="call"></ion-icon>
                    </div>
                    <div class="right-hedr-inof">
                        <h6>Talk to Us</h6>
                        <span>+91-9376241408</span>
                    </div>
                </div>


                <button class="menu-bar-btn">
                    <ion-icon name="menu"></ion-icon>
                </button>


                <!-- <div class="cart-bx cart-bx2">
                    <button class="cart-btn cart-btn2">
                        <span class="qty">4</span>
                        <ion-icon name="bag"></ion-icon>
                    </button>

                    <div class="cart-lists-bx cart-lists-bx-mob">

                        <li>
                            <div class="item-img">
                                <img src="./images/astro-book.jpg" alt="">
                            </div>
                            <div class="item-info">
                                <h6>Astro Book</h6>
                                <p>Quantity : 2 x $45</p>

                                <h5>$90</h5>
                            </div>
                            <div class="delet-item-btn">
                                <ion-icon name="trash"></ion-icon>
                            </div>
                        </li>


                        <li>
                            <div class="item-img">
                                <img src="./images/astro-book.jpg" alt="">
                            </div>
                            <div class="item-info">
                                <h6>Astro Book</h6>
                                <p>Quantity : 2 x $45</p>

                                <h5>$90</h5>
                            </div>

                            <div class="delet-item-btn">
                                <ion-icon name="trash"></ion-icon>
                            </div>

                        </li>


                        <li>
                            <div class="item-img">
                                <img src="./images/astro-book.jpg" alt="">
                            </div>
                            <div class="item-info">
                                <h6>Astro Book</h6>
                                <p>Quantity : 2 x $45</p>

                                <h5>$90</h5>
                            </div>
                            <div class="delet-item-btn">
                                <ion-icon name="trash"></ion-icon>
                            </div>
                        </li>

                        <button class="apnt-btn chckout-btn">
                            Check Out
                        </button>

                    </div>

                </div> -->

                <button class="apnt-btn" onclick="window.location.href='appointments.html'">
                    Talk to Astrologer
                </button>

                <div class="profile-bx" id="login_btn">
                    <ion-icon name="person-circle-outline" size="large" color="#fe7000"></ion-icon>
                    <p id="profile-name">LogIn / Reg.</p>
                </div>

            </div>

        </div>
    </section>
    <style>
        .coming-soon {
            filter: grayscale(5);
        }

        .coming-soon .card-info {
            color: #ffffff;
            display: none;
            justify-content: center;
            align-items: center;
            width: 100%;
            height: 100%;
            overflow: visible;
            border-radius: .7rem;
            position: absolute;
            top: 0;
            left: 0;
            z-index: 3;
            background: #dcdcdc;
            transition: ease-in-out
        }

        .coming-soon:hover .card-info {
            color: white;
            transition: color 1s;
            display: flex;
            transition: ease-in-out;
        }

        .coming-soon .card-info p {
            color: white;
        }

        .page-title {
            text-align: center;
            margin-bottom: 2rem;
        }

        .textareainput {
            position: relative;
            width: 100%;
            height: 8.5rem;
            background-color: #fff;
            border: 0.1rem solid #ddd;
            border-radius: 2rem;
        }

        .textareainput textarea {
            position: relative;
            width: 100%;
            height: 100%;
            background-color: #fff;
            border-radius: 2rem;
            border: none;
            padding: 1rem;
        }

        label span {
            color: red;
            font-size: 12px;
        }
    </style>


    <header class="header">
        <div class="common-container3 header-flex flex item-between gap">

            <div class="nav-overlay"></div>
            <div class="navbar">

                <button class="close-nav-btn">
                    <ion-icon name="close-circle"></ion-icon>
                </button>

                <div class="left-header-logo flex item-start gap mob-logo">
                    <img src="./images/astrology.png" alt="">

                    <h6>Astro Nivesh</h6>

                </div>

                <div class="search-inpt-bx search-inpt-bx-mob">
                    <input type="text" name="search" id="search" placeholder="Search here...">
                    <button class="search-btn">
                        <ion-icon name="search"></ion-icon>
                    </button>
                </div>

                <nav class="nav">
                    <div class="nav-lists flex item-start">
                        <li><a href="home.html">Home</a></li>
                        <li><a href="kundali.html">Kundali</a></li>
                        <li><a href="market.html">Market</a></li>
                        <li><a href="https://wa.me/9376241408">Talk to Astrologer</a></li>
                    </div>
                </nav>

                <div class="astrology-cont-info">

                    <div class="top-hedr-bx flex item-center">
                        <div class="left-hedr-icon">
                            <ion-icon name="home"></ion-icon>
                        </div>
                        <div class="right-hedr-inof">
                            <h6>Reach Us</h6>
                            <span>601 , Ram Nagar Dewas</span>
                        </div>
                    </div>

                    <div class="top-hedr-bx flex item-center">
                        <div class="left-hedr-icon">
                            <ion-icon name="call"></ion-icon>
                        </div>
                        <div class="right-hedr-inof">
                            <h6>Talk to Us</h6>
                            <span>+91-9376241408</span>
                        </div>
                    </div>

                </div>


                <button class="apnt-btn apnt-btn-mob" onclick="window.location.href='appointments.html'">
                    Talk to Astrologer
                </button>

            </div>

            <div class="right-header-flex flex item-start ">
                <div class="search-inpt-bx">
                    <input type="text" name="search" id="search" placeholder="Search here...">
                    <button class="search-btn">
                        <ion-icon name="search"></ion-icon>
                    </button>
                </div>


                <!-- <div class="cart-bx">
                    <button class="cart-btn">
                        <span class="qty">4</span>
                        <ion-icon name="bag"></ion-icon>
                    </button>

                    <div class="cart-lists-bx">

                        <li>
                            <div class="item-img">
                                <img src="./images/astro-book.jpg" alt="">
                            </div>
                            <div class="item-info">
                                <h6>Astro Book</h6>
                                <p>Quantity : 2 x $45</p>

                                <h5>$90</h5>
                            </div>
                            <div class="delet-item-btn">
                                <ion-icon name="trash"></ion-icon>
                            </div>
                        </li>


                        <li>
                            <div class="item-img">
                                <img src="./images/astro-book.jpg" alt="">
                            </div>
                            <div class="item-info">
                                <h6>Astro Book</h6>
                                <p>Quantity : 2 x $45</p>

                                <h5>$90</h5>
                            </div>

                            <div class="delet-item-btn">
                                <ion-icon name="trash"></ion-icon>
                            </div>

                        </li>


                        <li>
                            <div class="item-img">
                                <img src="./images/astro-book.jpg" alt="">
                            </div>
                            <div class="item-info">
                                <h6>Astro Book</h6>
                                <p>Quantity : 2 x $45</p>

                                <h5>$90</h5>
                            </div>
                            <div class="delet-item-btn">
                                <ion-icon name="trash"></ion-icon>
                            </div>
                        </li>

                        <button class="apnt-btn chckout-btn">
                            Check Out
                        </button>

                    </div>

                </div> -->



            </div>

        </div>
    </header>

    <!-- _______________________
       Our Login Reg Comp 
       ------------------ -->

    <section class="login-reg-comp">

        <div class="login-bx ">

            <button class="close-form-btn">
                <i class="fa-solid fa-xmark"></i>
            </button>

            <div class="login-info">

                <div class="login-logo">
                    <img src="./images/astrology.png" alt="">
                </div>



                <div class="comn-heading">
                    <h4>Sign In to Astrology </h4>
                    <!-- <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Minima maxime est obcaecati.</p> -->
                </div>

                <div class="login-form">

                    <form onsubmit="handleSubmit(event)">

                        <div class="inpt-bx">
                            <label for="email">Email Address</label>
                            <div class="inpt">
                                <input type="email" id="email" name="email" placeholder="Enter your Email..."
                                    autocomplete="off" required>

                            </div>
                        </div>

                        <div class="inpt-bx">
                            <label for="email">Password</label>
                            <div class="inpt">
                                <input type="password" id="password" name="password"
                                    placeholder="Enter your password..." autocomplete="off" required>
                            </div>
                        </div>

                        <div class="form-btns-flex">

                            <button class="form-btn" type="submit">
                                Sign In
                            </button>

                            <button type="button" class="form-btn form-btn2" id="newAcnt">
                                Create Account
                            </button>

                        </div>
                        <div id="alert" class="alert"></div>


                    </form>


                </div>
            </div>

            <div class="reg-info">

                <div class="login-logo">
                    <img src="./images/astrology.png" alt="">
                </div>

                <div class="comn-heading">
                    <h4>Sign Up to Astrology </h4>
                    <!-- <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Minima maxime est obcaecati.</p> -->
                </div>

                <div class="login-form">
                    <form onsubmit="handleCreate(event)">

                        <div class="inpt-bx">
                            <label for="name">Name</label>
                            <div class="inpt">
                                <input type="text" name="cname" placeholder="Enter your Name" autocomplete="off"
                                    required>
                            </div>
                        </div>

                        <div class="inpt-bx">
                            <label for="name">Email</label>
                            <div class="inpt">
                                <input type="email" name="cemail" placeholder="Enter your email address..."
                                    autocomplete="off" required>
                            </div>
                        </div>

                        <div class="inpt-bx">
                            <label for="password">Create Password</label>
                            <div class="inpt">
                                <input type="text" name="ccreatepassword" placeholder="Create your password..."
                                    autocomplete="off" required>
                            </div>
                        </div>


                        <div class="inpt-bx">
                            <label for="password">Date Of Birth</label>
                            <div class="inpt">
                                <input type="text" id="calendarInput" name="calendarInput"
                                    placeholder="Choose a date" />
                            </div>
                        </div>

                        <div class="inpt-bx">
                            <label for="password">Birth Time</label>
                            <div class="inpt">
                                <input type="text" id="timePicker" name="timePicker" class="time-picker"
                                    placeholder="Select Time">
                            </div>
                        </div>
                        <div class="inpt-bx">
                            <label for="birthplace">Birth Place</label>
                            <div class="inpt">
                                <input type="text" name="birthplace" placeholder="Enter your Birth Place..."
                                    autocomplete="off" required>
                            </div>
                        </div>
                        <div class="inpt-bx">
                            <label for="consonent">Consonent of your name</label>
                            <div class="inpt">
                                <input type="text" name="consonent" placeholder="Enter your Consonent..."
                                    autocomplete="off" required>
                            </div>
                        </div>
                        <div class="inpt-bx">
                            <label for="vowel">Vowel of your name</label>
                            <div class="inpt">
                                <input type="text" name="vowel" placeholder="Enter your Vowel..." autocomplete="off"
                                    required>
                            </div>
                        </div>

                        <div class="form-btns-flex">

                            <button class="form-btn" type="submit">
                                Create Account
                            </button>

                            <button class="form-btn  form-btn3" type="button" id="signInBtn">
                                I Already Have Account
                            </button>

                        </div>

                    </form>


                </div>

            </div>
            <div class="profile-info">
                <div class="login-logo">
                    <img src="./images/astrology.png" alt="">
                </div>
                <div class="comn-heading">
                    <h4>Astro Nivesh</h4>
                </div>

                <div id="profile-body"></div>
                <a style=" display: flex; align-items: center; justify-content: center;  font-size: 18px; padding-top: 1rem;"
                    href="profile.html"><i class="fa-solid fa-user" style="margin-right: 10px;"></i>My Profile</a>
                <div class="logout-bx" id="logoutBox">
                    <p><ion-icon name="log-out"></ion-icon>Log Out</p>
                </div>
            </div>

        </div>

    </section>

    <!-- body section -->

    <section class="kundali-comp">
        <div class="common-container3">
            <h5 class="page-title">Checkout</h5>
            <div class="kundali-container">
                <div class="Checkout">
                    <div class="Checkout-left">
                        <h6>Billing Address</h6>
                        <div class="Checkout-left-box">
                            <div class="inpt-bx">
                                <label for="coupon">Name <span>*</span></label>
                                <div class="inpt">
                                    <input type="type" id="name-checkout" placeholder="Enter your name.."
                                        name="name-checkout" autocomplete="off" required>
                                </div>
                            </div>
                            <div class="inpt-bx">
                                <label for="coupon">Email <span>*</span></label>
                                <div class="inpt">
                                    <input type="email" id="email-checkout" placeholder="Enter your email.."
                                        name="email-checkout" autocomplete="off" required>
                                </div>
                            </div>
                            <div class="inpt-bx">
                                <label for="coupon">Phone No. <span>*</span></label>
                                <div class="inpt">
                                    <input type="number" id="phnum" placeholder="Enter your phonenumber.." name="phnum"
                                        autocomplete="off" required>
                                </div>
                            </div>
                            <div class="inpt-bx">
                                <label for="coupon">Address <span>*</span></label>
                                <div class="textareainput">
                                    <textarea name="address-checkout" id="address-checkout"
                                        placeholder="Enter your Address" required></textarea>
                                </div>
                            </div>
                            <div class="inpt-bx">
                                <label for="coupon">Pin Code <span>*</span></label>
                                <div class="inpt">
                                    <input type="number" id="pinc" placeholder="Enter your pincode " name="pinc"
                                        autocomplete="off" required>
                                </div>
                            </div>
                            <div class="inpt-bx">
                                <label for="coupon">City <span>*</span></label>
                                <div class="inpt">
                                    <input type="type" id="city" placeholder="Enter your ity" name="city"
                                        autocomplete="off" required>
                                </div>
                            </div>
                            <div class="inpt-bx">
                                <label for="coupon">State <span>*</span></label>
                                <div class="inpt">
                                    <input type="type" id="state" placeholder="Enter your state" name="state"
                                        autocomplete="off" required>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="Checkout-right">
                        <h6>Plan</h6>
                        <div id="renewModal" class="Checkout-right-box">
                            <div class="Checkout-box">
                                <div class="modal-content" id="modalContent">
                                    <!-- <span onclick="document.getElementById('renewModal').style.display='none'">
                                        <i class="fa-solid fa-xmark" style="color: #ffffff;"></i>
                                    </span> -->
                                    <!-- <h5>Renew Subscription</h5> -->
                                    <p id="messageAp"></p>
                                    <p id="apdate"></p>
                                    <p id="apstarttime"></p>
                                    <p id="apendtime"></p>
                                    <div class="payment-plan-box">
                                        <div class="payment-plan-head">
                                            <h6 id="planName">Basic</h6>
                                        </div>
                                        <div class="payment-plan-body">
                                            <div class="payment-price">
                                                <p>₹</p>
                                                <h5 id="planPrice">251</h5>
                                            </div>
                                            <div class="payment-plan-body-box">
                                                <p>/Per user</p>
                                                <p id="duration">/Per months</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="inpt-bx">
                                        <label for="coupon">Coupon</label>
                                        <div class="inpt payment-coupon">
                                            <input type="type" id="couponInput" name="couponInput"
                                                placeholder="Coupon code" autocomplete="off">
                                            <button type="button" onclick="applyCoupon()">Apply</button>
                                        </div>
                                        <p id="couponMessage" style="margin-top: 5px;"></p>
                                    </div>
                                    <p>100% Secure Payment method</p>
                                    <button class="form-btn" type="button" onclick="processPayment(true)">Proceed to
                                        Payment</button>
                                </div>

                                <!-- Success Message -->
                                <div class="subscription-message" id="successMessage"
                                    style="display:none; text-align:center; color:white;">
                                    <img src="./images/success.gif" alt="">
                                    <p>Payment Successful!</p>
                                    <p>Subscription is successfull!</p>
                                </div>

                                <!-- Failed Message -->
                                <div class="subscription-message" id="failedMessage"
                                    style="display:none; text-align:center; color:white;">
                                    <i class="fa-solid fa-circle-xmark"
                                        style="font-size: 50px; color: #FF4C4C; margin-bottom: 15px;"></i>
                                    <p>Payment failed!</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>


    <!-- ____________________________
          Our Footer Comp 
          -------------------- -->

    <footer class="footer-comp">
        <div class="common-container3">

            <div class="footer-flex-bx">

                <div class="left-footer-bx">

                    <div class="left-header-logo flex item-start gap">
                        <img src="./images/astrology.png" alt="">

                        <h6>Astro Nivesh</h6>


                    </div>




                    <p>
                        Astro Nivesh is best astrology website for online Astrology predictions. Talk to Astrologer on
                        call and get answers to all your worries by seeing the future life through Astrology Kundli
                        Predictions from the best Astrologers from India. Get best future predictions related to
                        Marriage, love life, Career or Health over call, chat, query or report.
                    </p>

                </div>


                <div class="right-footer-bx">

                    <div class="footer-bx">
                        <h6>Corporate Info</h6>
                        <div class="footer-li">
                            <li><a href="aboutus.html">About Us</a></li>
                            <li><a href="contactus.html">Contact Us</a></li>
                            <li><a href="termsconditions.html">Terms & Conditions</a></li>
                            <li><a href="privacypolicy.html">Privacy Policy</a></li>
                            <!-- <li><a href="shippingpolicy.html">Shipping Policy</a></li> -->
                            <li><a href="refundpolicy.html">Refund Policy</a></li>
                        </div>
                    </div>


                    <div class="footer-bx">
                        <h6>Contact Info</h6>
                        <div class="footer-li">
                            <li><a href="#"> We are available 24x7 on chat support</a></li>
                            <li><a href="#">Email ID: contact@astronivesh.com</a></li>

                            <div class="soc-icons-flex">
                                <a href="#">
                                    <ion-icon name="logo-facebook"></ion-icon>
                                </a>
                                <a href="#">
                                    <ion-icon name="logo-instagram"></ion-icon>
                                </a>
                                <a href="#">
                                    <ion-icon name="logo-linkedin"></ion-icon>
                                </a>
                                <a href="#">
                                    <ion-icon name="logo-youtube"></ion-icon>
                                </a>
                            </div>

                        </div>
                    </div>


                </div>

            </div>

            <div class="copyright-bx">
                <p>Copyright 2025 Astro Nivesh (This website is owned and managed by Shriram Lalasaheb Magar) | All
                    Rights Reserved | Dev. By: <a href="https://digitaldezire.com/">Digital Dezire</a></p>
            </div>
        </div>
    </footer>
    <script>
        const host = "https://api.astronivesh.com";
        const token = localStorage.getItem("token");
        if (!token) {
            window.location.href = "./index.html";
        }
        async function fetchAllData() {
            try {
                const response = await fetch(`${host}/api/auth/getuser`, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "auth-token": token
                    }
                });

                if (!response.ok == true) {
                    throw new Error("Failed to fetch data");
                }

                const data = await response.json();
                // console.log(data, "data")
                populatePTable(data)
                populateName(data)
                const params = new URLSearchParams(window.location.search);
                const paymentdata = params.get("data");
                console.log(paymentdata, "params")
                // Store response.data in localStorage before redirecting
                localStorage.setItem("paymentData", JSON.stringify(paymentdata));
                document.getElementById("name-checkout").value = data.name || "Not Set";
                document.getElementById("email-checkout").value = data.email || "Not Set";
                document.getElementById("address-checkout").value = data.birthplace || "Not Set";
                paymentStatus()
            } catch (error) {
                console.error(error);
                // alert("Error fetching data: " + error.message);
            }
        }

        function populatePTable(data) {
            const tableBody = document.getElementById("profile-body");
            tableBody.innerHTML = "";

            tableBody.innerHTML = `
            <div class="profile-desc">
                <h4>${data.name}</h4>
            </div>
             
            `
        }
        function populateName(data) {
            const tableBody = document.getElementById("profile-name");
            tableBody.innerHTML = "";

            tableBody.innerHTML = `
            <p>${data.name}</p>
             
            `
        }

        const query = JSON.parse(localStorage.getItem("appointmentData"));
        console.log(query, "query")
        let applan = []
        let apprice = []
        let apduration = []
        let apdate = []
        let apstartTime = []
        let apendTime = []

        if (query && query.appointment === "appointment") {
            console.log("appointment")
            applan = query.plan;
            apprice = query.price;
            apduration = query.duration;
            apdate = query.date;
            apstartTime = query.startTime;
            apendTime = query.endTime;
            const planNameElement = document.getElementById('planName');
            const planPriceElement = document.getElementById('planPrice');
            const durationElement = document.getElementById('duration');
            const dateElement = document.getElementById('apdate');
            const starttimeElement = document.getElementById('apstarttime');
            const endtimeElement = document.getElementById('apendtime');
            const messageElement = document.getElementById('messageAp')

            if (applan) {
                planNameElement.innerText = applan;
                messageElement.innerText = "You will get the mail reqarding appointment"
            }
            if (apduration) {
                durationElement.innerText = apduration;
            }
            if (apdate) {
                dateElement.innerText = "Date :- " + apdate;
            }
            if (apstartTime) {
                starttimeElement.innerText = "Start Time :- " + apstartTime;
            }
            if (apendTime) {
                endtimeElement.innerText = "End Time :- " + apendTime;
            }

            if (apprice) {
                planPriceElement.innerText = apprice;
            } else {
                const originalPrice = parseInt(planPriceElement.innerText);
            }
        }

        // subscription
        let discountPercent = 0; // To store applied discount

        const couponCodes = {
            NIVESH25: 25,
            NIVESH50: 50,
            NIVESH100: 100
        };
        const originalPrice = parseInt(document.getElementById('planPrice').innerText);
        console.log(originalPrice, "originalPrice")
        let finalPrice = originalPrice;

        function applyCoupon() {
            console.log(originalPrice, "originalPrice")
            let couponInput = document.getElementById('couponInput').value.trim().toUpperCase();
            let message = document.getElementById('couponMessage');

            if (couponCodes[couponInput]) {
                discountPercent = couponCodes[couponInput];
                const discountAmount = (originalPrice * discountPercent) / 100;
                finalPrice = originalPrice - discountAmount;
                document.getElementById('planPrice').innerText = finalPrice;
                message.style.color = 'green';
                message.innerText = `Coupon applied! ${discountPercent}% discount.`;
            } else {
                discountPercent = 0;
                message.style.color = 'red';
                message.innerText = `Invalid Coupon Code.`;
            }
        }

        async function processPayment() {
            // Fetch user input data
            let name = document.getElementById('name-checkout').value.trim();
            let email = document.getElementById('email-checkout').value.trim();
            let phone = document.getElementById('phnum').value.trim();
            let address = document.getElementById('address-checkout').value.trim();
            let pincode = document.getElementById('pinc').value.trim();
            let city = document.getElementById('city').value.trim();
            let state = document.getElementById('state').value.trim();

            // subscription
            let plan = document.getElementById('planName').innerText;
            let price = parseInt(document.getElementById('planPrice').innerText);
            let coupon = document.getElementById('couponInput').value.trim().toUpperCase();
            let transactionId = Math.floor(Math.random() * 1000000000);

            // let finalPrice = price - (price * discountPercent / 100);
            // console.log(`Final Price after Discount: ₹${finalPrice}`);

            document.getElementById('modalContent').style.display = 'none';
            let storingData = []
            if (query && query.appointment === "appointment") {
             storingData = {
                    plan, transactionId, coupon, finalPrice, name, email, phone, address, pincode, city, state, apduration, apdate, apstartTime, apendTime
                }
            } else {
                 storingData = {
                    plan, transactionId, coupon, finalPrice, name, email, phone, address, pincode, city, state
                }
            }
            console.log(storingData, "storingData")

            // If 100% discount → no payment gateway, show success directly
            if (discountPercent === 100) {
                let paymentMethod = "Free";
                let transactionId = "00000000";
                if (query && query.appointment === "appointment") {
                    await assignAppointment(storingData, paymentMethod, transactionId,);
                } else {
                    await assignSubscription(storingData, paymentMethod, transactionId);
                }
                document.getElementById('successMessage').style.display = 'block';
            } else {
                localStorage.setItem("storingData", JSON.stringify(storingData));
                const collectedData = {
                    finalPrice
                }
                // console.log(collectedData)
                await axios.post(`${host}/api/payment/pay`, collectedData).then((response) => {
                    // console.log(response)
                    if (response.data && response.data.checkoutPageUrl) {
                        window.location.href = response.data.checkoutPageUrl;
                    }
                }).catch((error) => {
                    console.log(error)
                })
            }
            setTimeout(() => {
                document.getElementById('modalContent').style.display = 'block';
                document.getElementById('successMessage').style.display = 'none';
                document.getElementById('failedMessage').style.display = 'none';
                document.getElementById('couponMessage').innerText = '';
                discountPercent = 0;
                document.getElementById('couponInput').value = '';
                // location.reload();
            }, 5000);
        }

        async function paymentStatus() {
            console.log("payment Status")
            // Retrieve in checkout.html
            const paymentData = JSON.parse(localStorage.getItem("paymentData"));
            console.log(paymentData, "paymentdata");

            if (paymentData) {
                try {
                    const parsedData = JSON.parse(paymentData);
                    console.log(parsedData, "Parsed Data");

                    // Show modal initially
                    document.getElementById('modalContent').style.display = 'block';
                    document.getElementById('successMessage').style.display = 'none';
                    document.getElementById('failedMessage').style.display = 'none';

                    if (parsedData.state === "COMPLETED") {
                        document.getElementById('modalContent').style.display = 'none';
                        document.getElementById('successMessage').style.display = 'block';

                        const storingData = JSON.parse(localStorage.getItem("storingData"));

                        // Extract payment details
                        let paymentMethod = parsedData.paymentDetails?.[0]?.paymentMode || "Pending";
                        let transactionId = parsedData.paymentDetails?.[0]?.transactionId;

                        if (query && query.appointment === "appointment") {
                            console.log(query, "this is query")
                            await assignAppointment(storingData, paymentMethod, transactionId);
                        } else {
                            console.log("this is not query")
                            await assignSubscription(storingData, paymentMethod, transactionId);
                        }
                    } else {
                        document.getElementById('modalContent').style.display = 'none';
                        document.getElementById('failedMessage').style.display = 'block';
                    }

                    // Hide messages after 3 seconds and remove data
                    setTimeout(() => {
                        document.getElementById('successMessage').style.display = 'none';
                        document.getElementById('failedMessage').style.display = 'none';

                        // Remove paymentData from localStorage
                        localStorage.removeItem("paymentData");
                        localStorage.removeItem("storingData");

                        // Remove 'data' parameter from the URL
                        const url = new URL(window.location);
                        url.searchParams.delete("data");
                        window.history.replaceState({}, document.title, url);
                        document.getElementById('modalContent').style.display = 'block';
                    }, 5000);

                } catch (error) {
                    console.error("Error parsing payment data:", error);
                }
            }

        }



        async function assignSubscription(storingData, paymentMethod, transactionId) {
            console.log(storingData, "storingData")
            try {
                let response = await fetch(`${host}/api/subscription/assign`, {
                    method: 'POST',
                    headers: {
                        "Content-Type": "application/json",
                        "auth-token": token
                    },
                    body: JSON.stringify({
                        plan: storingData.plan,
                        paymentMethod: paymentMethod,
                        transactionId: transactionId,
                        couponCode: storingData.coupon
                    })
                });
                let data = await response.json();
                console.log(data, "data")
                if (data.success === true) {
                    console.log("success")
                }
            } catch (err) {
                console.error('Error assigning subscription:', err);
            }
            try {

                let response2 = await fetch(`${host}/api/invoice/add`, {
                    method: 'POST',
                    headers: {
                        "Content-Type": "application/json",
                        "auth-token": token
                    },
                    body: JSON.stringify({
                        price: storingData.finalPrice,
                        name: storingData.name,
                        email: storingData.email,
                        phone: storingData.phone,
                        address: storingData.address,
                        pincode: storingData.pincode,
                        city: storingData.city,
                        state: storingData.state
                    }),
                });

                console.log(response2, "response2")
                let data2 = await response2.json();
                console.log(data2, "data2")
                if (data2.success === true) {
                    console.log("success")
                }
                console.log("object")
            } catch (error) {

            }
        }

        // appointment submition

        async function assignAppointment(storingData, paymentMethod, transactionId) {
            console.log(storingData, "storingData")
            try {
                let response = await fetch(`${host}/api/appointment/add`, {
                    method: 'POST',
                    headers: {
                        "Content-Type": "application/json",
                        "auth-token": token
                    },
                    body: JSON.stringify({
                        appointment: [
                            {
                                name: storingData.name,
                                date: storingData.apdate,
                                email: storingData.email,
                                transactionId: transactionId,
                                amount: storingData.finalPrice,
                                preferedTime: storingData.apstartTime + "-" + storingData.apendTime,
                                status: "Upcoming"
                            }]
                    })
                });
                let data = await response.json();
                console.log(data, "data")
                if (data.success === true) {
                    console.log("success")
                }
            } catch (err) {
                console.error('Error assigning subscription:', err);
            }
            try {

                let response2 = await fetch(`${host}/api/invoice/add`, {
                    method: 'POST',
                    headers: {
                        "Content-Type": "application/json",
                        "auth-token": token
                    },
                    body: JSON.stringify({
                        price: storingData.finalPrice,
                        name: storingData.name,
                        email: storingData.email,
                        phone: storingData.phone,
                        address: storingData.address,
                        pincode: storingData.pincode,
                        city: storingData.city,
                        state: storingData.state
                    }),
                });

                // console.log(response2, "response2")
                let data2 = await response2.json();
                console.log(data2, "data2")
                if (data2.success === true) {
                    localStorage.removeItem(appointmentData)
                    console.log("success")
                }
                console.log("object")
            } catch (error) {

            }
        }


        document.addEventListener("DOMContentLoaded", function () {
            // console.log(token, "token")
            const loginForm = document.querySelector(".login-info");
            const regInfo = document.querySelector(".reg-info");
            const profileInfo = document.querySelector(".profile-info");

            if (token) {
                // User is logged in, show profile and hide login/signup forms
                loginForm.style.display = "none";
                regInfo.style.display = "none";
                profileInfo.style.display = "block";
            } else {
                // User is not logged in, show login/signup forms
                loginForm.style.display = "block";
                regInfo.style.display = "block";
                profileInfo.style.display = "none";
            }

            // Logout functionality
            const logoutBox = document.getElementById("logoutBox");
            if (logoutBox) {
                logoutBox.addEventListener("click", function () {
                    localStorage.removeItem("token");
                    localStorage.removeItem('params');
                    location.reload();
                    window.location.href = "./index.html";
                });
            }
        });
    </script>

    <script>
        // Populate table on page load
        window.onload = async () => {
            fetchAllData()
        };
        function clearAppointmentData() {
            localStorage.removeItem("appointmentData");
        }

        window.addEventListener('beforeunload', clearAppointmentData);
        window.addEventListener('pagehide', clearAppointmentData);
    </script>


    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
    <!-- Swiper Js file -->
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <!-- script file -->
    <script src="./js/index.js"></script>

</body>

</html>